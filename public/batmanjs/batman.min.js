(function(){var e,t=[].slice;e=function(){var n;n=1<=arguments.length?t.call(arguments,0):[];return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(e.Object,n,function(){})};e.version="0.14.1";e.config={pathToApp:"/",usePushState:true,pathToHTML:"html",fetchRemoteHTML:true,cacheViews:false,minificationErrors:true,protectFromCSRF:false};(e.container=function(){return this}()).Batman=e;if(typeof define==="function"){define("batman",[],function(){return e})}e.exportHelpers=function(t){var n,r,i,s;s=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"];for(r=0,i=s.length;r<i;r++){n=s[r];t["$"+n]=e[n]}return t};e.exportGlobals=function(){return e.exportHelpers(e.container)}}).call(this);(function(){var e;Batman._Batman=e=function(){function e(e){this.object=e}e.prototype.check=function(e){if(e!==this.object){e._batman=new Batman._Batman(e);return false}return true};e.prototype.get=function(e){var t,n;n=this.getAll(e);switch(n.length){case 0:return void 0;case 1:return n[0];default:t=n[0].concat!=null?function(e,t){return e.concat(t)}:n[0].merge!=null?function(e,t){return e.merge(t)}:n.every(function(e){return typeof e==="object"})?(n.unshift({}),function(e,t){return Batman.extend(e,t)}):void 0;if(t){return n.reduceRight(t)}else{return n}}};e.prototype.getFirst=function(e){var t;t=this.getAll(e);return t[0]};e.prototype.getAll=function(e){var t,n,r;if(typeof e==="function"){t=e}else{t=function(t){var n;return(n=t._batman)!=null?n[e]:void 0}}n=this.ancestors(t);if(r=t(this.object)){n.unshift(r)}return n};e.prototype.ancestors=function(e){var t,n,r,i,s,o;this._allAncestors||(this._allAncestors=this.allAncestors());if(e){n=[];o=this._allAncestors;for(i=0,s=o.length;i<s;i++){t=o[i];r=e(t);if(r!=null){n.push(r)}}return n}else{return this._allAncestors}};e.prototype.allAncestors=function(){var e,t,n,r,i,s;r=[];e=!!this.object.prototype;t=e?(i=this.object.__super__)!=null?i.constructor:void 0:(n=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:n;if(t!=null){if((s=t._batman)!=null){s.check(t)}r.push(t);if(t._batman!=null){r=r.concat(t._batman.allAncestors())}}return r};e.prototype.set=function(e,t){return this[e]=t};return e}()}).call(this);(function(){var e,t,n,r,i,s,o,u,a=[].slice,f={}.hasOwnProperty,l=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};Batman.typeOf=function(e){if(typeof e==="undefined"){return"Undefined"}return s.call(e).slice(8,-1)};s=Object.prototype.toString;Batman.extend=function(){var e,t,n,r,i,s,o;r=arguments[0],n=2<=arguments.length?a.call(arguments,1):[];for(s=0,o=n.length;s<o;s++){t=n[s];for(e in t){i=t[e];r[e]=i}}return r};Batman.mixin=function(){var e,t,n,r,i,s,o,u;i=arguments[0],r=2<=arguments.length?a.call(arguments,1):[];e=typeof i.set==="function";for(o=0,u=r.length;o<u;o++){n=r[o];if(Batman.typeOf(n)!=="Object"){continue}for(t in n){if(!f.call(n,t))continue;s=n[t];if(t==="initialize"||t==="uninitialize"||t==="prototype"){continue}if(e){i.set(t,s)}else if(i.nodeName!=null){Batman.data(i,t,s)}else{i[t]=s}}if(typeof n.initialize==="function"){n.initialize.call(i)}}return i};Batman.unmixin=function(){var e,t,n,r,i,s;e=arguments[0],r=2<=arguments.length?a.call(arguments,1):[];for(i=0,s=r.length;i<s;i++){n=r[i];for(t in n){if(t==="initialize"||t==="uninitialize"){continue}delete e[t]}if(typeof n.uninitialize==="function"){n.uninitialize.call(e)}}return e};Batman._functionName=Batman.functionName=function(e){var t;if(e.__name__){return e.__name__}if(e.name){return e.name}return(t=e.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?t[1]:void 0};Batman._isChildOf=Batman.isChildOf=function(e,t){var n;n=t.parentNode;while(n){if(n===e){return true}n=n.parentNode}return false};i=function(e){var t,n,r,i,s,o,u;t=function(){var t,n;if(!e.postMessage){return false}t=true;n=e.onmessage;e.onmessage=function(){return t=false};e.postMessage("","*");e.onmessage=n;return t};u=new Batman.SimpleHash;n=0;i=function(){return"go"+ ++n};if(e.setImmediate&&e.clearImmediate){Batman.setImmediate=function(){return e.setImmediate.apply(e,arguments)};return Batman.clearImmediate=function(){return e.clearImmediate.apply(e,arguments)}}else if(t()){o="com.batman.";s=function(e){var t,n;if(typeof e.data!=="string"||!~e.data.search(o)){return}t=e.data.substring(o.length);return typeof (n=u.unset(t))==="function"?n():void 0};if(e.addEventListener){e.addEventListener("message",s,false)}else{e.attachEvent("onmessage",s)}Batman.setImmediate=function(t){var n;u.set(n=i(),t);e.postMessage(o+n,"*");return n};return Batman.clearImmediate=function(e){return u.unset(e)}}else if(typeof document!=="undefined"&&l.call(document.createElement("script"),"onreadystatechange")>=0){Batman.setImmediate=function(e){var t,n;t=i();n=document.createElement("script");n.onreadystatechange=function(){var e;if(typeof (e=u.get(t))==="function"){e()}n.onreadystatechange=null;n.parentNode.removeChild(n);return n=null};document.documentElement.appendChild(n);return t};return Batman.clearImmediate=function(e){return u.unset(e)}}else if(typeof process!=="undefined"&&process!==null?process.nextTick:void 0){r={};Batman.setImmediate=function(e){var t;t=i();r[t]=e;process.nextTick(function(){if(typeof r[t]==="function"){r[t]()}return delete r[t]});return t};return Batman.clearImmediate=function(e){return delete r[e]}}else{Batman.setImmediate=function(e){return setTimeout(e,0)};return Batman.clearImmediate=function(e){return clearTimeout(e)}}};Batman.setImmediate=function(){i(Batman.container);return Batman.setImmediate.apply(this,arguments)};Batman.clearImmediate=function(){i(Batman.container);return Batman.clearImmediate.apply(this,arguments)};Batman.forEach=function(e,t,n){var r,i,s,o,u,a;if(e.forEach){e.forEach(t,n)}else if(e.indexOf){for(i=u=0,a=e.length;u<a;i=++u){r=e[i];t.call(n,r,i,e)}}else{for(s in e){o=e[s];t.call(n,s,o,e)}}};Batman.objectHasKey=function(e,t){if(typeof e.hasKey==="function"){return e.hasKey(t)}else{return t in e}};Batman.contains=function(e,t){if(e.indexOf){return l.call(e,t)>=0}else if(typeof e.has==="function"){return e.has(t)}else{return Batman.objectHasKey(e,t)}};Batman.get=function(e,t){if(typeof e.get==="function"){return e.get(t)}else{return Batman.Property.forBaseAndKey(e,t).getValue()}};Batman.getPath=function(e,t){var n,r,i;for(r=0,i=t.length;r<i;r++){n=t[r];if(e!=null){e=Batman.get(e,n);if(e==null){return e}}else{return}}return e};r={"&":"&","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"};o=[];t=[];for(e in r){o.push(e);t.push(r[e])}u=new RegExp("["+o.join("")+"]","g");n=new RegExp("("+t.join("|")+")","g");Batman.escapeHTML=function(){return function(e){return(""+e).replace(u,function(e){return r[e]})}}();Batman.unescapeHTML=function(){return function(e){var t;if(e==null){return}t=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV"));t.innerHTML=e;return Batman.DOM.textContent(t)}}();Batman.translate=function(e,t){if(t==null){t={}}return Batman.helpers.interpolate(Batman.get(Batman.translate.messages,e),t)};Batman.translate.messages={};Batman.t=function(){return Batman.translate.apply(Batman,arguments)};Batman.redirect=function(e,t){var n;if(t==null){t=false}return(n=Batman.navigator)!=null?n.redirect(e,t):void 0};Batman.initializeObject=function(e){if(e._batman!=null){return e._batman.check(e)}else{return e._batman=new Batman._Batman(e)}}}).call(this);(function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};Batman.Inflector=function(){function n(){this._plural=[];this._singular=[];this._uncountable=[];this._human=[]}n.prototype.plural=function(e,t){return this._plural.unshift([e,t])};n.prototype.singular=function(e,t){return this._singular.unshift([e,t])};n.prototype.human=function(e,t){return this._human.unshift([e,t])};n.prototype.uncountable=function(){var t;t=1<=arguments.length?e.call(arguments,0):[];return this._uncountable=this._uncountable.concat(t.map(function(e){return new RegExp(""+e+"$","i")}))};n.prototype.irregular=function(e,t){if(e.charAt(0)===t.charAt(0)){this.plural(new RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1));this.plural(new RegExp("("+e.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+t.slice(1));return this.singular(new RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1))}else{this.plural(new RegExp(""+e+"$","i"),t);this.plural(new RegExp(""+t+"$","i"),t);return this.singular(new RegExp(""+t+"$","i"),e)}};n.prototype.ordinalize=function(e,n){var r,i;if(n==null){n=10}e=parseInt(e,n);r=Math.abs(e);if(i=r%100,t.call([11,12,13],i)>=0){return e+"th"}else{switch(r%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd";default:return e+"th"}}};n.prototype.pluralize=function(e){var t,n,r,i,s,o,u,a,f,l;a=this._uncountable;for(i=0,o=a.length;i<o;i++){r=a[i];if(r.test(e)){return e}}f=this._plural;for(s=0,u=f.length;s<u;s++){l=f[s],t=l[0],n=l[1];if(t.test(e)){return e.replace(t,n)}}return e};n.prototype.singularize=function(e){var t,n,r,i,s,o,u,a,f,l;a=this._uncountable;for(i=0,o=a.length;i<o;i++){r=a[i];if(r.test(e)){return e}}f=this._singular;for(s=0,u=f.length;s<u;s++){l=f[s],t=l[0],n=l[1];if(t.test(e)){return e.replace(t,n)}}return e};n.prototype.humanize=function(e){var t,n,r,i,s,o;s=this._human;for(r=0,i=s.length;r<i;r++){o=s[r],t=o[0],n=o[1];if(t.test(e)){return e.replace(t,n)}}return e};return n}()}).call(this);(function(){var e,t,n,r,i,s,o,u;t=/(?:^|_|\-)(.)/g;n=/(^|\s)([a-z])/g;o=/([A-Z]+)([A-Z][a-z])/g;u=/([a-z\d])([A-Z])/g;r=/_id$/;i=/_|-/g;s=/^\w/g;Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(e,t,n,r){var i;if(r==null){r=true}if(arguments.length<2){return Batman.helpers.inflector.pluralize(e)}else{i=+e===1?t:n||Batman.helpers.inflector.pluralize(t);if(r){i=""+(e||0)+" "+i}return i}},camelize:function(e,n){e=e.replace(t,function(e,t){return t.toUpperCase()});if(n){return e.substr(0,1).toLowerCase()+e.substr(1)}else{return e}},underscore:function(e){return e.replace(o,"$1_$2").replace(u,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(e){return e.replace(n,function(e,t,n){return t+n.toUpperCase()})},trim:function(e){if(e){return e.trim()}else{return""}},interpolate:function(e,t){var n,r,i;if(typeof e==="object"){r=e[t.count];if(!r){r=e["other"]}}else{r=e}for(n in t){i=t[n];r=r.replace(new RegExp("%\\{"+n+"\\}","g"),i)}return r},humanize:function(e){e=Batman.helpers.underscore(e);e=Batman.helpers.inflector.humanize(e);return e.replace(r,"").replace(i," ").replace(s,function(e){return e.toUpperCase()})}};e=new Batman.Inflector;Batman.helpers.inflector=e;e.plural(/$/,"s");e.plural(/s$/i,"s");e.plural(/(ax|test)is$/i,"$1es");e.plural(/(octop|vir)us$/i,"$1i");e.plural(/(octop|vir)i$/i,"$1i");e.plural(/(alias|status)$/i,"$1es");e.plural(/(bu)s$/i,"$1ses");e.plural(/(buffal|tomat)o$/i,"$1oes");e.plural(/([ti])um$/i,"$1a");e.plural(/([ti])a$/i,"$1a");e.plural(/sis$/i,"ses");e.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves");e.plural(/(hive)$/i,"$1s");e.plural(/([^aeiouy]|qu)y$/i,"$1ies");e.plural(/(x|ch|ss|sh)$/i,"$1es");e.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices");e.plural(/([m|l])ouse$/i,"$1ice");e.plural(/([m|l])ice$/i,"$1ice");e.plural(/^(ox)$/i,"$1en");e.plural(/^(oxen)$/i,"$1");e.plural(/(quiz)$/i,"$1zes");e.singular(/s$/i,"");e.singular(/(n)ews$/i,"$1ews");e.singular(/([ti])a$/i,"$1um");e.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis");e.singular(/(^analy)ses$/i,"$1sis");e.singular(/([^f])ves$/i,"$1fe");e.singular(/(hive)s$/i,"$1");e.singular(/(tive)s$/i,"$1");e.singular(/([lr])ves$/i,"$1f");e.singular(/([^aeiouy]|qu)ies$/i,"$1y");e.singular(/(s)eries$/i,"$1eries");e.singular(/(m)ovies$/i,"$1ovie");e.singular(/(x|ch|ss|sh)es$/i,"$1");e.singular(/([m|l])ice$/i,"$1ouse");e.singular(/(bus)es$/i,"$1");e.singular(/(o)es$/i,"$1");e.singular(/(shoe)s$/i,"$1");e.singular(/(cris|ax|test)es$/i,"$1is");e.singular(/(octop|vir)i$/i,"$1us");e.singular(/(alias|status)es$/i,"$1");e.singular(/^(ox)en/i,"$1");e.singular(/(vert|ind)ices$/i,"$1ex");e.singular(/(matr)ices$/i,"$1ix");e.singular(/(quiz)zes$/i,"$1");e.singular(/(database)s$/i,"$1");e.irregular("person","people");e.irregular("man","men");e.irregular("child","children");e.irregular("sex","sexes");e.irregular("move","moves");e.irregular("cow","kine");e.irregular("zombie","zombies");e.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}).call(this);(function(){var e;Batman.developer={suppressed:false,DevelopmentError:function(){var e;e=function(e){this.message=e;return this.name="DevelopmentError"};e.prototype=Error.prototype;return e}(),_ie_console:function(e,t){var n,r,i,s;if(t.length!==1){if(typeof console!=="undefined"&&console!==null){console[e]("..."+e+" of "+t.length+" items...")}}s=[];for(r=0,i=t.length;r<i;r++){n=t[r];s.push(typeof console!=="undefined"&&console!==null?console[e](n):void 0)}return s},suppress:function(t){e.suppressed=true;if(t){t();return e.suppressed=false}},unsuppress:function(){return e.suppressed=false},log:function(){if(e.suppressed||!((typeof console!=="undefined"&&console!==null?console.log:void 0)!=null)){return}if(console.log.apply){return console.log.apply(console,arguments)}else{return e._ie_console("log",arguments)}},warn:function(){if(e.suppressed||!((typeof console!=="undefined"&&console!==null?console.warn:void 0)!=null)){return}if(console.warn.apply){return console.warn.apply(console,arguments)}else{return e._ie_console("warn",arguments)}},error:function(t){throw new e.DevelopmentError(t)},assert:function(t,n){if(!t){return e.error(n)}},"do":function(t){if(!e.suppressed){return t()}},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(e,t){if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log(arguments)}}return e},logStack:function(t){if(typeof console!=="undefined"&&console!==null){if(typeof console.log==="function"){console.log(e.currentFilterStack)}}return t}})},deprecated:function(e,t){return Batman.developer.warn(""+e+" has been deprecated.",t||"")}};e=Batman.developer;Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}).call(this);(function(){Batman.Event=function(){function e(e,t){this.base=e;this.key=t;this._preventCount=0}e.forBaseAndKey=function(e,t){if(e.isEventEmitter){return e.event(t)}else{return new Batman.Event(e,t)}};e.prototype.isEvent=true;e.prototype.isEqual=function(e){return this.constructor===e.constructor&&this.base===e.base&&this.key===e.key};e.prototype.hashKey=function(){var e;this.hashKey=function(){return e};return e="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'};e.prototype.addHandler=function(e){this.handlers||(this.handlers=[]);if(this.handlers.indexOf(e)===-1){this.handlers.push(e)}if(this.oneShot){this.autofireHandler(e)}return this};e.prototype.removeHandler=function(e){var t;if(this.handlers&&(t=this.handlers.indexOf(e))!==-1){this.handlers.splice(t,1)}return this};e.prototype.eachHandler=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;if((s=this.handlers)!=null){s.slice().forEach(e)}if((o=this.base)!=null?o.isEventEmitter:void 0){n=this.key;a=(u=this.base._batman)!=null?u.ancestors():void 0;for(r=0,i=a.length;r<i;r++){t=a[r];if(t.isEventEmitter&&((f=t._batman)!=null?(l=f.events)!=null?l.hasOwnProperty(n):void 0:void 0)){if((c=t.event(n,false))!=null){if((h=c.handlers)!=null){h.slice().forEach(e)}}}}}};e.prototype.clearHandlers=function(){return this.handlers=void 0};e.prototype.handlerContext=function(){return this.base};e.prototype.prevent=function(){return++this._preventCount};e.prototype.allow=function(){if(this._preventCount){--this._preventCount}return this._preventCount};e.prototype.isPrevented=function(){return this._preventCount>0};e.prototype.autofireHandler=function(e){if(this._oneShotFired&&this._oneShotArgs!=null){return e.apply(this.handlerContext(),this._oneShotArgs)}};e.prototype.resetOneShot=function(){this._oneShotFired=false;return this._oneShotArgs=null};e.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)};e.prototype.fireWithContext=function(e,t){if(this.isPrevented()||this._oneShotFired){return false}if(this.oneShot){this._oneShotFired=true;this._oneShotArgs=t}return this.eachHandler(function(n){return n.apply(e,t)})};e.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext,arguments)};e.prototype.allowAndFireWithContext=function(e,t){this.allow();return this.fireWithContext(e,t)};return e}()}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.PropertyEvent=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.eachHandler=function(e){return this.eachObserver(e)};r.prototype.handlerContext=function(){return this.base};return r}(Batman.Event)}).call(this);(function(){var e=[].slice;Batman.EventEmitter={isEventEmitter:true,hasEvent:function(e){var t,n;return(t=this._batman)!=null?typeof t.get==="function"?(n=t.get("events"))!=null?n.hasOwnProperty(e):void 0:void 0:void 0},event:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;if(t==null){t=true}Batman.initializeObject(this);r=this.eventClass||Batman.Event;if((l=this._batman.events)!=null?l.hasOwnProperty(e):void 0){return s=this._batman.events[e]}else{c=this._batman.ancestors();for(a=0,f=c.length;a<f;a++){n=c[a];s=(h=n._batman)!=null?(p=h.events)!=null?p[e]:void 0:void 0;if(s){break}}if(t||(s!=null?s.oneShot:void 0)){i=(u=this._batman).events||(u.events={});o=i[e]=new r(this,e);o.oneShot=s!=null?s.oneShot:void 0;return o}else{return s}}},on:function(){var t,n,r,i,s,o;r=2<=arguments.length?e.call(arguments,0,i=arguments.length-1):(i=0,[]),t=arguments[i++];for(s=0,o=r.length;s<o;s++){n=r[s];this.event(n).addHandler(t)}return true},off:function(){var t,n,r,i,s,o;r=2<=arguments.length?e.call(arguments,0,i=arguments.length-1):(i=0,[]),t=arguments[i++];if(!r.length){n=t;this.event(n).clearHandlers()}for(s=0,o=r.length;s<o;s++){n=r[s];this.event(n).removeHandler(t)}return true},once:function(e,t){var n,r;n=this.event(e);r=function(){t.apply(this,arguments);return n.removeHandler(r)};return n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutate:function(e){var t;this.prevent("change");t=e.call(this);this.allowAndFire("change",this,this);return t},mutation:function(e){return function(){var t,n;t=e.apply(this,arguments);if((n=this.event("change",false))!=null){n.fire(this,this)}return t}},prevent:function(e){this.event(e).prevent();return this},allow:function(e){this.event(e).allow();return this},fire:function(){var t,n,r;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];return(r=this.event(n,false))!=null?r.fireWithContext(this,t):void 0},allowAndFire:function(){var t,n,r;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];return(r=this.event(n,false))!=null?r.allowAndFireWithContext(this,t):void 0},isPrevented:function(e){var t;return(t=this.event(e,false))!=null?t.isPrevented():void 0}}}).call(this);(function(){var e,t=[].slice;Batman.LifecycleEvents={initialize:function(){return this.prototype.fireLifecycleEvent=e},lifecycleEvent:function(e,t){var n,r,i;i="before"+Batman.helpers.camelize(e);r="after"+Batman.helpers.camelize(e);n=function(e){return function(n,r){var i,s,o,u,a;if(Batman.typeOf(n)==="Object"){a=[r,n],n=a[0],r=a[1]}if(Batman.typeOf(n)==="String"){i=function(){return this[n].apply(this,arguments)}}else{i=n}r=(typeof t==="function"?t(r):void 0)||r;o=this.prototype||this;Batman.initializeObject(o);s=(u=o._batman)[e]||(u[e]=[]);return s.push({options:r,callback:i})}};this[i]=n(i);this.prototype[i]=n(i);this[r]=n(r);return this.prototype[r]=n(r)}};e=function(){var e,n,r,i,s,o,u,a;i=arguments[0],e=2<=arguments.length?t.call(arguments,1):[];if(!(r=this._batman.get(i))){return}for(o=0,u=r.length;o<u;o++){a=r[o],s=a.options,n=a.callback;if((s!=null?s["if"]:void 0)&&!s["if"].apply(this,e)){continue}if((s!=null?s.unless:void 0)&&s.unless.apply(this,e)){continue}if(n.apply(this,e)===false){return false}}}}).call(this);(function(){Batman.Enumerable={isEnumerable:true,map:function(e,t){var n;if(t==null){t=Batman.container}n=[];this.forEach(function(){return n.push(e.apply(t,arguments))});return n},mapToProperty:function(e){var t;t=[];this.forEach(function(n){return t.push(Batman.get(n,e))});return t},every:function(e,t){var n;if(t==null){t=Batman.container}n=true;this.forEach(function(){return n=n&&e.apply(t,arguments)});return n},some:function(e,t){var n;if(t==null){t=Batman.container}n=false;this.forEach(function(){return n=n||e.apply(t,arguments)});return n},reduce:function(e,t){var n,r,i=this;n=0;r=t!=null;this.forEach(function(i,s){if(!r){t=i;r=true;return}t=e(t,i,s,n,self);return n++});return t},filter:function(e){var t,n,r=this;t=new this.constructor;if(t.add){n=function(t,n,i){if(e(n,i,r)){t.add(n)}return t}}else if(t.set){n=function(t,n,i){if(e(n,i,r)){t.set(n,i)}return t}}else{if(!t.push){t=[]}n=function(t,n,i){if(e(n,i,r)){t.push(n)}return t}}return this.reduce(n,t)},count:function(e,t){var n,r=this;if(t==null){t=Batman.container}if(!e){return this.length}n=0;this.forEach(function(i,s){if(e.call(t,i,s,r)){return n++}});return n},inGroupsOf:function(e){var t,n,r;r=[];t=false;n=0;this.forEach(function(s){if(n++%e===0){t=[];r.push(t)}return t.push(s)});return r}}}).call(this);(function(){var e,t=[].slice;e=Object.prototype.toString;Batman.SimpleHash=function(){function n(e){this._storage={};this.length=0;if(e!=null){this.update(e)}}Batman.extend(n.prototype,Batman.Enumerable);n.prototype.hasKey=function(e){var t,n,r,i;if(this.objectKey(e)){if(!this._objectStorage){return false}if(n=this._objectStorage[this.hashKeyFor(e)]){for(r=0,i=n.length;r<i;r++){t=n[r];if(this.equality(t[0],e)){return true}}}return false}else{e=this.prefixedKey(e);return this._storage.hasOwnProperty(e)}};n.prototype.getObject=function(e){var t,n,r,i;if(!this._objectStorage){return}if(n=this._objectStorage[this.hashKeyFor(e)]){for(r=0,i=n.length;r<i;r++){t=n[r];if(this.equality(t[0],e)){return t[1]}}}};n.prototype.getString=function(e){return this._storage["_"+e]};n.prototype.setObject=function(e,t){var n,r,i,s,o,u;this._objectStorage||(this._objectStorage={});r=(i=this._objectStorage)[u=this.hashKeyFor(e)]||(i[u]=[]);for(s=0,o=r.length;s<o;s++){n=r[s];if(this.equality(n[0],e)){return n[1]=t}}this.length++;r.push([e,t]);return t};n.prototype.setString=function(e,t){e="_"+e;if(this._storage[e]==null){this.length++}return this._storage[e]=t};n.prototype.get=function(e){var t,n,r,i;if(this.objectKey(e)){if(!this._objectStorage){return}if(n=this._objectStorage[this.hashKeyFor(e)]){for(r=0,i=n.length;r<i;r++){t=n[r];if(this.equality(t[0],e)){return t[1]}}}}else{return this._storage[this.prefixedKey(e)]}};n.prototype.set=function(e,t){var n,r,i,s,o,u;if(this.objectKey(e)){this._objectStorage||(this._objectStorage={});r=(i=this._objectStorage)[u=this.hashKeyFor(e)]||(i[u]=[]);for(s=0,o=r.length;s<o;s++){n=r[s];if(this.equality(n[0],e)){return n[1]=t}}this.length++;r.push([e,t]);return t}else{e=this.prefixedKey(e);if(this._storage[e]==null){this.length++}return this._storage[e]=t}};n.prototype.unset=function(e){var t,n,r,i,s,o,u,a,f,l;if(this.objectKey(e)){if(!this._objectStorage){return}t=this.hashKeyFor(e);if(s=this._objectStorage[t]){for(n=a=0,f=s.length;a<f;n=++a){l=s[n],r=l[0],u=l[1];if(this.equality(r,e)){i=s.splice(n,1);if(!s.length){delete this._objectStorage[t]}this.length--;return i[0][1]}}}}else{e=this.prefixedKey(e);o=this._storage[e];if(this._storage[e]!=null){this.length--;delete this._storage[e]}return o}};n.prototype.getOrSet=function(e,t){var n;n=this.get(e);if(!n){n=t();this.set(e,n)}return n};n.prototype.prefixedKey=function(e){return"_"+e};n.prototype.unprefixedKey=function(e){return e.slice(1)};n.prototype.hashKeyFor=function(t){var n,r;if(n=t!=null?typeof t.hashKey==="function"?t.hashKey():void 0:void 0){return n}else{r=e.call(t);if(r==="[object Array]"){return r}else{return t}}};n.prototype.equality=function(e,t){if(e===t){return true}if(e!==e&&t!==t){return true}if((e!=null?typeof e.isEqual==="function"?e.isEqual(t):void 0:void 0)&&(t!=null?typeof t.isEqual==="function"?t.isEqual(e):void 0:void 0)){return true}return false};n.prototype.objectKey=function(e){return typeof e!=="string"};n.prototype.forEach=function(e,t){var n,r,i,s,o,u,a,f,l,c,h;i=[];if(this._objectStorage){f=this._objectStorage;for(n in f){o=f[n];l=o.slice();for(u=0,a=l.length;u<a;u++){c=l[u],r=c[0],s=c[1];i.push(e.call(t,r,s,this))}}}h=this._storage;for(n in h){s=h[n];i.push(e.call(t,this.unprefixedKey(n),s,this))}return i};n.prototype.keys=function(){var e;e=[];Batman.SimpleHash.prototype.forEach.call(this,function(t){return e.push(t)});return e};n.prototype.toArray=n.prototype.keys;n.prototype.clear=function(){this._storage={};delete this._objectStorage;return this.length=0};n.prototype.isEmpty=function(){return this.length===0};n.prototype.merge=function(){var e,n,r,i,s;r=1<=arguments.length?t.call(arguments,0):[];n=new this.constructor;r.unshift(this);for(i=0,s=r.length;i<s;i++){e=r[i];e.forEach(function(e,t){return n.set(e,t)})}return n};n.prototype.update=function(e){var t,n;for(t in e){n=e[t];this.set(t,n)}};n.prototype.replace=function(e){var t=this;this.forEach(function(n,r){if(!(n in e)){return t.unset(n)}});return this.update(e)};n.prototype.toObject=function(){var e,t,n,r,i,s;t={};i=this._storage;for(e in i){r=i[e];t[this.unprefixedKey(e)]=r}if(this._objectStorage){s=this._objectStorage;for(e in s){n=s[e];t[e]=n[0][1]}}return t};n.prototype.toJSON=n.prototype.toObject;return n}()}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.AssociationCurator=function(e){function r(e){this.model=e;r.__super__.constructor.call(this);this._byTypeStorage=new Batman.SimpleHash}t(r,e);r.availableAssociations=["belongsTo","hasOne","hasMany"];r.prototype.add=function(e){var t;this.set(e.label,e);if(!(t=this._byTypeStorage.get(e.associationType))){t=new Batman.SimpleSet;this._byTypeStorage.set(e.associationType,t)}return t.add(e)};r.prototype.getByType=function(e){return this._byTypeStorage.get(e)};r.prototype.getByLabel=function(e){return this.get(e)};r.prototype.reset=function(){this.forEach(function(e,t){return t.reset()});return true};r.prototype.merge=function(){var e,t;e=1<=arguments.length?n.call(arguments,0):[];t=r.__super__.merge.apply(this,arguments);t._byTypeStorage=this._byTypeStorage.merge(e.map(function(e){return e._byTypeStorage}));return t};r.prototype._markDirtyAttribute=function(e,t){var n;if((n=this.lifecycle.get("state"))!=="loading"&&n!=="creating"&&n!=="saving"&&n!=="saved"){if(this.lifecycle.startTransition("set")){return this.dirtyKeys.set(e,t)}else{throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}}};return r}(Batman.SimpleHash)}).call(this);(function(){var e=[].slice;Batman.SimpleSet=function(){function t(){var e,t;this._storage=[];this.length=0;t=function(){var t,n,r;r=[];for(t=0,n=arguments.length;t<n;t++){e=arguments[t];if(e!=null){r.push(e)}}return r}.apply(this,arguments);if(t.length>0){this.add.apply(this,t)}}Batman.extend(t.prototype,Batman.Enumerable);t.prototype.at=function(e){return this._storage[e]};t.prototype.add=function(){var t,n,r,i,s;r=1<=arguments.length?e.call(arguments,0):[];t=[];for(i=0,s=r.length;i<s;i++){n=r[i];if(!(this._indexOfItem(n)===-1)){continue}this._storage.push(n);t.push(n)}this.length=this._storage.length;return t};t.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems};t.prototype.insertWithIndexes=function(e,t){var n,r,i,s,o,u,a;n=[];r=[];for(i=u=0,a=e.length;u<a;i=++u){o=e[i];if(!(this._indexOfItem(o)===-1)){continue}s=t[i];this._storage.splice(s,0,o);r.push(o);n.push(s)}this.length=this._storage.length;return{addedItems:r,addedIndexes:n}};t.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems};t.prototype.removeWithIndexes=function(){var t,n,r,i,s,o,u;r=1<=arguments.length?e.call(arguments,0):[];i=[];s=[];for(o=0,u=r.length;o<u;o++){n=r[o];if(!((t=this._indexOfItem(n))!==-1)){continue}this._storage.splice(t,1);s.push(n);i.push(t)}this.length=this._storage.length;return{removedItems:s,removedIndexes:i}};t.prototype.clear=function(){var e;e=this._storage;this._storage=[];this.length=0;return e};t.prototype.replace=function(e){this.clear();return this.add.apply(this,e.toArray())};t.prototype.has=function(e){return this._indexOfItem(e)!==-1};t.prototype.find=function(e){var t,n,r,i;i=this._storage;for(n=0,r=i.length;n<r;n++){t=i[n];if(e(t)){return t}}};t.prototype.forEach=function(e,t){var n,r,i,s;s=this._storage;for(r=0,i=s.length;r<i;r++){n=s[r];e.call(t,n,null,this)}};t.prototype.isEmpty=function(){return this.length===0};t.prototype.toArray=function(){return this._storage.slice()};t.prototype.merge=function(){var t,n,r,i,s;n=1<=arguments.length?e.call(arguments,0):[];t=new this.constructor;n.unshift(this);for(i=0,s=n.length;i<s;i++){r=n[i];r.forEach(function(e){return t.add(e)})}return t};t.prototype.indexedBy=function(e){this._indexes||(this._indexes=new Batman.SimpleHash);return this._indexes.get(e)||this._indexes.set(e,new Batman.SetIndex(this,e))};t.prototype.indexedByUnique=function(e){this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash);return this._uniqueIndexes.get(e)||this._uniqueIndexes.set(e,new Batman.UniqueSetIndex(this,e))};t.prototype.sortedBy=function(e,t){var n;if(t==null){t="asc"}t=t.toLowerCase()==="desc"?"desc":"asc";this._sorts||(this._sorts=new Batman.SimpleHash);n=this._sorts.get(e)||this._sorts.set(e,new Batman.Object);return n.get(t)||n.set(t,new Batman.SetSort(this,e,t))};t.prototype.equality=Batman.SimpleHash.prototype.equality;t.prototype._indexOfItem=function(e){var t,n,r,i,s;s=this._storage;for(t=r=0,i=s.length;r<i;t=++r){n=s[t];if(this.equality(e,n)){return t}}return-1};return t}()}).call(this);(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};e=[];t=true;Batman.Property=function(n){function i(e,t){this.base=e;this.key=t}r(i,n);i._sourceTrackerStack=e;i._sourceTrackerStackValid=t;i.defaultAccessor={get:function(e){return this[e]},set:function(e,t){return this[e]=t},unset:function(e){var t;t=this[e];delete this[e];return t},cache:false};i.defaultAccessorForBase=function(e){var t;return((t=e._batman)!=null?t.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor};i.accessorForBaseAndKey=function(e,t){var n,r,i,s,o,u,a,f,l;if((i=e._batman)!=null){n=(u=i.keyAccessors)!=null?u.get(t):void 0;if(!n){a=i.ancestors();for(s=0,o=a.length;s<o;s++){r=a[s];n=(f=r._batman)!=null?(l=f.keyAccessors)!=null?l.get(t):void 0:void 0;if(n){break}}}}return n||this.defaultAccessorForBase(e)};i.forBaseAndKey=function(e,t){if(e.isObservable){return e.property(t)}else{return new Batman.Keypath(e,t)}};i.withoutTracking=function(e){return this.wrapTrackingPrevention(e)()};i.wrapTrackingPrevention=function(e){return function(){Batman.Property.pushDummySourceTracker();try{return e.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}};i.registerSource=function(n){var r;if(!(n.isEventEmitter||n instanceof Batman.Property)){return}if(t){r=e[e.length-1]}else{r=[];e.push(r);t=true}if(r!=null){r.push(n)}return void 0};i.pushSourceTracker=function(){if(t){return t=false}else{return e.push([])}};i.popSourceTracker=function(){if(t){return e.pop()}else{t=true;return void 0}};i.pushDummySourceTracker=function(){if(!t){e.push([]);t=true}return e.push(null)};i.prototype._isolationCount=0;i.prototype.cached=false;i.prototype.value=null;i.prototype.sources=null;i.prototype.isProperty=true;i.prototype.isDead=false;i.prototype.registerAsMutableSource=function(){return Batman.Property.registerSource(this)};i.prototype.isEqual=function(e){return this.constructor===e.constructor&&this.base===e.base&&this.key===e.key};i.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')};i.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))};i.prototype.eachObserver=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;r=this.key;n=(h=this.handlers)!=null?h.slice():void 0;if(n){for(o=0,f=n.length;o<f;o++){i=n[o];e(i)}}if(this.base.isObservable){p=this.base._batman.ancestors();for(u=0,l=p.length;u<l;u++){t=p[u];if(t.isObservable&&t.hasProperty(r)){s=t.property(r);n=(d=s.handlers)!=null?d.slice():void 0;if(n){for(a=0,c=n.length;a<c;a++){i=n[a];e(i)}}}}}};i.prototype.observers=function(){var e;e=[];this.eachObserver(function(t){return e.push(t)});return e};i.prototype.hasObservers=function(){return this.observers().length>0};i.prototype.updateSourcesFromTracker=function(){var e,t,n,r,i,s,o,u,a;t=this.constructor.popSourceTracker();e=this.sourceChangeHandler();if(this.sources){u=this.sources;for(r=0,s=u.length;r<s;r++){n=u[r];if(n!=null){if(n.on){n.off("change",e)}else{n.removeHandler(e)}}}}this.sources=t;if(this.sources){a=this.sources;for(i=0,o=a.length;i<o;i++){n=a[i];if(n!=null){if(n.on){n.on("change",e)}else{n.addHandler(e)}}}}return null};i.prototype.getValue=function(){this.registerAsMutableSource();if(!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor();this.cached=true}finally{this.updateSourcesFromTracker()}}return this.value};i.prototype.isCachable=function(){var e;if(this.isFinal()){return true}e=this.accessor().cache;if(e!=null){return!!e}else{return true}};i.prototype.isCached=function(){return this.isCachable()&&this.cached};i.prototype.isFinal=function(){return this.final||(this.final=!!this.accessor()["final"])};i.prototype.refresh=function(){var e,t;this.cached=false;e=this.value;t=this.getValue();if(t!==e&&!this.isIsolated()){this.fire(t,e,this.key)}if(this.value!==void 0&&this.isFinal()){return this.lockValue()}};i.prototype.sourceChangeHandler=function(){var e=this;this._sourceChangeHandler||(this._sourceChangeHandler=this._handleSourceChange.bind(this));Batman.developer["do"](function(){return e._sourceChangeHandler.property=e});return this._sourceChangeHandler};i.prototype._handleSourceChange=function(){if(this.isIsolated()){return this._needsRefresh=true}else if(this.isDead){return this._removeHandlers()}else if(!this.isFinal()&&!this.hasObservers()){this.cached=false;return this._removeHandlers()}else{return this.refresh()}};i.prototype.valueFromAccessor=function(){var e;return(e=this.accessor().get)!=null?e.call(this.base,this.key):void 0};i.prototype.setValue=function(e){var t;if(!(t=this.accessor().set)){return}return this._changeValue(function(){return t.call(this.base,this.key,e)})};i.prototype.unsetValue=function(){var e;if(!(e=this.accessor().unset)){return}return this._changeValue(function(){return e.call(this.base,this.key)})};i.prototype._changeValue=function(e){var t;this.cached=false;this.constructor.pushDummySourceTracker();try{t=e.apply(this);this.refresh()}finally{this.constructor.popSourceTracker()}if(!(this.isCached()||this.hasObservers())){this.die()}return t};i.prototype.forget=function(e){if(e!=null){return this.removeHandler(e)}else{return this.clearHandlers()}};i.prototype.observeAndFire=function(e){this.observe(e);return e.call(this.base,this.value,this.value,this.key)};i.prototype.observe=function(e){this.addHandler(e);if(this.sources==null){this.getValue()}return this};i.prototype.observeOnce=function(e){var t,n;n=this;t=function(){e.apply(this,arguments);return n.removeHandler(t)};this.addHandler(t);if(this.sources==null){this.getValue()}return this};i.prototype._removeHandlers=function(){var e,t,n,r,i;e=this.sourceChangeHandler();if(this.sources){i=this.sources;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.on){t.off("change",e)}else{t.removeHandler(e)}}}delete this.sources;return this.clearHandlers()};i.prototype.lockValue=function(){this._removeHandlers();this.getValue=function(){return this.value};return this.setValue=this.unsetValue=this.refresh=this.observe=function(){}};i.prototype.die=function(){var e,t;this._removeHandlers();if((e=this.base._batman)!=null){if((t=e.properties)!=null){t.unset(this.key)}}this.base=null;return this.isDead=true};i.prototype.isolate=function(){if(this._isolationCount===0){this._preIsolationValue=this.getValue()}return this._isolationCount++};i.prototype.expose=function(){if(this._isolationCount===1){this._isolationCount--;if(this._needsRefresh){this.value=this._preIsolationValue;this.refresh()}else if(this.value!==this._preIsolationValue){this.fire(this.value,this._preIsolationValue,this.key)}return this._preIsolationValue=null}else if(this._isolationCount>0){return this._isolationCount--}};i.prototype.isIsolated=function(){return this._isolationCount>0};return i}(Batman.PropertyEvent)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Keypath=function(e){function n(e,t){if(typeof t==="string"){this.segments=t.split(".");this.depth=this.segments.length}else{this.segments=[t];this.depth=1}n.__super__.constructor.apply(this,arguments)}t(n,e);n.prototype.isCachable=function(){if(this.depth===1){return n.__super__.isCachable.apply(this,arguments)}else{return true}};n.prototype.terminalProperty=function(){var e;e=Batman.getPath(this.base,this.segments.slice(0,-1));if(e==null){return}return Batman.Keypath.forBaseAndKey(e,this.segments[this.depth-1])};n.prototype.valueFromAccessor=function(){if(this.depth===1){return n.__super__.valueFromAccessor.apply(this,arguments)}else{return Batman.getPath(this.base,this.segments)}};n.prototype.setValue=function(e){var t;if(this.depth===1){return n.__super__.setValue.apply(this,arguments)}else{return(t=this.terminalProperty())!=null?t.setValue(e):void 0}};n.prototype.unsetValue=function(){var e;if(this.depth===1){return n.__super__.unsetValue.apply(this,arguments)}else{return(e=this.terminalProperty())!=null?e.unsetValue():void 0}};return n}(Batman.Property)}).call(this);(function(){var e=[].slice;Batman.Observable={isObservable:true,hasProperty:function(e){var t,n;return(t=this._batman)!=null?(n=t.properties)!=null?typeof n.hasKey==="function"?n.hasKey(e):void 0:void 0:void 0},property:function(e){var t,n,r;Batman.initializeObject(this);n=this.propertyClass||Batman.Keypath;t=(r=this._batman).properties||(r.properties=new Batman.SimpleHash);if(t.objectKey(e)){return t.getObject(e)||t.setObject(e,new n(this,e))}else{return t.getString(e)||t.setString(e,new n(this,e))}},get:function(e){return this.property(e).getValue()},set:function(e,t){return this.property(e).setValue(t)},unset:function(e){return this.property(e).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(e,t){var n;if(e){this.property(e).forget(t)}else{if((n=this._batman.properties)!=null){n.forEach(function(e,t){return t.forget()})}}return this},observe:function(){var t,n,r;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];(r=this.property(n)).observe.apply(r,t);return this},observeAndFire:function(){var t,n,r;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];(r=this.property(n)).observeAndFire.apply(r,t);return this},observeOnce:function(){var t,n,r;n=arguments[0],t=2<=arguments.length?e.call(arguments,1):[];(r=this.property(n)).observeOnce.apply(r,t);return this}}}).call(this);(function(){var e,t,n,r;Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(e){var t;return(t=document.getElementById(e))!=null?typeof t.scrollIntoView==="function"?t.scrollIntoView():void 0:void 0},setStyleProperty:function(e,t,n,r){if(e.style.setProperty){return e.style.setProperty(t,n,r)}else{return e.style.setAttribute(t,n,r)}},valueForNode:function(e,t,n){var r,i,s,o,u,a,f;if(t==null){t=""}if(n==null){n=true}i=arguments.length>1;s=e.nodeName.toUpperCase();switch(s){case"INPUT":case"TEXTAREA":if(i){return e.value=t}else{return e.value}break;case"SELECT":if(i){return e.value=t}else if(e.multiple){a=e.children;f=[];for(o=0,u=a.length;o<u;o++){r=a[o];if(r.selected){f.push(r.value)}}return f}else{return e.value}break;default:if(i){if(s==="OPTION"){e.text=t}return Batman.DOM.setInnerHTML(e,n?Batman.escapeHTML(t):t)}else{return e.innerHTML}}},nodeIsEditable:function(e){var t;return(t=e.nodeName.toUpperCase())==="INPUT"||t==="TEXTAREA"||t==="SELECT"},addEventListener:function(e,t,n){var r;if(!(r=Batman._data(e,"listeners"))){r=Batman._data(e,"listeners",{})}if(!r[t]){r[t]=[]}r[t].push(n);if(Batman.DOM.hasAddEventListener){return e.addEventListener(t,n,false)}else{return e.attachEvent("on"+t,n)}},removeEventListener:function(e,t,n){var r,i,s;if(s=Batman._data(e,"listeners")){if(r=s[t]){i=r.indexOf(n);if(i!==-1){r.splice(i,1)}}}if(Batman.DOM.hasAddEventListener){return e.removeEventListener(t,n,false)}else{return e.detachEvent("on"+t,n)}},cleanupNode:function(e){var t,n,r,i,s,o,u;if(i=Batman._data(e,"listeners")){for(r in i){n=i[r];n.forEach(function(t){return Batman.DOM.removeEventListener(e,r,t)})}}Batman.removeData(e,null,null,true);u=e.childNodes;for(s=0,o=u.length;s<o;s++){t=u[s];Batman.DOM.cleanupNode(t)}},hasAddEventListener:!!(typeof window!=="undefined"&&window!==null?window.addEventListener:void 0),preventDefault:function(e){if(typeof e.preventDefault==="function"){return e.preventDefault()}else{return e.returnValue=false}},stopPropagation:function(e){if(e.stopPropagation){return e.stopPropagation()}else{return e.cancelBubble=true}}};t=["querySelector","querySelectorAll","setInnerHTML","containsNode","destroyNode","textContent"];for(n=0,r=t.length;n<r;n++){e=t[n];Batman.DOM[e]=function(){return Batman.developer.error("Please include a platform adapter to define "+e+".")}}}).call(this);(function(){Batman.DOM.ReaderBindingDefinition=function(){function e(e,t,n){this.node=e;this.keyPath=t;this.view=n}return e}();Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"};Batman.DOM.readers={target:function(e){e.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node;return Batman.DOM.readers.bind(e)},source:function(e){e.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;return Batman.DOM.readers.bind(e)},bind:function(e){var t,n;n=e.node;switch(n.nodeName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":e.attr="checked";Batman.DOM.attrReaders.bind(e);return true;case"radio":t=Batman.DOM.RadioBinding;break;case"file":t=Batman.DOM.FileBinding}break;case"select":t=Batman.DOM.SelectBinding}t||(t=Batman.DOM.ValueBinding);return new t(e)},context:function(e){return new Batman.DOM.ContextBinding(e)},showif:function(e){return new Batman.DOM.ShowHideBinding(e)},hideif:function(e){e.invert=true;return new Batman.DOM.ShowHideBinding(e)},insertif:function(e){return new Batman.DOM.InsertionBinding(e)},removeif:function(e){e.invert=true;return new Batman.DOM.InsertionBinding(e)},renderif:function(e){return new Batman.DOM.DeferredRenderBinding(e)},route:function(e){return new Batman.DOM.RouteBinding(e)},view:function(e){return new Batman.DOM.ViewBinding(e)},partial:function(e){var t,n,r,i;n=e.node,t=e.keyPath,i=e.view;n.removeAttribute("data-partial");r=new Batman.View({source:t,parentNode:n,node:n});return{skipChildren:true,initialized:function(){r.loadView(n);return i.subviews.add(r)}}},defineview:function(e){var t,n,r;n=e.node,r=e.view,t=e.keyPath;Batman.View.store.set(Batman.Navigator.normalizePath(t),n.innerHTML);return{skipChildren:true,initialized:function(){if(n.parentNode){return n.parentNode.removeChild(n)}}}},contentfor:function(e){var t,n,r,i;r=e.node,n=e.keyPath,i=e.view;t=new Batman.View({html:r.innerHTML,contentFor:n});t.addToParentNode=function(e){e.innerHTML="";return e.appendChild(this.get("node"))};i.subviews.add(t);return{skipChildren:true,initialized:function(){if(r.parentNode){return r.parentNode.removeChild(r)}}}},yield:function(e){var t;t=Batman.DOM.Yield.withName(e.keyPath);t.set("containerNode",e.node);return{skipChildren:true}}}}).call(this);(function(){var e=[].slice,t=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};Batman.DOM.events={click:function(t,n,r,i,s){if(i==null){i="click"}if(s==null){s=true}Batman.DOM.addEventListener(t,i,function(){var o,u;u=arguments[0],o=2<=arguments.length?e.call(arguments,1):[];if(u.metaKey||u.ctrlKey||u.button===1){return}if(s){Batman.DOM.preventDefault(u)}if(!Batman.DOM.eventIsAllowed(i,u)){return}return n.apply(null,[t,u].concat(e.call(o),[r]))});if(t.nodeName.toUpperCase()==="A"&&!t.href){t.href="#"}return t},doubleclick:function(e,t,n){return Batman.DOM.events.click(e,t,n,"dblclick")},change:function(n,r,i){var s,o,u,a,f;o=function(){var e;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":if(e=n.type.toLowerCase(),t.call(Batman.DOM.textInputTypes,e)>=0){u=r;r=function(e,t,n){if(t.type==="keyup"&&Batman.DOM.events.isEnter(t)){return}return u(e,t,n)};return["input","keyup","change"]}else{return["input","change"]}break;default:return["change"]}}();for(a=0,f=o.length;a<f;a++){s=o[a];Batman.DOM.addEventListener(n,s,function(){var t;t=1<=arguments.length?e.call(arguments,0):[];return r.apply(null,[n].concat(e.call(t),[i]))})}},isEnter:function(e){var t,n;return 13<=(t=e.keyCode)&&t<=14||13<=(n=e.which)&&n<=14||e.keyIdentifier==="Enter"||e.key==="Enter"},submit:function(t,n,r){if(Batman.DOM.nodeIsEditable(t)){Batman.DOM.addEventListener(t,"keydown",function(){var n;n=1<=arguments.length?e.call(arguments,0):[];if(Batman.DOM.events.isEnter(n[0])){return Batman.DOM._keyCapturingNode=t}});Batman.DOM.addEventListener(t,"keyup",function(){var i;i=1<=arguments.length?e.call(arguments,0):[];if(Batman.DOM.events.isEnter(i[0])){if(Batman.DOM._keyCapturingNode===t){Batman.DOM.preventDefault(i[0]);n.apply(null,[t].concat(e.call(i),[r]))}return Batman.DOM._keyCapturingNode=null}})}else{Batman.DOM.addEventListener(t,"submit",function(){var i;i=1<=arguments.length?e.call(arguments,0):[];Batman.DOM.preventDefault(i[0]);return n.apply(null,[t].concat(e.call(i),[r]))})}return t},other:function(t,n,r,i){return Batman.DOM.addEventListener(t,n,function(){var n;n=1<=arguments.length?e.call(arguments,0):[];return r.apply(null,[t].concat(e.call(n),[i]))})}};Batman.DOM.eventIsAllowed=function(e,t){var n,r,i;if(n=(r=Batman.currentApp)!=null?(i=r.shouldAllowEvent)!=null?i[e]:void 0:void 0){if(n(t)===false){return false}}return true}}).call(this);(function(){Batman.DOM.AttrReaderBindingDefinition=function(){function e(e,t,n,r){this.node=e;this.attr=t;this.keyPath=n;this.view=r}return e}();Batman.DOM.attrReaders={_parseAttribute:function(e){if(e==="false"){e=false}if(e==="true"){e=true}return e},source:function(e){e.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;return Batman.DOM.attrReaders.bind(e)},bind:function(e){var t;t=function(){switch(e.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}();return new t(e)},context:function(e){return new Batman.DOM.ContextBinding(e)},event:function(e){return new Batman.DOM.EventBinding(e)},addclass:function(e){return new Batman.DOM.AddClassBinding(e)},removeclass:function(e){e.invert=true;return new Batman.DOM.AddClassBinding(e)},foreach:function(e){return new Batman.DOM.IteratorBinding(e)},formfor:function(e){return new Batman.DOM.FormBinding(e)},style:function(e){return new Batman.DOM.StyleAttributeBinding(e)}}}).call(this);(function(){var e,t,n,r,i,s=[].slice,o={}.hasOwnProperty,u=function(e,t){function r(){this.constructor=e}for(var n in t){if(o.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};n=function(e,t){var n,r,i,s;if(typeof t==="function"){t={get:t}}s=["cachable","cacheable"];for(r=0,i=s.length;r<i;r++){n=s[r];if(n in t){Batman.developer.warn('Property accessor option "'+n+'" is deprecated. Use "cache" instead.');if(!("cache"in t)){t.cache=t[n]}}}return t};r=function(e){return function(t){return{get:function(n){var r,i,s,o,u,a=this;if((i=t.get.apply(this,arguments))!=null){return i}r=false;s=void 0;if((o=this._batman).promises==null){o.promises={}}if((u=this._batman.promises)[n]==null){u[n]=function(){var t,i;t=function(e,t){if(r){a.set(n,t)}return s=t};i=e.call(a,t,n);if(s==null){s=i}return true}()}r=true;return s},cache:true}}};i=function(e,t){var n,r;t=(typeof t==="function"?t(e):void 0)||t;for(n in e){r=e[n];if(!(n in t)){t[n]=r}}return t};t={_defineAccessor:function(){var e,t,i,o,u,a,f,l;i=2<=arguments.length?s.call(arguments,0,u=arguments.length-1):(u=0,[]),e=arguments[u++];if(e==null){return Batman.Property.defaultAccessorForBase(this)}else if(i.length===0&&(l=Batman.typeOf(e))!=="Object"&&l!=="Function"){return Batman.Property.accessorForBaseAndKey(this,e)}else if(typeof e.promise==="function"){return this._defineWrapAccessor.apply(this,s.call(i).concat([r(e.promise)]))}Batman.initializeObject(this);if(i.length===0){this._batman.defaultAccessor=n(this,e)}else{(o=this._batman).keyAccessors||(o.keyAccessors=new Batman.SimpleHash);for(a=0,f=i.length;a<f;a++){t=i[a];this._batman.keyAccessors.set(t,n(this,e))}}return true},_defineWrapAccessor:function(){var e,t,n,r,o,u;t=2<=arguments.length?s.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++];Batman.initializeObject(this);if(t.length===0){this._defineAccessor(i(this._defineAccessor(),n))}else{for(o=0,u=t.length;o<u;o++){e=t[o];this._defineAccessor(e,i(this._defineAccessor(e),n))}}return true},_resetPromises:function(){var e;if(this._batman.promises==null){return}for(e in this._batman.promises){this._resetPromise(e)}},_resetPromise:function(e){this.unset(e);this.property(e).cached=false;delete this._batman.promises[e]}};e=function(e){function r(){var e;e=1<=arguments.length?s.call(arguments,0):[];this._batman=new Batman._Batman(this);this.mixin.apply(this,e)}var n;u(r,e);Batman.initializeObject(r);Batman.initializeObject(r.prototype);Batman.mixin(r.prototype,t,Batman.EventEmitter,Batman.Observable);Batman.mixin(r,t,Batman.EventEmitter,Batman.Observable);r.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(s.call(arguments)))};r.mixin=function(){return this.classMixin.apply(this.prototype,arguments)};r.prototype.mixin=r.classMixin;r.classAccessor=r._defineAccessor;r.accessor=function(){var e;return(e=this.prototype)._defineAccessor.apply(e,arguments)};r.prototype.accessor=r._defineAccessor;r.wrapClassAccessor=r._defineWrapAccessor;r.wrapAccessor=function(){var e;return(e=this.prototype)._defineWrapAccessor.apply(e,arguments)};r.prototype.wrapAccessor=r._defineWrapAccessor;r.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)};r.singleton=function(e){if(e==null){e="sharedInstance"}return this.classAccessor(e,{get:function(){var t;return this[t="_"+e]||(this[t]=new this)}})};r.accessor("_batmanID",function(){return this._batmanID()});n=0;r.prototype._batmanID=function(){var e;this._batman.check(this);if((e=this._batman).id==null){e.id=n++}return this._batman.id};r.prototype.hashKey=function(){var e;if(typeof this.isEqual==="function"){return}return(e=this._batman).hashKey||(e.hashKey="<Batman.Object "+this._batmanID()+">")};r.prototype.toJSON=function(){var e,t,n;t={};for(e in this){if(!o.call(this,e))continue;n=this[e];if(e!=="_batman"&&e!=="hashKey"&&e!=="_batmanID"){t[e]=(n!=null?n.toJSON:void 0)?n.toJSON():n}}return t};return r}(Object);Batman.Object=e}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.BindingParser=function(e){function f(e){this.view=e;f.__super__.constructor.call(this);this.node=this.view.node;this.parseTree(this.node)}var n,r,i,s,o,u,a;t(f,e);n=["defineview","foreach","renderif","view","formfor","context","bind","source","target"];o=["foreach","renderif","formfor","context"];r={};for(s=u=0,a=n.length;u<a;s=++u){i=n[s];r[i]=s}f.prototype._sortBindings=function(e,t){var i,s;i=r[e[0]];s=r[t[0]];if(i==null){i=n.length}if(s==null){s=n.length}if(i>s){return 1}else if(s>i){return-1}else if(e[0]>t[0]){return 1}else if(t[0]>e[0]){return-1}else{return 0}};f.prototype.parseTree=function(e){var t;while(e){t=this.parseNode(e);e=this.nextNode(e,t)}this.fire("bindingsInitialized")};f.prototype.parseNode=function(e){var t,n,r,s,u,a,f,l,c,h,p,d,v,m,g,y,b,w;l=false;if(e.getAttribute&&e.attributes){f=[];g=e.attributes;for(p=0,v=g.length;p<v;p++){r=g[p];if(((y=r.nodeName)!=null?y.substr(0,5):void 0)!=="data-"){continue}i=r.nodeName.substr(5);n=i.indexOf("-");f.push(n!==-1?[i.substr(0,n),i.substr(n+1),r.value]:[i,void 0,r.value])}b=f.sort(this._sortBindings);for(d=0,m=b.length;d<m;d++){w=b[d],i=w[0],t=w[1],h=w[2];if(l&&o.indexOf(i)===-1){continue}u=t?(c=Batman.DOM.attrReaders[i])?(a=new Batman.DOM.AttrReaderBindingDefinition(e,t,h,this.view),c(a)):void 0:(c=Batman.DOM.readers[i])?(a=new Batman.DOM.ReaderBindingDefinition(e,h,this.view),c(a)):void 0;if(u!=null?u.initialized:void 0){this.once("bindingsInitialized",function(e){return function(){return e.initialized.call(e)}}(u))}if(u!=null?u.skipChildren:void 0){return true}if(u!=null?u.backWithView:void 0){l=true}}}if(l&&(s=Batman._data(e,"view"))){s.initializeBindings()}return l};f.prototype.nextNode=function(e,t){var n,r,i,s;if(!t){n=e.childNodes;if(n!=null?n.length:void 0){return n[0]}}s=e.nextSibling;if(this.node===e){return}if(s){return s}r=e;while(r=r.parentNode){i=r.nextSibling;if(this.node===r){return}if(i){return i}}};return f}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.ValidationError=function(e){function n(e,t){n.__super__.constructor.call(this,{attribute:e,message:t})}t(n,e);n.accessor("fullMessage",function(){if(this.attribute==="base"){return Batman.t("errors.base.format",{message:this.message})}else{return Batman.t("errors.format",{attribute:Batman.helpers.humanize(this.attribute),message:this.message})}});return n}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.StorageAdapter=function(e){function r(e){var t;r.__super__.constructor.call(this,{model:e});t=this.constructor;if(t.ModelMixin){Batman.extend(e,t.ModelMixin)}if(t.RecordMixin){Batman.extend(e.prototype,t.RecordMixin)}}t(r,e);r.StorageError=function(e){function n(e){n.__super__.constructor.apply(this,arguments);this.message=e}t(n,e);n.prototype.name="StorageError";return n}(Error);r.RecordExistsError=function(e){function n(e){n.__super__.constructor.call(this,e||"Can't create this record because it already exists in the store!")}t(n,e);n.prototype.name="RecordExistsError";return n}(r.StorageError);r.NotFoundError=function(e){function n(e){n.__super__.constructor.call(this,e||"Record couldn't be found in storage!")}t(n,e);n.prototype.name="NotFoundError";return n}(r.StorageError);r.NotAllowedError=function(e){function n(e){n.__super__.constructor.call(this,e||"Storage operation denied access to the operation!")}t(n,e);n.prototype.name="NotAllowedError";return n}(r.StorageError);r.NotAcceptableError=function(e){function n(e){n.__super__.constructor.call(this,e||"Storage operation permitted but the request was malformed!")}t(n,e);n.prototype.name="NotAcceptableError";return n}(r.StorageError);r.UnprocessableRecordError=function(e){function n(e){n.__super__.constructor.call(this,e||"Storage adapter could not process the record!")}t(n,e);n.prototype.name="UnprocessableRecordError";return n}(r.StorageError);r.InternalStorageError=function(e){function n(e){n.__super__.constructor.call(this,e||"An error occurred during the storage operation!")}t(n,e);n.prototype.name="InternalStorageError";return n}(r.StorageError);r.NotImplementedError=function(e){function n(e){n.__super__.constructor.call(this,e||"This operation is not implemented by the storage adapter!")}t(n,e);n.prototype.name="NotImplementedError";return n}(r.StorageError);r.prototype.isStorageAdapter=true;r.prototype.storageKey=function(e){var t;t=(e!=null?e.constructor:void 0)||this.model;return t.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(t.get("resourceName")))};r.prototype.getRecordFromData=function(e,t){if(t==null){t=this.model}return t._makeOrFindRecordFromData(e)};r.prototype.getRecordsFromData=function(e,t){if(t==null){t=this.model}return t._makeOrFindRecordsFromData(e)};r.skipIfError=function(e){return function(t,n){if(t.error!=null){return n()}else{return e.call(this,t,n)}}};r.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))};r.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))};r.prototype._inheritFilters=function(){var e,t,n,r,i;if(!this._batman.check(this)||!this._batman.filters){r=this._batman.getFirst("filters");this._batman.filters={before:{},after:{}};if(r!=null){for(i in r){e=r[i];for(n in e){t=e[n];this._batman.filters[i][n]=t.slice(0)}}}}return true};r.prototype._addFilter=function(){var e,t,r,i,s,o,u,a;i=arguments[0],r=3<=arguments.length?n.call(arguments,1,o=arguments.length-1):(o=1,[]),e=arguments[o++];this._inheritFilters();for(u=0,a=r.length;u<a;u++){t=r[u];(s=this._batman.filters[i])[t]||(s[t]=[]);this._batman.filters[i][t].push(e)}return true};r.prototype.runFilter=function(e,t,n,r){var i,s,o,u,a=this;this._inheritFilters();s=this._batman.filters[e].all||[];i=this._batman.filters[e][t]||[];n.action=t;o=e==="before"?i.concat(s):s.concat(i);u=function(e){var t;if(e!=null){n=e}if((t=o.shift())!=null){return t.call(a,n,u)}else{return r.call(a,n)}};return u()};r.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))};r.prototype.runAfterFilter=function(e,t,n){return this.runFilter("after",e,t,this.exportResult(n))};r.prototype.exportResult=function(e){return function(t){return e(t.error,t.result,t)}};r.prototype._jsonToAttributes=function(e){return JSON.parse(e)};r.prototype.perform=function(e,t,n,r){var i,s,o=this;n||(n={});i={options:n,subject:t};s=function(t){if(t!=null){i=t}return o.runAfterFilter(e,i,r)};this.runBeforeFilter(e,i,function(t){return this[e](t,s)});return void 0};return r}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice,r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1};Batman.RestStorage=function(e){function l(){l.__super__.constructor.apply(this,arguments);this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var i,s,o,u,a,f=this;t(l,e);l.CommunicationError=function(e){function n(e){n.__super__.constructor.call(this,e||"A communication error has occurred!")}t(n,e);n.prototype.name="CommunicationError";return n}(l.StorageError);l.JSONContentType="application/json";l.PostBodyContentType="application/x-www-form-urlencoded";l.BaseMixin={request:function(e,t,n){if(!n){n=t;t={}}t.method||(t.method="GET");t.action=e;return this._doStorageOperation(t.method.toLowerCase(),t,n)}};l.ModelMixin=Batman.extend({},l.BaseMixin,{urlNestsUnder:function(){var e,t,r,i,s;t=1<=arguments.length?n.call(arguments,0):[];r={};for(i=0,s=t.length;i<s;i++){e=t[i];r[e+"_id"]=Batman.helpers.pluralize(e)}this.url=function(t){var n,i,s;n=Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(e in r){s=r[e];i=t.data[e];if(i){delete t.data[e];return""+s+"/"+i+"/"+n}}return n};return this.prototype.url=function(){var t,n,i,s,o;t=Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(e in r){s=r[e];i=this.get("dirtyKeys").get(e);if(i===void 0){i=this.get(e)}if(i){o=""+s+"/"+i+"/"+t;break}}o||(o=t);if(n=this.get("id")){o+="/"+n}return o}}});l.RecordMixin=Batman.extend({},l.BaseMixin);l.prototype.defaultRequestOptions={type:"json"};l.prototype._implicitActionNames=["create","read","update","destroy","readAll"];l.prototype.serializeAsForm=true;l.prototype.recordJsonNamespace=function(e){return Batman.helpers.singularize(this.storageKey(e))};l.prototype.collectionJsonNamespace=function(e){return Batman.helpers.pluralize(this.storageKey(e.prototype))};l.prototype._execWithOptions=function(e,t,n,r){if(r==null){r=e}if(typeof e[t]==="function"){return e[t].call(r,n)}else{return e[t]}};l.prototype._defaultCollectionUrl=function(e){return""+this.storageKey(e.prototype)};l.prototype._addParams=function(e,t){var n;if(t&&t.action&&!(n=t.action,r.call(this._implicitActionNames,n)>=0)){e+="/"+t.action.toLowerCase()}return e};l.prototype._addUrlAffixes=function(e,t,n){var r,i;i=[e,this.urlSuffix(t,n)];if(e.charAt(0)!=="/"){r=this.urlPrefix(t,n);if(r.charAt(r.length-1)!=="/"){i.unshift("/")}i.unshift(r)}return i.join("")};l.prototype.urlPrefix=function(e,t){return this._execWithOptions(e,"urlPrefix",t.options)||""};l.prototype.urlSuffix=function(e,t){return this._execWithOptions(e,"urlSuffix",t.options)||""};l.prototype.urlForRecord=function(e,t){var n,r,i;if((i=t.options)!=null?i.recordUrl:void 0){r=this._execWithOptions(t.options,"recordUrl",t.options,e)}else if(e.url){r=this._execWithOptions(e,"url",t.options)}else{r=e.constructor.url?this._execWithOptions(e.constructor,"url",t.options):this._defaultCollectionUrl(e.constructor);if(t.action!=="create"){if((n=e.get("id"))!=null){r=r+"/"+n}else{throw new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!")}}}return this._addUrlAffixes(this._addParams(r,t.options),e,t)};l.prototype.urlForCollection=function(e,t){var n,r;n=((r=t.options)!=null?r.collectionUrl:void 0)?this._execWithOptions(t.options,"collectionUrl",t.options,t.options.urlContext):e.url?this._execWithOptions(e,"url",t.options):this._defaultCollectionUrl(e,t.options);return this._addUrlAffixes(this._addParams(n,t.options),e,t)};l.prototype.request=function(e,t){var n;n=Batman.extend(e.options,{autosend:false,success:function(t){return e.data=t},error:function(t){return e.error=t},loaded:function(){e.response=e.request.get("response");return t()}});e.request=new Batman.Request(n);return e.request.send()};l.prototype.perform=function(e,t,n,r){n||(n={});Batman.extend(n,this.defaultRequestOptions);return l.__super__.perform.call(this,e,t,n,r)};l.prototype.before("all",l.skipIfError(function(e,t){var n;if(!e.options.url){try{e.options.url=e.subject.prototype?this.urlForCollection(e.subject,e):this.urlForRecord(e.subject,e)}catch(r){n=r;e.error=n}}return t()}));l.prototype.before("get","put","post","delete",l.skipIfError(function(e,t){e.options.method=e.action.toUpperCase();return t()}));l.prototype.before("create","update",l.skipIfError(function(e,t){var n,r,i;r=e.subject.toJSON();if(i=this.recordJsonNamespace(e.subject)){n={};n[i]=r}else{n=r}e.options.data=n;return t()}));l.prototype.before("create","update","put","post",l.skipIfError(function(e,t){if(this.serializeAsForm){e.options.contentType=this.constructor.PostBodyContentType}else{if(e.options.data!=null){e.options.data=JSON.stringify(e.options.data);e.options.contentType=this.constructor.JSONContentType}}return t()}));l.prototype.after("all",l.skipIfError(function(e,t){var n,r;if(e.data==null){return t()}if(typeof e.data==="string"){if(e.data.length>0){try{r=this._jsonToAttributes(e.data)}catch(i){n=i;e.error=n;return t()}}}else if(typeof e.data==="object"){r=e.data}if(r!=null){e.json=r}return t()}));l.prototype.extractFromNamespace=function(e,t){if(t&&e[t]!=null){return e[t]}else{return e}};l.prototype.after("create","read","update",l.skipIfError(function(e,t){var n;if(e.json!=null){n=this.extractFromNamespace(e.json,this.recordJsonNamespace(e.subject));e.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})}e.result=e.subject;return t()}));l.prototype.after("readAll",l.skipIfError(function(e,t){var n;n=this.collectionJsonNamespace(e.subject);e.recordsAttributes=this.extractFromNamespace(e.json,n);if(Batman.typeOf(e.recordsAttributes)!=="Array"){n=this.recordJsonNamespace(e.subject.prototype);e.recordsAttributes=[this.extractFromNamespace(e.json,n)]}e.result=e.records=this.getRecordsFromData(e.recordsAttributes,e.subject);return t()}));l.prototype.after("get","put","post","delete",l.skipIfError(function(e,t){var n;if(e.json!=null){n=e.subject.prototype?this.collectionJsonNamespace(e.subject):this.recordJsonNamespace(e.subject);e.result=this.extractFromNamespace(e.json,n)}return t()}));l.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"};a=["create","read","update","destroy","readAll","get","post","put","delete"];s=function(e){return l.prototype[e]=l.skipIfError(function(t,n){var r;(r=t.options).method||(r.method=this.constructor.HTTPMethods[e]);return this.request(t,n)})};for(o=0,u=a.length;o<u;o++){i=a[o];s(i)}l.prototype.after("all",function(e,t){if(e.error){e.error=this._errorFor(e.error,e)}return t()});l._statusCodeErrors={0:l.CommunicationError,403:l.NotAllowedError,404:l.NotFoundError,406:l.NotAcceptableError,409:l.RecordExistsError,422:l.UnprocessableRecordError,500:l.InternalStorageError,501:l.NotImplementedError};l.prototype._errorFor=function(e,t){var n,r;if(e instanceof Error||e.request==null){return e}if(n=this.constructor._statusCodeErrors[e.request.status]){r=e.request;e=new n;e.request=r;e.env=t}return e};return l}.call(this,Batman.StorageAdapter)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.LocalStorage=function(e){function n(){if(typeof window.localStorage==="undefined"){return null}n.__super__.constructor.apply(this,arguments);this.storage=localStorage}t(n,e);n.prototype.storageRegExpForRecord=function(e){return new RegExp("^"+this.storageKey(e)+"(\\d+)$")};n.prototype.nextIdForRecord=function(e){var t,n;n=this.storageRegExpForRecord(e);t=1;this._forAllStorageEntries(function(e,r){var i;if(i=n.exec(e)){return t=Math.max(t,parseInt(i[1],10)+1)}});return t};n.prototype._forAllStorageEntries=function(e){var t,n,r,i;for(t=r=0,i=this.storage.length;0<=i?r<i:r>i;t=0<=i?++r:--r){n=this.storage.key(t);e.call(this,n,this.storage.getItem(n))}return true};n.prototype._storageEntriesMatching=function(e,t){var n,r;n=this.storageRegExpForRecord(e.prototype);r=[];this._forAllStorageEntries(function(i,s){var o,u;if(u=n.exec(i)){o=this._jsonToAttributes(s);o[e.primaryKey]=u[1];if(this._dataMatches(t,o)){return r.push(o)}}});return r};n.prototype._dataMatches=function(e,t){var n,r,i;r=true;for(n in e){i=e[n];if(t[n]!==i){r=false;break}}return r};n.prototype.before("read","create","update","destroy",n.skipIfError(function(e,t){var n=this;if(e.action==="create"){e.id=e.subject.get("id")||e.subject._withoutDirtyTracking(function(){return e.subject.set("id",n.nextIdForRecord(e.subject))})}else{e.id=e.subject.get("id")}if(e.id==null){e.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!")}else{e.key=this.storageKey(e.subject)+e.id}return t()}));n.prototype.before("create","update",n.skipIfError(function(e,t){e.recordAttributes=JSON.stringify(e.subject);return t()}));n.prototype.after("read",n.skipIfError(function(e,t){var n;if(typeof e.recordAttributes==="string"){try{e.recordAttributes=this._jsonToAttributes(e.recordAttributes)}catch(r){n=r;e.error=n;return t()}}e.subject._withoutDirtyTracking(function(){return this.fromJSON(e.recordAttributes)});return t()}));n.prototype.after("read","create","update","destroy",n.skipIfError(function(e,t){e.result=e.subject;return t()}));n.prototype.after("readAll",n.skipIfError(function(e,t){e.result=e.records=this.getRecordsFromData(e.recordsAttributes,e.subject);return t()}));n.prototype.read=n.skipIfError(function(e,t){e.recordAttributes=this.storage.getItem(e.key);if(!e.recordAttributes){e.error=new this.constructor.NotFoundError}return t()});n.prototype.create=n.skipIfError(function(e,t){var n,r;n=e.key,r=e.recordAttributes;if(this.storage.getItem(n)){arguments[0].error=new this.constructor.RecordExistsError}else{this.storage.setItem(n,r)}return t()});n.prototype.update=n.skipIfError(function(e,t){var n,r;n=e.key,r=e.recordAttributes;this.storage.setItem(n,r);return t()});n.prototype.destroy=n.skipIfError(function(e,t){var n;n=e.key;this.storage.removeItem(n);return t()});n.prototype.readAll=n.skipIfError(function(e,t){var n;try{arguments[0].recordsAttributes=this._storageEntriesMatching(e.subject,e.options.data)}catch(r){n=r;arguments[0].error=n}return t()});return n}(Batman.StorageAdapter)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.SessionStorage=function(e){function n(){if(typeof window.sessionStorage==="undefined"){return null}n.__super__.constructor.apply(this,arguments);this.storage=sessionStorage}t(n,e);return n}(Batman.LocalStorage)}).call(this);(function(){Batman.Encoders=new Batman.Object}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.ParamsReplacer=function(e){function n(e,t){this.navigator=e;this.params=t}t(n,e);n.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),true)};n.prototype.replace=function(e){this.params.replace(e);return this.redirect()};n.prototype.update=function(e){this.params.update(e);return this.redirect()};n.prototype.clear=function(){this.params.clear();return this.redirect()};n.prototype.toObject=function(){return this.params.toObject()};n.accessor({get:function(e){return this.params.get(e)},set:function(e,t){var n,r;n=this.params.get(e);r=this.params.set(e,t);if(n!==t){this.redirect()}return r},unset:function(e){var t,n;t=this.params.hasKey(e);n=this.params.unset(e);if(t){this.redirect()}return n}});return n}(Batman.Object)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.ParamsPusher=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.redirect=function(){return this.navigator.redirect(this.toObject())};return r}(Batman.ParamsReplacer)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.NamedRouteQuery=function(e){function n(e,t){var r;if(t==null){t=[]}n.__super__.constructor.call(this,{routeMap:e,args:t});for(r in this.get("routeMap").childrenByName){this[r]=this._queryAccess.bind(this,r)}}t(n,e);n.prototype.isNamedRouteQuery=true;n.accessor("route",function(){var e,t,n,r,i,s,o;s=this.get("routeMap"),t=s.memberRoute,e=s.collectionRoute;o=[t,e];for(r=0,i=o.length;r<i;r++){n=o[r];if(n!=null){if(n.namedArguments.length===this.get("args").length){return n}}}return e||t});n.accessor("path",function(){return this.path()});n.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor);n.accessor({get:function(e){if(e==null){return}if(typeof e==="string"){return this.nextQueryForName(e)}else{return this.nextQueryWithArgument(e)}},cache:false});n.accessor("withHash",function(){var e=this;return new Batman.Accessible(function(t){return e.withHash(t)})});n.prototype.withHash=function(e){var t;t=this.clone();t.set("hashValue",e);return t};n.prototype.nextQueryForName=function(e){var t;if(t=this.get("routeMap").childrenByName[e]){return new Batman.NamedRouteQuery(t,this.args)}else{return Batman.developer.error("Couldn't find a route for the name "+e+"!")}};n.prototype.nextQueryWithArgument=function(e){var t;t=this.args.slice(0);t.push(e);return this.clone(t)};n.prototype.path=function(){var e,t,n,r,i,s,o;i={};r=this.get("route.namedArguments");for(n=s=0,o=r.length;s<o;n=++s){e=r[n];if((t=this.get("args")[n])!=null){i[e]=this._toParam(t)}}if(this.get("hashValue")!=null){i["#"]=this.get("hashValue")}return this.get("route").pathFromParams(i)};n.prototype.toString=function(){return this.path()};n.prototype.clone=function(e){if(e==null){e=this.args}return new Batman.NamedRouteQuery(this.routeMap,e)};n.prototype._toParam=function(e){if(e instanceof Batman.AssociationProxy){e=e.get("target")}if((e!=null?e.toParam:void 0)!=null){return e.toParam()}else{return e}};n.prototype._queryAccess=function(e,t){var n;n=this.nextQueryForName(e);if(t!=null){n=n.nextQueryWithArgument(t)}return n};return n}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Dispatcher=function(e){function i(e,t){i.__super__.constructor.call(this,{app:e,routeMap:t})}var n,r;t(i,e);i.canInferRoute=function(e){return e instanceof Batman.Model||e instanceof Batman.AssociationProxy||e.prototype instanceof Batman.Model};i.paramsFromArgument=function(e){var t;t=function(e){return Batman.helpers.camelize(Batman.helpers.pluralize(e.get("resourceName")),true)};if(!this.canInferRoute(e)){return e}if(e instanceof Batman.Model||e instanceof Batman.AssociationProxy){if(e.isProxy){e=e.get("target")}if(e!=null){return{controller:t(e.constructor),action:"show",id:e.get("id")}}else{return{}}}else if(e.prototype instanceof Batman.Model){return{controller:t(e),action:"index"}}else{return e}};n=function(e){function n(){r=n.__super__.constructor.apply(this,arguments);return r}t(n,e);n.accessor("__app",Batman.Property.defaultAccessor);n.accessor(function(e){return this.get("__app."+Batman.helpers.capitalize(e)+"Controller.sharedController")});return n}(Batman.Object);i.accessor("controllers",function(){return new n({__app:this.get("app")})});i.prototype.routeForParams=function(e){e=this.constructor.paramsFromArgument(e);return this.get("routeMap").routeForParams(e)};i.prototype.pathFromParams=function(e){var t;if(typeof e==="string"){return e}e=this.constructor.paramsFromArgument(e);return(t=this.routeForParams(e))!=null?t.pathFromParams(e):void 0};i.prototype.dispatch=function(e,t){var n,r,i,s,o,u;r=this.constructor.paramsFromArgument(e);s=this.routeForParams(r);if(s){o=s.pathAndParamsFromArgument(r),i=o[0],e=o[1];if(t){Batman.mixin(e,t)}this.set("app.currentRoute",s);this.set("app.currentURL",i);this.get("app.currentParams").replace(e||{});s.dispatch(e)}else{if(Batman.typeOf(e)==="Object"&&!this.constructor.canInferRoute(e)){return this.get("app.currentParams").replace(e)}else{this.get("app.currentParams").clear()}n={type:"404",isPrevented:false,preventDefault:function(){return this.isPrevented=true}};if((u=Batman.currentApp)!=null){u.fire("error",n)}if(n.isPrevented){return e}if(e!=="/404"){return Batman.redirect("/404")}}return i};return i}.call(this,Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Route=function(e){function n(e,t){var r,i,s,o,u,a,f,l,c,h;f=this.constructor.regexps;if(e.indexOf("/")!==0){e="/"+e}o=e.replace(f.escapeRegExp,"\\$&");a=RegExp("^"+o.replace(f.openOptParam,"(?:").replace(f.closeOptParam,")?").replace(f.namedParam,"([^/]+)").replace(f.splatParam,"(.*?)")+f.queryParam+"$");f.namedOrSplat.lastIndex=0;s=function(){var e;e=[];while(i=f.namedOrSplat.exec(o)){e.push(i[1])}return e}();u={templatePath:e,pattern:o,regexp:a,namedArguments:s,baseParams:t};h=this.optionKeys;for(l=0,c=h.length;l<c;l++){r=h[l];u[r]=t[r];delete t[r]}n.__super__.constructor.call(this,u)}t(n,e);n.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g};n.prototype.optionKeys=["member","collection"];n.prototype.testKeys=["controller","action"];n.prototype.isRoute=true;n.prototype.paramsFromPath=function(e){var t,n,r,i,s,o,u,a,f;u=new Batman.URI(e);s=this.get("namedArguments");o=Batman.extend({path:u.path},this.get("baseParams"));r=this.get("regexp").exec(u.path).slice(1);for(t=a=0,f=r.length;a<f;t=++a){n=r[t];i=s[t];o[i]=n}return Batman.extend(o,u.queryParams)};n.prototype.pathFromParams=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;s=Batman.extend({},e);o=this.get("templatePath");f=this.constructor.regexps;d=this.get("namedArguments");for(l=0,h=d.length;l<h;l++){r=d[l];a=RegExp(""+f.namePrefix+r);i=o.replace(a,s[r]!=null?s[r]:"");if(i!==o){delete s[r];o=i}}o=o.replace(f.openOptParam,"").replace(f.closeOptParam,"").replace(/([^\/])\/+$/,"$1");v=this.testKeys;for(c=0,p=v.length;c<p;c++){n=v[c];delete s[n]}if(s["#"]){t=s["#"];delete s["#"]}u=Batman.URI.queryFromParams(s);if(u){o+="?"+u}if(t){o+="#"+t}return o};n.prototype.test=function(e){var t,n,r,i,s,o;if(typeof e==="string"){n=e}else if(e.path!=null){n=e.path}else{n=this.pathFromParams(e);o=this.testKeys;for(i=0,s=o.length;i<s;i++){t=o[i];if((r=this.get(t))!=null){if(e[t]!==r){return false}}}}return this.get("regexp").test(n)};n.prototype.pathAndParamsFromArgument=function(e){var t,n;if(typeof e==="string"){t=this.paramsFromPath(e);n=e}else{t=e;n=this.pathFromParams(e)}return[n,t]};n.prototype.dispatch=function(e){if(!this.test(e)){return false}return this.get("callback")(e)};n.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")};return n}(Batman.Object)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.ControllerActionRoute=function(t){function r(t,n){this.callback=e(this.callback,this);var i,s,o;if(n.signature){o=n.signature.split("#"),s=o[0],i=o[1];i||(i="index");n.controller=s;n.action=i;delete n.signature}r.__super__.constructor.call(this,t,n)}n(r,t);r.prototype.optionKeys=["member","collection","app","controller","action"];r.prototype.callback=function(e){var t;t=this.get("app.dispatcher.controllers."+this.get("controller"));return t.dispatch(this.get("action"),e)};return r}(Batman.Route)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.CallbackActionRoute=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.optionKeys=["member","collection","callback","app"];r.prototype.controller=false;r.prototype.action=false;return r}(Batman.Route)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Hash=function(e){function c(){this.meta=new this.constructor.Metadata(this);Batman.SimpleHash.apply(this,arguments);c.__super__.constructor.apply(this,arguments)}var n,r,i,s,o,u,a,f,l=this;t(c,e);c.Metadata=function(e){function n(e){this.hash=e}t(n,e);Batman.extend(n.prototype,Batman.Enumerable);n.accessor("length",function(){this.hash.registerAsMutableSource();return this.hash.length});n.accessor("isEmpty","keys","toArray",function(e){this.hash.registerAsMutableSource();return this.hash[e]()});n.prototype.forEach=function(){var e;return(e=this.hash).forEach.apply(e,arguments)};return n}(Batman.Object);Batman.extend(c.prototype,Batman.Enumerable);c.prototype.propertyClass=Batman.Property;c.defaultAccessor={cache:false,get:Batman.SimpleHash.prototype.get,set:c.mutation(function(e,t){var n,r;n=Batman.SimpleHash.prototype.get.call(this,e);r=Batman.SimpleHash.prototype.set.call(this,e,t);if(n!=null&&n!==r){this.fire("itemsWereChanged",[e],[r],[n])}else{this.fire("itemsWereAdded",[e],[r])}return r}),unset:c.mutation(function(e){var t;t=Batman.SimpleHash.prototype.unset.call(this,e);if(t!=null){this.fire("itemsWereRemoved",[e],[t])}return t})};c.accessor(c.defaultAccessor);c.prototype._preventMutationEvents=function(e){this.prevent("change");this.prevent("itemsWereAdded");this.prevent("itemsWereChanged");this.prevent("itemsWereRemoved");try{return e.call(this)}finally{this.allow("change");this.allow("itemsWereAdded");this.allow("itemsWereChanged");this.allow("itemsWereRemoved")}};c.prototype.clear=c.mutation(function(){var e,t,n;t=this.keys();n=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];i.push(this.get(e))}return i}.call(this);this._preventMutationEvents(function(){var e=this;return this.forEach(function(t){return e.unset(t)})});Batman.SimpleHash.prototype.clear.call(this);this.fire("itemsWereRemoved",t,n);return n});c.prototype.update=c.mutation(function(e){var t,n,r,i,s;t=[];n=[];r=[];i=[];s=[];this._preventMutationEvents(function(){var o=this;return Batman.forEach(e,function(e,u){if(o.hasKey(e)){r.push(e);s.push(o.get(e));return i.push(o.set(e,u))}else{t.push(e);return n.push(o.set(e,u))}})});if(t.length>0){this.fire("itemsWereAdded",t,n)}if(r.length>0){return this.fire("itemsWereChanged",r,i,s)}});c.prototype.replace=c.mutation(function(e){var t,n,r,i,s,o,u;t=[];n=[];o=[];u=[];r=[];s=[];i=[];this._preventMutationEvents(function(){var a=this;this.forEach(function(t){if(!Batman.objectHasKey(e,t)){o.push(t);return u.push(a.unset(t))}});return Batman.forEach(e,function(e,o){if(a.hasKey(e)){r.push(e);s.push(a.get(e));return i.push(a.set(e,o))}else{t.push(e);return n.push(a.set(e,o))}})});if(t.length>0){this.fire("itemsWereAdded",t,n)}if(r.length>0){this.fire("itemsWereChanged",r,i,s)}if(o.length>0){return this.fire("itemsWereRemoved",o,u)}});a=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"];for(i=0,o=a.length;i<o;i++){n=a[i];c.prototype[n]=Batman.SimpleHash.prototype[n]}f=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"];r=function(e){return c.prototype[e]=function(){this.registerAsMutableSource();return Batman.SimpleHash.prototype[e].apply(this,arguments)}};for(s=0,u=f.length;s<u;s++){n=f[s];r(n)}return c}.call(this,Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.RenderCache=function(e){function n(){n.__super__.constructor.apply(this,arguments);this.keyQueue=[]}t(n,e);n.prototype.maximumLength=4;n.prototype.viewForOptions=function(e){var t=this;if(Batman.config.cacheViews||e.cache||e.viewClass.prototype.cache){return this.getOrSet(e,function(){return t._newViewFromOptions(Batman.extend({},e))})}else{return this._newViewFromOptions(e)}};n.prototype._newViewFromOptions=function(e){return new e.viewClass(e)};n.wrapAccessor(function(e){return{cache:false,get:function(t){var n;n=e.get.call(this,t);if(n){this._addOrBubbleKey(t)}return n},set:function(t,n){var r;r=e.set.apply(this,arguments);r.set("cached",true);this._addOrBubbleKey(t);this._evictExpiredKeys();return r},unset:function(t){var n;n=e.unset.apply(this,arguments);n.set("cached",false);this._removeKeyFromQueue(t);return n}}});n.prototype.equality=function(e,t){var n;if(Object.keys(e).length!==Object.keys(t).length){return false}for(n in e){if(!(n==="view")){if(e[n]!==t[n]){return false}}}return true};n.prototype.reset=function(){var e,t,n,r;r=this.keyQueue.slice(0);for(t=0,n=r.length;t<n;t++){e=r[t];this.unset(e)}};n.prototype._addOrBubbleKey=function(e){this._removeKeyFromQueue(e);return this.keyQueue.unshift(e)};n.prototype._removeKeyFromQueue=function(e){var t,n,r,i,s;s=this.keyQueue;for(t=r=0,i=s.length;r<i;t=++r){n=s[t];if(this.equality(n,e)){this.keyQueue.splice(t,1);break}}return e};n.prototype._evictExpiredKeys=function(){var e,t,n,r,i,s;if(this.length>this.maximumLength){e=this.keyQueue.slice(0);for(t=r=i=this.maximumLength,s=e.length;i<=s?r<s:r>s;t=i<=s?++r:--r){n=e[t];if(!this.get(n).isInDOM()){this.unset(n)}}}};return n}(Batman.Hash)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++){if(t in this&&this[t]===e)return t}return-1},i=[].slice;Batman.Controller=function(t){function s(){this.redirect=e(this.redirect,this);this.handleError=e(this.handleError,this);this.errorHandler=e(this.errorHandler,this);s.__super__.constructor.apply(this,arguments);this._resetActionFrames()}n(s,t);s.singleton("sharedController");s.wrapAccessor("routingKey",function(e){return{get:function(){if(this.routingKey!=null){return this.routingKey}else{if(Batman.config.minificationErrors){Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe.")}return Batman.functionName(this.constructor).replace(/Controller$/,"")}}}});s.classMixin(Batman.LifecycleEvents);s.lifecycleEvent("action",function(e){var t,n,i;if(e==null){e={}}n={};i=Batman.typeOf(e.only)==="String"?[e.only]:e.only;t=Batman.typeOf(e.except)==="String"?[e.except]:e.except;n["if"]=function(e,n){var s,o;if(this._afterFilterRedirect){return false}if(i&&(s=n.action,r.call(i,s)<0)){return false}if(t&&(o=n.action,r.call(t,o)>=0)){return false}return true};return n});s.beforeFilter=function(){Batman.developer.deprecated("Batman.Controller::beforeFilter","Please use beforeAction instead.");return this.beforeAction.apply(this,arguments)};s.afterFilter=function(){Batman.developer.deprecated("Batman.Controller::afterFilter","Please use afterAction instead.");return this.afterAction.apply(this,arguments)};s.afterAction(function(e){if(this.autoScrollToHash&&e["#"]!=null){return this.scrollToHash(e["#"])}});s.catchError=function(){var e,t,n,r,s,o,u,a,f,l;n=2<=arguments.length?i.call(arguments,0,u=arguments.length-1):(u=0,[]),s=arguments[u++];Batman.initializeObject(this);(o=this._batman).errorHandlers||(o.errorHandlers=new Batman.SimpleHash);r=Batman.typeOf(s["with"])==="Array"?s["with"]:[s["with"]];l=[];for(a=0,f=n.length;a<f;a++){t=n[a];e=this._batman.errorHandlers.get(t)||[];l.push(this._batman.errorHandlers.set(t,e.concat(r)))}return l};s.prototype.errorHandler=function(e){var t,n,r=this;t=(n=this._actionFrames)!=null?n[this._actionFrames.length-1]:void 0;return function(n,i,s){if(n){if(t!=null?t.error:void 0){return}if(t!=null){t.error=n}if(!r.handleError(n)){throw n}}else{return typeof e==="function"?e(i,s):void 0}}};s.prototype.handleError=function(e){var t,n,r=this;t=false;if((n=this.constructor._batman.getAll("errorHandlers"))!=null){n.forEach(function(n){return n.forEach(function(n,i){var s,o,u,a;if(e instanceof n){t=true;a=[];for(o=0,u=i.length;o<u;o++){s=i[o];a.push(s.call(r,e))}return a}})})}return t};s.prototype.renderCache=new Batman.RenderCache;s.prototype.defaultRenderYield="main";s.prototype.autoScrollToHash=true;s.prototype.dispatch=function(e,t){var n;if(t==null){t={}}t.controller||(t.controller=this.get("routingKey"));t.action||(t.action=e);t.target||(t.target=this);this._resetActionFrames();this.set("action",e);this.set("params",t);this.executeAction(e,t);n=this._afterFilterRedirect;this._afterFilterRedirect=null;delete this._afterFilterRedirect;if(n){return Batman.redirect(n)}};s.prototype.executeAction=function(e,t){var n,r,i,s,o,u,a=this;if(t==null){t=this.get("params")}Batman.developer.assert(this[e],"Error! Controller action "+this.get("routingKey")+"."+e+" couldn't be found!");i=this._actionFrames[this._actionFrames.length-1];n=new Batman.ControllerActionFrame({parentFrame:i,action:e,params:t},function(){var e;if(!a._afterFilterRedirect){a.fireLifecycleEvent("afterAction",n.params,n)}a._resetActionFrames();return(e=Batman.navigator)!=null?e.redirect=r:void 0});this._actionFrames.push(n);n.startOperation({internal:true});r=(o=Batman.navigator)!=null?o.redirect:void 0;if((u=Batman.navigator)!=null){u.redirect=this.redirect}if(this.fireLifecycleEvent("beforeAction",n.params,n)!==false){if(!this._afterFilterRedirect){s=this[e](t)}if(!n.operationOccurred){this.render()}}n.finishOperation();return s};s.prototype.redirect=function(e){var t;t=this._actionFrames[this._actionFrames.length-1];if(t){if(t.operationOccurred){Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(t.action||this.get("action")));return}t.startAndFinishOperation();if(this._afterFilterRedirect!=null){return Batman.developer.warn("Warning! Multiple actions trying to redirect!")}else{return this._afterFilterRedirect=e}}else{if(Batman.typeOf(e)==="Object"){if(!e.controller){e.controller=this}}return Batman.redirect(e)}};s.prototype.render=function(e){var t,n,r,i,s,o,u,a,f;if(e==null){e={}}if(n=(o=this._actionFrames)!=null?o[this._actionFrames.length-1]:void 0){n.startOperation()}if(e===false){n.finishOperation();return}t=(n!=null?n.action:void 0)||this.get("action");if(r=e.view){e.view=null}else{e.viewClass||(e.viewClass=this._viewClassForAction(t));e.source||(e.source=Batman.helpers.underscore(this.get("routingKey")+"/"+t));r=this.renderCache.viewForOptions(e)}if(r){r.once("viewDidAppear",function(){return n!=null?n.finishOperation():void 0});s=e.into||this.defaultRenderYield;if(i=Batman.DOM.Yield.withName(s).contentView){if(i!==r&&!i.isDead){i.die()}}if(!r.contentFor&&!r.parentNode){r.set("contentFor",s)}r.set("controller",this);if((u=Batman.currentApp)!=null){if((a=u.layout)!=null){if((f=a.subviews)!=null){f.add(r)}}}this.set("currentView",r)}return r};s.prototype.scrollToHash=function(e){if(e==null){e=this.get("params")["#"]}return Batman.DOM.scrollIntoView(e)};s.prototype._resetActionFrames=function(){return this._actionFrames=[]};s.prototype._viewClassForAction=function(e){var t,n;t=this.get("routingKey").replace("/","_");return((n=Batman.currentApp)!=null?n[Batman.helpers.camelize(""+t+"_"+e+"_view")]:void 0)||Batman.View};return s}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Set=function(e){function c(){Batman.SimpleSet.apply(this,arguments)}var n,r,i,s,o,u,a,f,l=this;t(c,e);c.prototype.isCollectionEventEmitter=true;Batman.extend(c.prototype,Batman.Enumerable);c._applySetAccessors=function(e){var t,n,r;n={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){this.registerAsMutableSource();return this.length},indexedBy:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.indexedBy(t)})},indexedByUnique:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.indexedByUnique(t)})},sortedBy:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.sortedBy(t)})},sortedByDescending:function(){var e=this;return new Batman.TerminalAccessible(function(t){return e.sortedBy(t,"desc")})}};for(r in n){t=n[r];e.accessor(r,t)}};c._applySetAccessors(c);a=["indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem"];for(i=0,o=a.length;i<o;i++){n=a[i];c.prototype[n]=Batman.SimpleSet.prototype[n]}f=["at","find","merge","forEach","toArray","isEmpty","has"];r=function(e){return c.prototype[e]=function(){this.registerAsMutableSource();return Batman.SimpleSet.prototype[e].apply(this,arguments)}};for(s=0,u=f.length;s<u;s++){n=f[s];r(n)}c.prototype.toJSON=c.prototype.toArray;c.prototype.add=c.mutation(function(){var e;e=Batman.SimpleSet.prototype.add.apply(this,arguments);if(e.length){this.fire("itemsWereAdded",e)}return e});c.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems};c.prototype.insertWithIndexes=c.mutation(function(){var e,t,n;n=Batman.SimpleSet.prototype.insertWithIndexes.apply(this,arguments),t=n.addedItems,e=n.addedIndexes;if(t.length){this.fire("itemsWereAdded",t,e)}return{addedItems:t,addedIndexes:e}});c.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems};c.prototype.removeWithIndexes=c.mutation(function(){var e,t,n;n=Batman.SimpleSet.prototype.removeWithIndexes.apply(this,arguments),t=n.removedItems,e=n.removedIndexes;if(t.length){this.fire("itemsWereRemoved",t,e)}return{removedItems:t,removedIndexes:e}});c.prototype.clear=c.mutation(function(){var e;e=Batman.SimpleSet.prototype.clear.call(this);if(e.length){this.fire("itemsWereRemoved",e)}return e});c.prototype.replace=c.mutation(function(e){var t,n;n=Batman.SimpleSet.prototype.clear.call(this);t=Batman.SimpleSet.prototype.add.apply(this,e.toArray());if(n.length){this.fire("itemsWereRemoved",n)}if(t.length){return this.fire("itemsWereAdded",t)}});return c}.call(this,Batman.Object)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.ErrorsSet=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.accessor(function(e){return this.indexedBy("attribute").get(e)});r.prototype.add=function(e,t){return r.__super__.add.call(this,new Batman.ValidationError(e,t))};return r}(Batman.Set)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.SetProxy=function(e){function a(e){this.base=e;a.__super__.constructor.call(this);this.length=this.base.length;if(this.base.isCollectionEventEmitter){this.isCollectionEventEmitter=true;this._setObserver=new Batman.SetObserver(this.base);this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this));this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this));this.startObserving()}}var n,r,i,s,o,u=this;t(a,e);Batman.extend(a.prototype,Batman.Enumerable);a.prototype.startObserving=function(){var e;return(e=this._setObserver)!=null?e.startObserving():void 0};a.prototype.stopObserving=function(){var e;return(e=this._setObserver)!=null?e.stopObserving():void 0};a.prototype._handleItemsAdded=function(e,t){this.set("length",this.base.length);return this.fire("itemsWereAdded",e,t)};a.prototype._handleItemsRemoved=function(e,t){this.set("length",this.base.length);return this.fire("itemsWereRemoved",e,t)};a.prototype.filter=function(e){return this.reduce(function(t,n){if(e(n)){t.add(n)}return t},new Batman.Set)};a.prototype.replace=function(){var e,t;e=this.property("length");e.isolate();t=this.base.replace.apply(this.base,arguments);e.expose();return t};Batman.Set._applySetAccessors(a);o=["add","insert","insertWithIndexes","remove","removeWithIndexes","at","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"];r=function(e){return a.prototype[e]=function(){return this.base[e].apply(this.base,arguments)}};for(i=0,s=o.length;i<s;i++){n=o[i];r(n)}a.accessor("length",{get:function(){this.registerAsMutableSource();return this.length},set:function(e,t){return this.length=t}});return a}.call(this,Batman.Object)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].slice;Batman.BinarySetOperation=function(t){function i(t,n){this.left=t;this.right=n;this._setup=e(this._setup,this);i.__super__.constructor.call(this);this._setup(this.left,this.right);this._setup(this.right,this.left)}n(i,t);i.prototype._setup=function(e,t){var n=this;e.on("itemsWereAdded",function(i){return n._itemsWereAddedToSource.apply(n,[e,t].concat(r.call(i)))});e.on("itemsWereRemoved",function(i){return n._itemsWereRemovedFromSource.apply(n,[e,t].concat(r.call(i)))});return this._itemsWereAddedToSource.apply(this,[e,t].concat(r.call(e.toArray())))};i.prototype.merge=function(){var e,t,n,i,s;t=1<=arguments.length?r.call(arguments,0):[];e=new Batman.Set;t.unshift(this);for(i=0,s=t.length;i<s;i++){n=t[i];n.forEach(function(t){return e.add(t)})}return e};i.prototype.filter=Batman.SetProxy.prototype.filter;return i}(Batman.Set)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].slice;Batman.SetUnion=function(t){function i(){e=i.__super__.constructor.apply(this,arguments);return e}n(i,t);i.prototype._itemsWereAddedToSource=function(){var e,t,n;n=arguments[0],t=arguments[1],e=3<=arguments.length?r.call(arguments,2):[];return this.add.apply(this,e)};i.prototype._itemsWereRemovedFromSource=function(){var e,t,n,i,s;s=arguments[0],i=arguments[1],t=3<=arguments.length?r.call(arguments,2):[];n=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++){e=t[n];if(!i.has(e)){s.push(e)}}return s}();return this.remove.apply(this,n)};return i}(Batman.BinarySetOperation)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].slice;Batman.SetIntersection=function(t){function i(){e=i.__super__.constructor.apply(this,arguments);return e}n(i,t);i.prototype._itemsWereAddedToSource=function(){var e,t,n,i,s;s=arguments[0],i=arguments[1],t=3<=arguments.length?r.call(arguments,2):[];n=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++){e=t[n];if(i.has(e)){s.push(e)}}return s}();if(n.length>0){return this.add.apply(this,n)}};i.prototype._itemsWereRemovedFromSource=function(){var e,t,n;n=arguments[0],t=arguments[1],e=3<=arguments.length?r.call(arguments,2):[];return this.remove.apply(this,e)};return i}(Batman.BinarySetOperation)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].slice;Batman.SetComplement=function(t){function i(){e=i.__super__.constructor.apply(this,arguments);return e}n(i,t);i.prototype._itemsWereAddedToSource=function(){var e,t,n,i,s,o;o=arguments[0],s=arguments[1],t=3<=arguments.length?r.call(arguments,2):[];if(o===this.left){n=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];if(!s.has(e)){i.push(e)}}return i}();if(n.length>0){return this.add.apply(this,n)}}else{i=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++){e=t[n];if(s.has(e)){i.push(e)}}return i}();if(i.length>0){return this.remove.apply(this,i)}}};i.prototype._itemsWereRemovedFromSource=function(){var e,t,n,i,s;s=arguments[0],i=arguments[1],t=3<=arguments.length?r.call(arguments,2):[];if(s===this.left){return this.remove.apply(this,t)}else{n=function(){var n,r,s;s=[];for(n=0,r=t.length;n<r;n++){e=t[n];if(i.has(e)){s.push(e)}}return s}();if(n.length>0){return this.add.apply(this,n)}}};i.prototype._addComplement=function(e,t){var n,r;r=function(){var r,i,s;s=[];for(r=0,i=e.length;r<i;r++){n=e[r];if(t.has(n)){s.push(n)}}return s}();if(r.length>0){return this.add.apply(this,r)}};return i}(Batman.BinarySetOperation)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.StateMachine=function(e){function r(e){this.nextEvents=[];this.set("_state",e)}t(r,e);r.InvalidTransitionError=function(e){this.message=e!=null?e:""};r.InvalidTransitionError.prototype=new Error;r.transitions=function(e){var t,r,i,s,o,u,a,f,l,c,h=this;for(i in e){f=e[i];if(!(f.from&&f.to)){continue}s={};if(f.from.forEach){f.from.forEach(function(e){return s[e]=f.to})}else{s[f.from]=f.to}e[i]=s}this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,e);o=[];t=function(e){var t;t="is"+Batman.helpers.capitalize(e);if(h.prototype[t]!=null){return}o.push(t);return h.prototype[t]=function(){return this.get("state")===e}};c=this.prototype.transitionTable;l=function(e){return h.prototype[e]=function(){return this.startTransition(e)}};for(i in c){a=c[i];if(!!this.prototype[i]){continue}l(i);for(r in a){u=a[r];t(r);t(u)}}if(o.length){this.accessor.apply(this,n.call(o).concat([function(e){return this[e]()}]))}return this};r.accessor("state",function(){return this.get("_state")});r.prototype.isTransitioning=false;r.prototype.transitionTable={};r.prototype._transitionEvent=function(e,t){return""+e+"->"+t};r.prototype._enterEvent=function(e){return"enter "+e};r.prototype._exitEvent=function(e){return"exit "+e};r.prototype._beforeEvent=function(e){return"before "+e};r.prototype.onTransition=function(e,t,n){return this.on(this._transitionEvent(e,t),n)};r.prototype.onEnter=function(e,t){return this.on(this._enterEvent(e),t)};r.prototype.onExit=function(e,t){return this.on(this._exitEvent(e),t)};r.prototype.onBefore=function(e,t){return this.on(this._beforeEvent(e),t)};r.prototype.offTransition=function(e,t,n){return this.off(this._transitionEvent(e,t),n)};r.prototype.offEnter=function(e,t){return this.off(this._enterEvent(e),t)};r.prototype.offExit=function(e,t){return this.off(this._exitEvent(e),t)};r.prototype.offBefore=function(e,t){return this.off(this._beforeEvent(e),t)};r.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(e){var t,n;if(this.isTransitioning){this.nextEvents.push(e);return}n=this.get("state");t=this.nextStateForEvent(e);if(!t){return false}this.fire(this._beforeEvent(t));this.isTransitioning=true;this.fire(this._exitEvent(n));this.set("_state",t);this.fire(this._transitionEvent(n,t));this.fire(this._enterEvent(t));this.fire(e);this.isTransitioning=false;if(this.nextEvents.length>0){this.startTransition(this.nextEvents.shift())}return true});r.prototype.canStartTransition=function(e,t){if(t==null){t=this.get("state")}return!!this.nextStateForEvent(e,t)};r.prototype.nextStateForEvent=function(e,t){var n;if(t==null){t=this.get("state")}return(n=this.transitionTable[e])!=null?n[t]:void 0};return r}(Batman.Object);Batman.DelegatingStateMachine=function(e){function n(e,t){this.base=t;n.__super__.constructor.call(this,e)}t(n,e);n.prototype.fire=function(){var e,t;e=n.__super__.fire.apply(this,arguments);(t=this.base).fire.apply(t,arguments);return e};return n}(Batman.StateMachine)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.Model=function(e){function c(e){if(e==null){e={}}Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new");if(Batman.typeOf(e)==="Object"){c.__super__.constructor.call(this,e)}else{c.__super__.constructor.call(this);this.set("id",e)}}var r,i,s,o,u,a,f,l;t(c,e);c.storageKey=null;c.primaryKey="id";c.persist=function(){var e,t;e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[];Batman.initializeObject(this.prototype);e=e.isStorageAdapter?e:new e(this);if(t.length>0){Batman.mixin.apply(Batman,[e].concat(n.call(t)))}this.prototype._batman.storage=e;return e};c.storageAdapter=function(){Batman.initializeObject(this.prototype);return this.prototype._batman.storage};c.encode=function(){var e,t,r,i,s,o,u,a,f;s=2<=arguments.length?n.call(arguments,0,u=arguments.length-1):(u=0,[]),r=arguments[u++];Batman.initializeObject(this.prototype);(o=this.prototype._batman).encoders||(o.encoders=new Batman.SimpleHash);e={};switch(Batman.typeOf(r)){case"String":s.push(r);break;case"Function":e.encode=r;break;default:e=r}for(a=0,f=s.length;a<f;a++){i=s[a];t=Batman.extend({as:i},this.defaultEncoder,e);this.prototype._batman.encoders.set(i,t)}};c.defaultEncoder={encode:function(e){return e},decode:function(e){return e}};c.observeAndFire("primaryKey",function(e,t){this.encode(t,{encode:false,decode:false});return this.encode(e,{encode:false,decode:this.defaultEncoder.decode})});c.validate=function(){var e,t,r,i,s,o,u,a,f,l;e=2<=arguments.length?n.call(arguments,0,u=arguments.length-1):(u=0,[]),r=arguments[u++];Batman.initializeObject(this.prototype);s=(o=this.prototype._batman).validators||(o.validators=[]);if(typeof r==="function"){s.push({keys:e,callback:r})}else{l=Batman.Validators;for(a=0,f=l.length;a<f;a++){i=l[a];if(t=i.matches(r)){s.push({keys:e,validator:new i(t)})}}}};c.classAccessor("resourceName",{get:function(){if(this.resourceName!=null){return this.resourceName}else if(this.prototype.resourceName!=null){if(Batman.config.minificationErrors){Batman.developer.error("Please define the resourceName property of the "+Batman.functionName(this)+" on the constructor and not the prototype.")}return this.prototype.resourceName}else{if(Batman.config.minificationErrors){Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe.")}return Batman.helpers.underscore(Batman.functionName(this))}}});c.classAccessor("all",{get:function(){this._batman.check(this);if(this.prototype.hasStorage()&&!this._batman.allLoadTriggered){this.load();this._batman.allLoadTriggered=true}return this.get("loaded")},set:function(e,t){return this.set("loaded",t)}});c.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(e,t){return this._loaded=t}});c.classAccessor("first",function(){return this.get("all").toArray()[0]});c.classAccessor("last",function(){var e;e=this.get("all").toArray();return e[e.length-1]});c.clear=function(){var e,t;Batman.initializeObject(this);e=this.get("loaded").clear();if((t=this._batman.get("associations"))!=null){t.reset()}this._resetPromises();return e};c.find=function(e,t){return this.findWithOptions(e,void 0,t)};c.findWithOptions=function(e,t,n){var r;if(t==null){t={}}Batman.developer.assert(n,"Must call find with a callback!");r=new this;r._withoutDirtyTracking(function(){return this.set("id",e)});r.loadWithOptions(t,n);return r};c.load=function(e,t){var n;if((n=typeof e)==="function"||n==="undefined"){t=e;e={}}else{e={data:e}}return this.loadWithOptions(e,t)};c.loadWithOptions=function(e,t){var n=this;this.fire("loading",e);return this._doStorageOperation("readAll",e,function(e,r,i){if(e!=null){n.fire("error",e);return typeof t==="function"?t(e,[]):void 0}else{n.fire("loaded",r,i);return typeof t==="function"?t(e,r,i):void 0}})};c.create=function(e,t){var n,r;if(!t){r=[{},e],e=r[0],t=r[1]}n=new this(e);n.save(t);return n};c.findOrCreate=function(e,t){var n;n=this._loadIdentity(e[this.primaryKey]);if(n){n.mixin(e);t(void 0,n)}else{n=new this(e);n.save(t)}return n};c.createFromJSON=function(e){return this._makeOrFindRecordFromData(e)};c._loadIdentity=function(e){return this.get("loaded.indexedByUnique.id").get(e)};c._loadRecord=function(e){var t,n;if(t=e[this.primaryKey]){n=this._loadIdentity(t)}n||(n=new this);n._withoutDirtyTracking(function(){return this.fromJSON(e)});return n};c._makeOrFindRecordFromData=function(e){var t;t=this._loadRecord(e);return this._mapIdentity(t)};c._makeOrFindRecordsFromData=function(e){var t,n;n=function(){var n,r,i;i=[];for(n=0,r=e.length;n<r;n++){t=e[n];i.push(this._loadRecord(t))}return i}.call(this);this._mapIdentities(n);return n};c._mapIdentity=function(e){var t,n,r;if((n=e.get("id"))!=null){if(t=this._loadIdentity(n)){r=t.get("lifecycle");r.load();t._withoutDirtyTracking(function(){var t,n;t=(n=e.get("attributes"))!=null?n.toObject():void 0;if(t){return this.mixin(t)}});r.loaded();e=t}else{this.get("loaded").add(e)}}return e};c._mapIdentities=function(e){var t,n,r,i,s,o,u,a,f;s=[];for(r=u=0,a=e.length;u<a;r=++u){o=e[r];if((n=o.get("id"))==null){continue}else if(t=this._loadIdentity(n)){i=t.get("lifecycle");i.load();t._withoutDirtyTracking(function(){var e,t;e=(t=o.get("attributes"))!=null?t.toObject():void 0;if(e){return this.mixin(e)}});i.loaded();e[r]=t}else{s.push(o)}}if(s.length){(f=this.get("loaded")).add.apply(f,s)}return e};c._doStorageOperation=function(e,t,n){var r;Batman.developer.assert(this.prototype.hasStorage(),"Can't "+e+" model "+Batman.functionName(this.constructor)+" without any storage adapters!");r=this.prototype._batman.get("storage");return r.perform(e,this,t,n)};a=["find","load","create"];for(i=0,o=a.length;i<o;i++){r=a[i];c[r]=Batman.Property.wrapTrackingPrevention(c[r])}c.InstanceLifecycleStateMachine=function(e){function n(){f=n.__super__.constructor.apply(this,arguments);return f}t(n,e);n.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}});return n}(Batman.DelegatingStateMachine);c.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))});c.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)});c.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)});c.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)});c.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)});c.accessor("isNew",function(){return this.isNew()});c.accessor("isDirty",function(){return this.isDirty()});c.accessor(c.defaultAccessor={get:function(e){return Batman.getPath(this,["attributes",e])},set:function(e,t){if(this._willSet(e)){return this.get("attributes").set(e,t)}else{return this.get(e)}},unset:function(e){return this.get("attributes").unset(e)}});c.wrapAccessor("id",function(e){return{get:function(){var t;t=this.constructor.primaryKey;if(t==="id"){return e.get.apply(this,arguments)}else{return this.get(t)}},set:function(t,n){var r,i;if(typeof n==="string"&&n.match(/[^0-9]/)===null&&""+(r=parseInt(n,10))===n){n=r}i=this.constructor.primaryKey;if(i==="id"){this._willSet(t);return e.set.apply(this,arguments)}else{return this.set(i,n)}}}});c.prototype.isNew=function(){return typeof this.get("id")==="undefined"};c.prototype.isDirty=function(){return this.get("lifecycle.state")==="dirty"};c.prototype.updateAttributes=function(e){this.mixin(e);return this};c.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")};c.prototype.toParam=function(){return this.get("id")};c.prototype.toJSON=function(){var e,t,n=this;t={};e=this._batman.get("encoders");if(!(!e||e.isEmpty())){e.forEach(function(e,r){var i,s;if(r.encode){s=n.get(e);if(typeof s!=="undefined"){i=r.encode(s,e,t,n);if(typeof i!=="undefined"){return t[r.as]=i}}}})}return t};c.prototype.fromJSON=function(e){var t,n,r,i,s=this;r={};t=this._batman.get("encoders");if(!t||t.isEmpty()||!t.some(function(e,t){return t.decode!=null})){for(n in e){i=e[n];r[n]=i}}else{t.forEach(function(t,n){if(n.decode&&typeof e[n.as]!=="undefined"){return r[t]=n.decode(e[n.as],n.as,e,r,s)}})}if(this.constructor.primaryKey!=="id"){r.id=e[this.constructor.primaryKey]}Batman.developer["do"](function(){if(!t||t.length<=1){return Batman.developer.warn("Warning: Model "+Batman.functionName(s.constructor)+" has suspiciously few decoders!")}});return this.mixin(r)};c.prototype.hasStorage=function(){return this._batman.get("storage")!=null};c.prototype.load=function(e,t){var n;if(!t){n=[{},e],e=n[0],t=n[1]}else{e={data:e}}return this.loadWithOptions(e,t)};c.prototype.loadWithOptions=function(e,t){var n,r,i,s=this;r=Object.keys(e).length!==0;if((i=this.get("lifecycle.state"))==="destroying"||i==="destroyed"){if(typeof t==="function"){t(new Error("Can't load a destroyed record!"))}return}if(this.get("lifecycle").load()){n=[];if(t!=null){n.push(t)}if(!r){this._currentLoad=n}return this._doStorageOperation("read",e,function(e,i,o){var u,a;if(!e){s.get("lifecycle").loaded();i=s.constructor._mapIdentity(i);i.get("errors").clear()}else{s.get("lifecycle").error()}if(!r){s._currentLoad=null}for(u=0,a=n.length;u<a;u++){t=n[u];t(e,i,o)}})}else{if(this.get("lifecycle.state")==="loading"&&!r){if(t!=null){return this._currentLoad.push(t)}}else{return typeof t==="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0}}};c.prototype.save=function(e,t){var n,r,i,s,o,u,a=this;if(!t){o=[{},e],e=o[0],t=o[1]}r=this.isNew();u=r?["create","create","created"]:["save","update","saved"],i=u[0],s=u[1],n=u[2];if(this.get("lifecycle").startTransition(i)){return this.validate(function(r,i){var o;if(r||i.length){a.get("lifecycle").failedValidation();return typeof t==="function"?t(r||i,a):void 0}o=a.constructor._batman.get("associations");a._withoutDirtyTracking(function(){var e,t=this;return o!=null?(e=o.getByType("belongsTo"))!=null?e.forEach(function(e,n){return e.apply(t)}):void 0:void 0});return a._doStorageOperation(s,{data:e},function(e,r,i){if(!e){a.get("dirtyKeys").clear();a.get("_dirtiedKeys").clear();if(o){r._withoutDirtyTracking(function(){var t,n;if((t=o.getByType("hasOne"))!=null){t.forEach(function(t,n){return t.apply(e,r)})}return(n=o.getByType("hasMany"))!=null?n.forEach(function(t,n){return t.apply(e,r)}):void 0})}r=a.constructor._mapIdentity(r);a.get("lifecycle").startTransition(n)}else{if(e instanceof Batman.ErrorsSet){a.get("lifecycle").failedValidation()}else{a.get("lifecycle").error()}}return typeof t==="function"?t(e,r||a,i):void 0})})}else{return typeof t==="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0}};c.prototype.destroy=function(e,t){var n,r=this;if(!t){n=[{},e],e=n[0],t=n[1]}if(this.get("lifecycle").destroy()){return this._doStorageOperation("destroy",{data:e},function(e,n,i){if(!e){r.constructor.get("loaded").remove(r);r.get("lifecycle").destroyed()}else{r.get("lifecycle").error()}return typeof t==="function"?t(e,n,i):void 0})}else{return typeof t==="function"?t(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0}};c.prototype.validate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;i=this.get("errors");i.clear();a=this._batman.get("validators")||[];if(!a||a.length===0){if(typeof e==="function"){e(void 0,i)}return true}n=a.reduce(function(e,t){return e+t.keys.length},0);s=function(){if(--n===0){return typeof e==="function"?e(void 0,i):void 0}};for(f=0,c=a.length;f<c;f++){u=a[f];p=u.keys;for(l=0,h=p.length;l<h;l++){o=p[l];t=[i,this,o,s];try{if(u.validator){u.validator.validateEach.apply(u.validator,t)}else{u.callback.apply(u,t)}}catch(d){r=d;if(typeof e==="function"){e(r,i)}}}}};c.prototype.associationProxy=function(e){var t,n,r;Batman.initializeObject(this);t=(n=this._batman).associationProxies||(n.associationProxies={});t[r=e.label]||(t[r]=new e.proxyClass(e,this));return t[e.label]};c.prototype._willSet=function(e){if(this._pauseDirtyTracking){return true}if(this.get("lifecycle").startTransition("set")){if(!this.get("_dirtiedKeys").has(e)){this.set("dirtyKeys."+e,this.get(e));this.get("_dirtiedKeys").add(e)}return true}else{return false}};c.prototype._doStorageOperation=function(e,t,n){var r,i=this;Batman.developer.assert(this.hasStorage(),"Can't "+e+" model "+Batman.functionName(this.constructor)+" without any storage adapters!");r=this._batman.get("storage");return r.perform(e,this,t,function(){return n.apply(null,arguments)})};c.prototype._withoutDirtyTracking=function(e){var t;if(this._pauseDirtyTracking){return e.call(this)}this._pauseDirtyTracking=true;t=e.call(this);this._pauseDirtyTracking=false;return t};l=["load","save","validate","destroy"];for(s=0,u=l.length;s<u;s++){r=l[s];c.prototype[r]=Batman.Property.wrapTrackingPrevention(c.prototype[r])}return c}.call(this,Batman.Object)}).call(this);(function(){var e,t,n,r,i,s=this;i=Batman.AssociationCurator.availableAssociations;t=function(e){return Batman.Model[e]=function(t,n){var r,i;Batman.initializeObject(this);r=(i=this._batman).associations||(i.associations=new Batman.AssociationCurator(this));return r.add(new(Batman[""+Batman.helpers.capitalize(e)+"Association"])(this,t,n))}};for(n=0,r=i.length;n<r;n++){e=i[n];t(e)}}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Proxy=function(e){function n(e){n.__super__.constructor.call(this);if(e!=null){this.set("target",e)}}t(n,e);n.prototype.isProxy=true;n.accessor("target",Batman.Property.defaultAccessor);n.accessor({get:function(e){var t;return(t=this.get("target"))!=null?t.get(e):void 0},set:function(e,t){var n;return(n=this.get("target"))!=null?n.set(e,t):void 0},unset:function(e){var t;return(t=this.get("target"))!=null?t.unset(e):void 0}});return n}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.AssociationProxy=function(e){function n(e,t){this.association=e;this.model=t;n.__super__.constructor.call(this)}t(n,e);n.prototype.loaded=false;n.prototype.toJSON=function(){var e;e=this.get("target");if(e!=null){return this.get("target").toJSON()}};n.prototype.load=function(e){var t=this;this.fetch(function(n,r){if(!n){t._setTarget(r)}return typeof e==="function"?e(n,r):void 0});return this.get("target")};n.prototype.loadFromLocal=function(){var e;if(!this._canLoad()){return}if(e=this.fetchFromLocal()){this._setTarget(e)}return e};n.prototype.fetch=function(e){var t;if(!this._canLoad()){return e(void 0,void 0)}t=this.fetchFromLocal();if(t){return e(void 0,t)}else{return this.fetchFromRemote(e)}};n.accessor("loaded",Batman.Property.defaultAccessor);n.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(e,t){return t}});n.prototype._canLoad=function(){return(this.get("foreignValue")||this.get("primaryValue"))!=null};n.prototype._setTarget=function(e){this.set("target",e);this.set("loaded",true);return this.fire("loaded",e)};return n}(Batman.Proxy)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.HasOneProxy=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)});r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))};r.prototype.fetchFromRemote=function(e){var t,n=this;t={data:{}};t.data[this.association.foreignKey]=this.get("primaryValue");if(this.association.options.url){t.collectionUrl=this.association.options.url;t.urlContext=this.model}return this.association.getRelatedModel().loadWithOptions(t,function(t,n){if(t){throw t}if(!n||n.length<=0){return e(new Error("Couldn't find related record!"),void 0)}else{return e(void 0,n[0])}})};return r}(Batman.AssociationProxy)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.BelongsToProxy=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)});r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))};r.prototype.fetchFromRemote=function(e){var t,n=this;t={};if(this.association.options.url){t.recordUrl=this.association.options.url}return this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),t,function(t,n){if(t){throw t}return e(void 0,n)})};return r}(Batman.AssociationProxy)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.PolymorphicBelongsToProxy=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)});r.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))};r.prototype.fetchFromRemote=function(e){var t,n=this;t={};if(this.association.options.url){t.recordUrl=this.association.options.url}return this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),t,function(t,n){if(t){throw t}return e(void 0,n)})};return r}(Batman.BelongsToProxy)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.Accessible=function(e){function t(){this.accessor.apply(this,arguments)}n(t,e);return t}(Batman.Object);Batman.TerminalAccessible=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.propertyClass=Batman.Property;return r}(Batman.Accessible)}).call(this);(function(){Batman.URI=function(){function h(t){var n,r;r=c.exec(t);n=14;while(n--){this[e[n]]=r[n]||""}this.queryParams=this.constructor.paramsFromQuery(this.query);delete this.authority;delete this.userInfo;delete this.relative;delete this.directory;delete this.file;delete this.query}var e,t,n,r,i,s,o,u,a,f,l,c;c=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/;e=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"];h.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)};h.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")};h.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")};h.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")};h.prototype.relative=function(){var e;e=this.queryString();return[this.path,e?"?"+e:void 0,this.hash?"#"+this.hash:void 0].join("")};h.prototype.directory=function(){var e;e=this.path.split("/");if(e.length>1){return e.slice(0,e.length-1).join("/")+"/"}else{return""}};h.prototype.file=function(){var e;e=this.path.split("/");return e[e.length-1]};h.paramsFromQuery=function(e){var t,r,i,o,a,f;r={};f=e.split("&");for(o=0,a=f.length;o<a;o++){i=f[o];if(t=i.match(s)){u(r,n(t[1]),n(t[2]))}else{u(r,n(i),null)}}return r};h.decodeQueryComponent=n=function(e){return decodeURIComponent(e.replace(a,"%20"))};o=/^[\[\]]*([^\[\]]+)\]*(.*)/;t=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/];a=/\+/g;l=/%20/g;s=/^([^=]*)=(.*)/;u=function(e,n,r){var i,s,a,f,l;if(l=n.match(o)){a=l[1];i=l[2]}else{return}if(i===""){e[a]=r}else if(i==="[]"){if(e[a]==null){e[a]=[]}if(Batman.typeOf(e[a])!=="Array"){throw new Error("expected Array (got "+Batman.typeOf(e[a])+') for param "'+a+'"')}e[a].push(r)}else if(l=i.match(t[0])||i.match(t[1])){s=l[1];if(e[a]==null){e[a]=[]}if(Batman.typeOf(e[a])!=="Array"){throw new Error("expected Array (got "+Batman.typeOf(e[a])+') for param "'+a+'"')}f=e[a][e[a].length-1];if(Batman.typeOf(f)==="Object"&&!(s in f)){u(f,s,r)}else{e[a].push(u({},s,r))}}else{if(e[a]==null){e[a]={}}if(Batman.typeOf(e[a])!=="Object"){throw new Error("expected Object (got "+Batman.typeOf(e[a])+') for param "'+a+'"')}e[a]=u(e[a],i,r)}return e};h.queryFromParams=f=function(e,t){var n,r,s,o;if(e==null){return t}o=Batman.typeOf(e);if(!(t!=null||o==="Object")){throw new Error("value must be an Object")}switch(o){case"Array":return function(){var r,i;n=[];if(e.length===0){n.push(f(null,""+t+"[]"))}else{for(r=0,i=e.length;r<i;r++){s=e[r];n.push(f(s,""+t+"[]"))}}return n}().join("&");case"Object":return function(){var n;n=[];for(r in e){s=e[r];n.push(f(s,t?""+t+"["+i(r)+"]":i(r)))}return n}().join("&");default:if(t!=null){return""+t+"="+i(e)}else{return i(e)}}};h.encodeComponent=r=function(e){if(e!=null){return encodeURIComponent(e)}else{return""}};h.encodeQueryComponent=i=function(e){return r(e).replace(l,"+")};return h}()}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.Request=function(e){function r(e){var t,n,i,s;n={};for(i in e){t=e[i];if(!(i==="success"||i==="error"||i==="loading"||i==="loaded")){continue}n[i]=t;delete e[i]}r.__super__.constructor.call(this,e);for(i in n){t=n[i];this.on(i,t)}if(((s=this.get("url"))!=null?s.length:void 0)>0){if(this.autosend){this.send()}}else{this.observe("url",function(e){if(e!=null){return this.send()}})}}var n;t(r,e);r.objectToFormData=function(e){var t,n,r,i,s,o,u,a;r=function(e,t,n){var i,s,o;if(n==null){n=false}if(t instanceof Batman.container.File){return[[e,t]]}return s=function(){switch(Batman.typeOf(t)){case"Object":s=function(){var s;s=[];for(i in t){o=t[i];s.push(r(n?i:""+e+"["+i+"]",o))}return s}();return s.reduce(function(e,t){return e.concat(t)},[]);case"Array":return t.reduce(function(t,n){return t.concat(r(""+e+"[]",n))},[]);default:return[[e,t!=null?t:""]]}}()};t=new Batman.container.FormData;u=r("",e,true);for(s=0,o=u.length;s<o;s++){a=u[s],n=a[0],i=a[1];t.append(n,i)}return t};r.dataHasFileUploads=n=function(e){var t,r,i,s,o;if(typeof File!=="undefined"&&File!==null&&e instanceof File){return true}r=Batman.typeOf(e);switch(r){case"Object":for(t in e){i=e[t];if(n(i)){return true}}break;case"Array":for(s=0,o=e.length;s<o;s++){i=e[s];if(n(i)){return true}}}return false};r.wrapAccessor("method",function(e){return{set:function(t,n){return e.set.call(this,t,n!=null?typeof n.toUpperCase==="function"?n.toUpperCase():void 0:void 0)}}});r.prototype.method="GET";r.prototype.hasFileUploads=function(){return n(this.data)};r.prototype.contentType="application/x-www-form-urlencoded";r.prototype.autosend=true;r.prototype.send=function(){return Batman.developer.error("Please source a dependency file for a request implementation")};return r}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.SetObserver=function(e){function r(e){var t=this;this.base=e;this._itemObservers=new Batman.SimpleHash;this._setObservers=new Batman.SimpleHash;this._setObservers.set("itemsWereAdded",function(){return t.fire.apply(t,["itemsWereAdded"].concat(n.call(arguments)))});this._setObservers.set("itemsWereRemoved",function(){return t.fire.apply(t,["itemsWereRemoved"].concat(n.call(arguments)))});this.on("itemsWereAdded",this.startObservingItems.bind(this));this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}t(r,e);r.prototype.observedItemKeys=[];r.prototype.observerForItemAndKey=function(e,t){};r.prototype._getOrSetObserverForItemAndKey=function(e,t){var n=this;return this._itemObservers.getOrSet(e,function(){var r;r=new Batman.SimpleHash;return r.getOrSet(t,function(){return n.observerForItemAndKey(e,t)})})};r.prototype.startObserving=function(){this._manageItemObservers("observe");return this._manageSetObservers("addHandler")};r.prototype.stopObserving=function(){this._manageItemObservers("forget");return this._manageSetObservers("removeHandler")};r.prototype.startObservingItems=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++){t=e[n];this._manageObserversForItem(t,"observe")}};r.prototype.stopObservingItems=function(e){var t,n,r;for(n=0,r=e.length;n<r;n++){t=e[n];this._manageObserversForItem(t,"forget")}};r.prototype._manageObserversForItem=function(e,t){var n,r,i,s;if(e.isObservable){s=this.observedItemKeys;for(r=0,i=s.length;r<i;r++){n=s[r];e[t](n,this._getOrSetObserverForItemAndKey(e,n))}if(t==="forget"){return this._itemObservers.unset(e)}}};r.prototype._manageItemObservers=function(e){var t=this;return this.base.forEach(function(n){return t._manageObserversForItem(n,e)})};r.prototype._manageSetObservers=function(e){var t=this;if(this.base.isObservable){return this._setObservers.forEach(function(n,r){return t.base.event(n)[e](r)})}};return r}(Batman.Object)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.SetSort=function(t){function r(t,n,i){var s=this;this.key=n;if(i==null){i="asc"}this.compareElements=e(this.compareElements,this);r.__super__.constructor.call(this,t);this.descending=i.toLowerCase()==="desc";this.isSorted=true;if(this.isCollectionEventEmitter){this._setObserver.observedItemKeys=[this.key];this._setObserver.observerForItemAndKey=function(e){return function(t,n){return s._handleItemsModified(e,t,n)}}}this._reIndex()}n(r,t);r.prototype._handleItemsModified=function(e,t,n){var r,i,s,o,u,a,f,l,c=this;u={};u[this.key]=n;a=function(t,n){if(t===e){t=u}if(n===e){n=u}return c.compareElements(t,n)};s=this._storage.slice();f=this.constructor._binarySearch(s,e,a),r=f.match,o=f.index;if(!r){return}s.splice(o,1);l=this.constructor._binarySearch(s,e,this.compareElements),r=l.match,i=l.index;if(o===i){return}s.splice(i,0,e);this.set("_storage",s);return this.fire("itemWasMoved",e,i,o)};r.prototype._handleItemsAdded=function(e){var t,n,r,i,s,o,u,a,f;o=this._storage.slice();n=[];t=[];for(u=0,a=e.length;u<a;u++){i=e[u];f=this.constructor._binarySearch(o,i,this.compareElements),s=f.match,r=f.index;if(!s){o.splice(r,0,i);n.push(i);t.push(r)}}this.set("_storage",o);this.set("length",this._storage.length);return this.fire("itemsWereAdded",n,t)};r.prototype._handleItemsRemoved=function(e){var t,n,r,i,s,o,u,a,f;i=this._storage.slice();o=[];s=[];for(u=0,a=e.length;u<a;u++){n=e[u];f=this.constructor._binarySearch(i,n,this.compareElements),r=f.match,t=f.index;if(r){i.splice(t,1);o.push(n);s.push(t)}}this.set("_storage",i);this.set("length",this._storage.length);return this.fire("itemsWereRemoved",o,s)};r.prototype.toArray=function(){var e;if(typeof (e=this.base).registerAsMutableSource==="function"){e.registerAsMutableSource()}return this._storage.slice()};r.prototype.forEach=function(e,t){var n,r,i,s,o,u;if(typeof (i=this.base).registerAsMutableSource==="function"){i.registerAsMutableSource()}u=this._storage;for(r=s=0,o=u.length;s<o;r=++s){n=u[r];e.call(t,n,r,this)}};r.prototype.find=function(e){var t,n,r,i;this.base.registerAsMutableSource();i=this._storage;for(n=0,r=i.length;n<r;n++){t=i[n];if(e(t)){return t}}};r.prototype.merge=function(e){this.base.registerAsMutableSource();return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(Batman.Set,this._storage,function(){}).merge(e).sortedBy(this.key,this.order)};r.prototype.compare=function(e,t){if(e===t){return 0}if(e===void 0){return 1}if(t===void 0){return-1}if(e===null){return 1}if(t===null){return-1}if(e===false){return 1}if(t===false){return-1}if(e===true){return 1}if(t===true){return-1}if(e!==e){if(t!==t){return 0}else{return 1}}if(t!==t){return-1}if(e>t){return 1}if(e<t){return-1}return 0};r.prototype.compareElements=function(e,t){var n,r,i;r=this.key&&e!=null?Batman.get(e,this.key):e;if(typeof r==="function"){r=r.call(e)}if(r!=null){r=r.valueOf()}i=this.key&&t!=null?Batman.get(t,this.key):t;if(typeof i==="function"){i=i.call(t)}if(i!=null){i=i.valueOf()}n=this.descending?-1:1;return this.compare(r,i)*n};r.prototype._reIndex=function(){var e,t;e=this.base.toArray().sort(this.compareElements);if((t=this._setObserver)!=null){t.startObservingItems(e)}return this.set("_storage",e)};r.prototype._indexOfItem=function(e){var t,n,r;r=this.constructor._binarySearch(this._storage,e,this.compareElements),n=r.match,t=r.index;if(n){return t}else{return-1}};r._binarySearch=function(e,t,n){var r,i,s,o,u,a,f;f=0;i=e.length-1;a={};while(i>=f){o=(i-f>>1)+f;r=n(t,e[o]);if(r>0){f=o+1}else if(r<0){i=o-1}else{u=false;s=o;while(s>=0&&n(t,e[s])===0){if(t===e[s]){o=s;u=true;break}s--}if(!u){s=o+1;while(s<e.length&&n(t,e[s])===0){if(t===e[s]){o=s;u=true;break}s++}}return{match:u,index:o}}}return{match:false,index:f}};return r}(Batman.SetProxy)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.AssociationSet=function(e){function n(e,t){var r;this.foreignKeyValue=e;this.association=t;r=new Batman.Set;n.__super__.constructor.call(this,r,"_batmanID")}t(n,e);n.prototype.loaded=false;n.accessor("loaded",Batman.Property.defaultAccessor);n.prototype.load=function(e){var t=this;if(this.foreignKeyValue==null){return e(void 0,this)}return this.association.getRelatedModel().loadWithOptions(this._getLoadOptions(),function(n,r){if(!n){t.markAsLoaded()}return e(n,t)})};n.prototype._getLoadOptions=function(){var e;e={data:{}};e.data[this.association.foreignKey]=this.foreignKeyValue;if(this.association.options.url){e.collectionUrl=this.association.options.url;e.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)}return e};n.prototype.markAsLoaded=function(){this.set("loaded",true);return this.fire("loaded")};return n}(Batman.SetSort)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PolymorphicAssociationSet=function(e){function n(e,t,r){this.foreignKeyValue=e;this.foreignTypeKeyValue=t;this.association=r;n.__super__.constructor.call(this,this.foreignKeyValue,this.association)}t(n,e);n.prototype._getLoadOptions=function(){var e;e={data:{}};e.data[this.association.foreignKey]=this.foreignKeyValue;e.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue;if(this.association.options.url){e.collectionUrl=this.association.options.url;e.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)}return e};return n}(Batman.AssociationSet)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.SetIndex=function(e){function n(e,t){var r=this;this.base=e;this.key=t;n.__super__.constructor.call(this);this._storage=new Batman.Hash;if(this.base.isEventEmitter){this._setObserver=new Batman.SetObserver(this.base);this._setObserver.observedItemKeys=[this.key];this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this);this._setObserver.on("itemsWereAdded",function(e){return r._addItems(e)});this._setObserver.on("itemsWereRemoved",function(e){return r._removeItems(e)})}this._addItems(this.base._storage);this.startObserving()}t(n,e);n.accessor("toArray",function(){return this.toArray()});Batman.extend(n.prototype,Batman.Enumerable);n.prototype.propertyClass=Batman.Property;n.accessor(function(e){return this._resultSetForKey(e)});n.prototype.startObserving=function(){var e;return(e=this._setObserver)!=null?e.startObserving():void 0};n.prototype.stopObserving=function(){var e;return(e=this._setObserver)!=null?e.stopObserving():void 0};n.prototype.observerForItemAndKey=function(e,t){var n=this;return function(t,r){n._removeItemsFromKey(r,[e]);return n._addItemsToKey(t,[e])}};n.prototype.forEach=function(e,t){var n=this;return this._storage.forEach(function(r,i){if(i.get("length")>0){return e.call(t,r,i,n)}})};n.prototype.toArray=function(){var e;e=[];this._storage.forEach(function(t,n){if(n.get("length")>0){return e.push(t)}});return e};n.prototype._addItems=function(e){var t,n,r,i,s,o,u;if(!(e!=null?e.length:void 0)){return}s=this._keyForItem(e[0]);r=[];for(t=o=0,u=e.length;o<u;t=++o){n=e[t];if(Batman.SimpleHash.prototype.equality(s,i=this._keyForItem(n))){r.push(n)}else{this._addItemsToKey(s,r);r=[n];s=i}}if(r.length){return this._addItemsToKey(s,r)}};n.prototype._removeItems=function(e){var t,n,r,i,s,o,u;if(!(e!=null?e.length:void 0)){return}s=this._keyForItem(e[0]);r=[];for(t=o=0,u=e.length;o<u;t=++o){n=e[t];if(Batman.SimpleHash.prototype.equality(s,i=this._keyForItem(n))){r.push(n)}else{this._removeItemsFromKey(s,r);r=[n];s=i}}if(r.length){return this._removeItemsFromKey(s,r)}};n.prototype._addItemsToKey=function(e,t){var n;n=this._resultSetForKey(e);n.add.apply(n,t);return n};n.prototype._removeItemsFromKey=function(e,t){var n;n=this._resultSetForKey(e);n.remove.apply(n,t);return n};n.prototype._resultSetForKey=function(e){return this._storage.getOrSet(e,function(){return new Batman.Set})};n.prototype._keyForItem=function(e){return Batman.Keypath.forBaseAndKey(e,this.key).getValue()};return n}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PolymorphicAssociationSetIndex=function(e){function n(e,t,r){this.association=e;this.type=t;n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}t(n,e);n.prototype._resultSetForKey=function(e){return this.association.setForKey(e)};n.prototype._addItemsToKey=function(e,t){var r,i;r=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++){i=t[e];if(this.association.modelType()===i.get(this.association.foreignTypeKey)){r.push(i)}}return r}.call(this);return n.__super__._addItemsToKey.call(this,e,r)};n.prototype._removeItemsFromKey=function(e,t){var r,i;r=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++){i=t[e];if(this.association.modelType()===i.get(this.association.foreignTypeKey)){r.push(i)}}return r}.call(this);return n.__super__._removeItemsFromKey.call(this,e,r)};return n}(Batman.SetIndex)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.AssociationSetIndex=function(e){function n(e,t){this.association=e;n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),t)}t(n,e);n.prototype._resultSetForKey=function(e){return this.association.setForKey(e)};n.prototype.forEach=function(e,t){var n=this;return this.association.proxies.forEach(function(r,i){var s;s=n.association.indexValueForRecord(r);if(i.get("length")>0){return e.call(t,s,i,n)}})};n.prototype.toArray=function(){var e;e=[];this.forEach(function(t){return e.push(t)});return e};return n}(Batman.SetIndex)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.UniqueSetIndex=function(e){function n(){this._uniqueIndex=new Batman.Hash;n.__super__.constructor.apply(this,arguments)}t(n,e);n.accessor(function(e){return this._uniqueIndex.get(e)});n.prototype._addItemsToKey=function(e,t){n.__super__._addItemsToKey.apply(this,arguments);if(!this._uniqueIndex.hasKey(e)){return this._uniqueIndex.set(e,t[0])}};n.prototype._removeItemsFromKey=function(e,t){var r;r=n.__super__._removeItemsFromKey.apply(this,arguments);if(r.isEmpty()){return this._uniqueIndex.unset(e)}else{return this._uniqueIndex.set(e,r._storage[0])}};return n}(Batman.SetIndex)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.UniqueAssociationSetIndex=function(e){function n(e,t){this.association=e;n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),t)}t(n,e);return n}(Batman.UniqueSetIndex)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PolymorphicUniqueAssociationSetIndex=function(e){function n(e,t,r){this.association=e;this.type=t;n.__super__.constructor.call(this,this.association.getRelatedModelForType(t).get("loaded"),r)}t(n,e);return n}(Batman.UniqueSetIndex)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].slice;Batman.Navigator=function(){function n(t){this.app=t;this.handleCurrentLocation=e(this.handleCurrentLocation,this)}n.forApp=function(e){return new(this.defaultClass())(e)};n.defaultClass=function(){if(Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()){return Batman.PushStateNavigator}else{return Batman.HashbangNavigator}};n.prototype.start=function(){var e=this;if(typeof window==="undefined"){return}if(this.started){return}this.started=true;this.startWatching();Batman.currentApp.prevent("ready");return Batman.setImmediate(function(){if(e.started&&Batman.currentApp){e.checkInitialHash();e.handleCurrentLocation();return Batman.currentApp.allowAndFire("ready")}})};n.prototype.stop=function(){this.stopWatching();return this.started=false};n.prototype.checkInitialHash=function(e){var t,n,r;if(e==null){e=window.location}r=Batman.HashbangNavigator.prototype.hashPrefix;t=e.hash;if(t.length>r.length&&t.substr(0,r.length)!==r){return this.initialHash=t.substr(r.length-1)}else if((n=t.indexOf("##BATMAN##"))!==-1){this.initialHash=t.substr(n+10);return this.replaceState(null,"",t.substr(r.length,n-r.length),e)}};n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)};n.prototype.handleLocation=function(e){var t;t=this.pathFromLocation(e);if(t===this.cachedPath){return}return this.dispatch(t)};n.prototype.dispatch=function(e){var t,n;t=this.app.get("dispatcher");this.cachedPath=this.initialHash?(n={initialHash:this.initialHash},delete this.initialHash,t.dispatch(e,n)):t.dispatch(e);return this.cachedPath};n.prototype.redirect=function(e,t){var n,r,i;if(t==null){t=false}r=typeof (i=this.app.get("dispatcher")).pathFromParams==="function"?i.pathFromParams(e):void 0;if(r){this._lastRedirect=r}n=this.dispatch(e);if(this._lastRedirect){this.cachedPath=this._lastRedirect}if(!this._lastRedirect||this._lastRedirect===n){this[t?"replaceState":"pushState"](null,"",n)}return n};n.prototype.push=function(e){Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead.");return this.redirect(e)};n.prototype.replace=function(e){Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead.");return this.redirect(e,true)};n.prototype.normalizePath=function(){var e,n,r;r=1<=arguments.length?t.call(arguments,0):[];r=function(){var t,s,o;o=[];for(e=t=0,s=r.length;t<s;e=++t){n=r[e];o.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""))}return o}();return r.join("")||"/"};n.normalizePath=n.prototype.normalizePath;return n}()}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.PushStateNavigator=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.isSupported=function(){var e;return(typeof window!=="undefined"&&window!==null?(e=window.history)!=null?e.pushState:void 0:void 0)!=null};r.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)};r.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)};r.prototype.pushState=function(e,t,n){if(n!==this.pathFromLocation(window.location)){return window.history.pushState(e,t,this.linkTo(n))}};r.prototype.replaceState=function(e,t,n){if(n!==this.pathFromLocation(window.location)){return window.history.replaceState(e,t,this.linkTo(n))}};r.prototype.linkTo=function(e){return this.normalizePath(Batman.config.pathToApp,e)};r.prototype.pathFromLocation=function(e){var t,n;t=""+(e.pathname||"")+(e.search||"");n=new RegExp("^"+this.normalizePath(Batman.config.pathToApp));return this.normalizePath(t.replace(n,""))};r.prototype.handleLocation=function(e){var t,n;n=this.pathFromLocation(e);t=Batman.HashbangNavigator.prototype.pathFromLocation(e);if(n==="/"&&t!=="/"){return this.redirect(t,true)}else{return r.__super__.handleLocation.apply(this,arguments)}};return r}(Batman.Navigator)}).call(this);(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.HashbangNavigator=function(n){function i(){this.detectHashChange=t(this.detectHashChange,this);this.handleHashChange=t(this.handleHashChange,this);e=i.__super__.constructor.apply(this,arguments);return e}r(i,n);i.prototype.hashPrefix="#!";if(typeof window!=="undefined"&&window!==null&&"onhashchange"in window){i.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)};i.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}}else{i.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)};i.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}}i.prototype.handleHashChange=function(){if(this.ignoreHashChange){return this.ignoreHashChange=false}return this.handleCurrentLocation()};i.prototype.detectHashChange=function(){if(this.previousHash===window.location.hash){return}this.previousHash=window.location.hash;return this.handleHashChange()};i.prototype.pushState=function(e,t,n){var r;r=this.linkTo(n);if(r===window.location.hash){return}this.ignoreHashChange=true;return window.location.hash=r};i.prototype.replaceState=function(e,t,n,r){var i;if(r==null){r=window.location}i=this.linkTo(n);if(i===r.hash){return}this.ignoreHashChange=true;return r.replace(""+(r.pathname||"")+(r.search||"")+(i||""))};i.prototype.linkTo=function(e){return this.hashPrefix+e};i.prototype.pathFromLocation=function(e){var t,n;t=e.hash;n=this.hashPrefix.length;if((t!=null?t.substr(0,n):void 0)===this.hashPrefix){return this.normalizePath(t.substr(n))}else{return"/"}};i.prototype.handleLocation=function(e){var t;if(!Batman.config.usePushState){return i.__super__.handleLocation.apply(this,arguments)}t=Batman.PushStateNavigator.prototype.pathFromLocation(e);if(t!=="/"){return e.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(t)+(this.initialHash?"##BATMAN##"+this.initialHash:"")))}else{return i.__super__.handleLocation.apply(this,arguments)}};return i}(Batman.Navigator)}).call(this);(function(){Batman.RouteMap=function(){function e(){this.childrenByOrder=[];this.childrenByName={}}e.prototype.memberRoute=null;e.prototype.collectionRoute=null;e.prototype.routeForParams=function(e){var t,n,r,i,s;this._cachedRoutes||(this._cachedRoutes={});t=this.cacheKey(e);if(this._cachedRoutes[t]){return this._cachedRoutes[t]}else{s=this.childrenByOrder;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.test(e)){return this._cachedRoutes[t]=n}}}};e.prototype.addRoute=function(e,t){var n,r,i=this;this.childrenByOrder.push(t);if(e.length>0&&(r=e.split(".")).length>0){n=r.shift();if(!this.childrenByName[n]){this.childrenByName[n]=new Batman.RouteMap}this.childrenByName[n].addRoute(r.join("."),t)}else{if(t.get("member")){Batman.developer["do"](function(){if(i.memberRoute){return Batman.developer.error("Member route with name "+e+" already exists!")}});this.memberRoute=t}else{Batman.developer["do"](function(){if(i.collectionRoute){return Batman.developer.error("Collection route with name "+e+" already exists!")}});this.collectionRoute=t}}return true};e.prototype.cacheKey=function(e){if(typeof e==="string"){return e}else if(e.path!=null){return e.path}else{return""+e.controller+"#"+e.action}};return e}()}).call(this);(function(){var e=[].slice;Batman.RouteMapBuilder=function(){function t(e,t,n,r){this.app=e;this.routeMap=t;this.parent=n;this.baseOptions=r!=null?r:{};if(this.parent){this.rootPath=this.parent._nestingPath();this.rootName=this.parent._nestingName()}else{this.rootPath="";this.rootName=""}}t.BUILDER_FUNCTIONS=["resources","member","collection","route","root"];t.ROUTES={index:{cardinality:"collection",path:function(e){return e},name:function(e){return e}},"new":{cardinality:"collection",path:function(e){return""+e+"/new"},name:function(e){return""+e+".new"}},show:{cardinality:"member",path:function(e){return""+e+"/:id"},name:function(e){return e}},edit:{cardinality:"member",path:function(e){return""+e+"/:id/edit"},name:function(e){return""+e+".edit"}},collection:{cardinality:"collection",path:function(e,t){return""+e+"/"+t},name:function(e,t){return""+e+"."+t}},member:{cardinality:"member",path:function(e,t){return""+e+"/:id/"+t},name:function(e,t){return""+e+"."+t}}};t.prototype.resources=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;i=1<=arguments.length?e.call(arguments,0):[];d=function(){var e,t,n;n=[];for(e=0,t=i.length;e<t;e++){r=i[e];if(typeof r==="string"){n.push(r)}}return n}();if(typeof i[i.length-1]==="function"){o=i.pop()}if(typeof i[i.length-1]==="object"){c=i.pop()}else{c={}}n={index:true,"new":true,show:true,edit:true};if(c.except){N=c.except;for(b=0,S=N.length;b<S;b++){l=N[b];n[l]=false}delete c.except}else if(c.only){for(l in n){y=n[l];n[l]=false}C=c.only;for(w=0,x=C.length;w<x;w++){l=C[w];n[l]=true}delete c.only}for(E=0,T=d.length;E<T;E++){p=d[E];v=Batman.helpers.pluralize(p);a=Batman.helpers.camelize(v,true);u=this._childBuilder({controller:a});if(o!=null){o.call(u)}for(t in n){f=n[t];if(!f){continue}g=this.constructor.ROUTES[t];s=g.name(v);h=g.path(v);m=Batman.extend({controller:a,action:t,path:h,as:s},c);u[g.cardinality](t,m)}}return true};t.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(e.call(arguments)))};t.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(e.call(arguments)))};t.prototype.root=function(e,t){return this.route("/",e,t)};t.prototype.route=function(e,t,n,r){if(!r){if(typeof n==="function"){r=n;n=void 0}else if(typeof t==="function"){r=t;t=void 0}}if(!n){if(typeof t==="string"){n={signature:t}}else{n=t}n||(n={})}else{if(t){n.signature=t}}if(r){n.callback=r}n.as||(n.as=this._nameFromPath(e));n.path=e;return this._addRoute(n)};t.prototype._addRoutesWithCardinality=function(){var t,n,r,i,s,o,u,a,f,l;t=arguments[0],r=3<=arguments.length?e.call(arguments,1,a=arguments.length-1):(a=1,[]),i=arguments[a++];if(typeof i==="string"){r.push(i);i={}}i=Batman.extend({},this.baseOptions,i);i[t]=true;u=this.constructor.ROUTES[t];s=Batman.helpers.underscore(i.controller);for(f=0,l=r.length;f<l;f++){n=r[f];o=Batman.extend({action:n},i);if(o.path==null){o.path=u.path(s,n)}if(o.as==null){o.as=u.name(s,n)}this._addRoute(o)}return true};t.prototype._addRoute=function(e){var t,n,r,i;if(e==null){e={}}r=this.rootPath+e.path;n=this.rootName+Batman.helpers.camelize(e.as,true);delete e.as;delete e.path;t=e.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute;e.app=this.app;i=new t(r,e);return this.routeMap.addRoute(n,i)};t.prototype._nameFromPath=function(e){e=e.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"");return e};t.prototype._nestingPath=function(){var e,t;if(!this.parent){return""}else{e=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id";t=Batman.helpers.underscore(this.baseOptions.controller);return""+this.parent._nestingPath()+t+"/"+e+"/"}};t.prototype._nestingName=function(){if(!this.parent){return""}else{return this.parent._nestingName()+this.baseOptions.controller+"."}};t.prototype._childBuilder=function(e){if(e==null){e={}}return new Batman.RouteMapBuilder(this.app,this.routeMap,this,e)};return t}()}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.App=function(t){function f(){e=f.__super__.constructor.apply(this,arguments);return e}var r,i,s,o,u,a=this;n(f,t);f.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":true});f.classAccessor("paramsManager",{get:function(){var e,t;if(!(e=this.get("navigator"))){return}t=this.get("currentParams");return t.replacer=new Batman.ParamsReplacer(e,t)},"final":true});f.classAccessor("paramsPusher",{get:function(){var e,t;if(!(e=this.get("navigator"))){return}t=this.get("currentParams");return t.pusher=new Batman.ParamsPusher(e,t)},"final":true});f.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))});f.classAccessor("routeMap",function(){return new Batman.RouteMap});f.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))});f.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))});f.classAccessor("controllers",function(){return this.get("dispatcher.controllers")});f.layout=void 0;f.shouldAllowEvent={};u=Batman.RouteMapBuilder.BUILDER_FUNCTIONS;i=function(e){return f[e]=function(){var t;return(t=this.get("routeMapBuilder"))[e].apply(t,arguments)}};for(s=0,o=u.length;s<o;s++){r=u[s];i(r)}f.event("ready").oneShot=true;f.event("run").oneShot=true;f.run=function(){var e,t,r,i,s=this;if(Batman.currentApp){if(Batman.currentApp===this){return}Batman.currentApp.stop()}if(this.hasRun){return false}if(this.isPrevented("run")){this.wantsToRun=true;return false}else{delete this.wantsToRun}Batman.currentApp=this;Batman.App.set("current",this);if(this.get("dispatcher")==null){this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap")));this.set("controllers",this.get("dispatcher.controllers"))}if(this.get("navigator")==null){this.set("navigator",Batman.Navigator.forApp(this));Batman.navigator=this.get("navigator");this.on("run",function(){if(Object.keys(s.get("dispatcher").routeMap).length>0){return Batman.navigator.start()}})}this.observe("layout",function(e){return e!=null?e.on("ready",function(){return s.fire("ready")}):void 0});t=this.get("layout");if(t){if(typeof t==="string"){r=this[Batman.helpers.camelize(t)+"View"]}}else{if(t!==null){r=e=function(e){function t(){i=t.__super__.constructor.apply(this,arguments);return i}n(t,e);return t}(Batman.View)}}if(r){t=this.set("layout",new r({node:document.documentElement}));t.propagateToSubviews("viewWillAppear");t.initializeBindings();t.propagateToSubviews("isInDOM",true);t.propagateToSubviews("viewDidAppear")}if(Batman.config.translations){this.set("t",Batman.I18N.get("translations"))}this.hasRun=true;this.fire("run");return this};f.event("ready").oneShot=true;f.event("stop").oneShot=true;f.stop=function(){var e;if((e=this.navigator)!=null){e.stop()}Batman.navigator=null;this.hasRun=false;this.fire("stop");return this};return f}.call(this,Batman.Object)}).call(this);(function(){Batman.Association=function(){function e(e,t,n){var r,i,s,o,u;this.model=e;this.label=t;if(n==null){n={}}i={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))};this.options=Batman.extend(i,this.defaultOptions,n);if(this.options.nestUrl){if(this.model.urlNestsUnder==null){Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association")}this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))}if(this.options.extend!=null){Batman.extend(this,this.options.extend)}s={encode:this.options.saveInline?this.encoder():false,decode:this.decoder()};o=n.encoderKey||this.label;this.model.encode(o,s);r=this;u=function(){return r.getAccessor.call(this,r,this.model,this.label)};this.model.accessor(this.label,{get:u,set:e.defaultAccessor.set,unset:e.defaultAccessor.unset})}e.prototype.associationType="";e.prototype.isPolymorphic=false;e.prototype.defaultOptions={saveInline:true,autoload:true,nestUrl:false};e.prototype.getRelatedModel=function(){var e,t,n;n=this.options.namespace||Batman.currentApp;e=this.options.name;t=n!=null?n[e]:void 0;Batman.developer["do"](function(){if(Batman.currentApp!=null&&!t){return Batman.developer.warn("Related model "+e+" hasn't loaded yet.")}});return t};e.prototype.getFromAttributes=function(e){return e.get("attributes."+this.label)};e.prototype.setIntoAttributes=function(e,t){return e.get("attributes").set(this.label,t)};e.prototype.inverse=function(){var e,t,n=this;if(t=this.getRelatedModel()._batman.get("associations")){if(this.options.inverseOf){return t.getByLabel(this.options.inverseOf)}e=null;t.forEach(function(t,r){if(r.getRelatedModel()===n.model){return e=r}});return e}};e.prototype.reset=function(){delete this.index;return true};return e}()}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PluralAssociation=function(e){function n(){n.__super__.constructor.apply(this,arguments);this._resetSetHashes()}t(n,e);n.prototype.proxyClass=Batman.AssociationSet;n.prototype.isSingular=false;n.prototype.setForRecord=function(e){var t,n,r=this;n=this.indexValueForRecord(e);t=this.setIndex();Batman.Property.withoutTracking(function(){return r._setsByRecord.getOrSet(e,function(){var e,t;if(n!=null){e=r._setsByValue.get(n);if(e!=null){return e}}t=r.proxyClassInstanceForKey(n);if(n!=null){r._setsByValue.set(n,t)}return t})});if(n!=null){return t.get(n)}else{return this._setsByRecord.get(e)}};n.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(e){var t,n=this;t=void 0;this._setsByRecord.forEach(function(r,i){if(t!=null){return}if(n.indexValueForRecord(r)===e){return t=i}});if(t!=null){t.foreignKeyValue=e;return t}return this._setsByValue.getOrSet(e,function(){return n.proxyClassInstanceForKey(e)})});n.prototype.proxyClassInstanceForKey=function(e){return new this.proxyClass(e,this)};n.prototype.getAccessor=function(e,t,n){var r,i,s=this;if(!e.getRelatedModel()){return}if(i=e.getFromAttributes(this)){return i}else{r=e.setForRecord(this);e.setIntoAttributes(this,r);Batman.Property.withoutTracking(function(){if(e.options.autoload&&!s.isNew()&&!r.loaded){return r.load(function(e,t){if(e){throw e}})}});return r}};n.prototype.parentSetIndex=function(){this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey));return this.parentIndex};n.prototype.setIndex=function(){this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn]));return this.index};n.prototype.indexValueForRecord=function(e){return e.get(this.primaryKey)};n.prototype.reset=function(){n.__super__.reset.apply(this,arguments);return this._resetSetHashes()};n.prototype._resetSetHashes=function(){this._setsByRecord=new Batman.SimpleHash;return this._setsByValue=new Batman.SimpleHash};return n}(Batman.Association)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.HasManyAssociation=function(e){function n(e,t,r){if(r!=null?r.as:void 0){return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){})}n.__super__.constructor.apply(this,arguments);this.primaryKey=this.options.primaryKey||"id";this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(e.get("resourceName"))+"_id"}t(n,e);n.prototype.associationType="hasMany";n.prototype.indexRelatedModelOn="foreignKey";n.prototype.apply=function(e,t){var n,r,i=this;if(!e){if(n=this.getFromAttributes(t)){n.forEach(function(e){return e.set(i.foreignKey,t.get(i.primaryKey))})}t.set(this.label,r=this.setForRecord(t));if(t.lifecycle.get("state")==="creating"){return r.markAsLoaded()}}};n.prototype.encoder=function(){var e;e=this;return function(t,n,r,i){var s;if(t!=null){s=[];t.forEach(function(t){var n;n=t.toJSON();if(!e.inverse()||e.inverse().options.encodeForeignKey){n[e.foreignKey]=i.get(e.primaryKey)}return s.push(n)})}return s}};n.prototype.decoder=function(){var e;e=this;return function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m;if(!(p=e.getRelatedModel())){Batman.developer.error("Can't decode model "+e.options.name+" because it hasn't been loaded yet!");return}o=e.setForRecord(s);f=o.filter(function(e){return e.isNew()}).toArray();h=[];c=[];for(d=0,v=t.length;d<v;d++){a=t[d];u=a[p.primaryKey];l=p._loadIdentity(u);if(l!=null){c.push(l)}else{if(f.length>0){l=f.shift();if(u!=null){h.push(l)}}else{l=new p;if(u!=null){h.push(l)}c.push(l)}}l._withoutDirtyTracking(function(){this.fromJSON(a);if(e.options.inverseOf){return l.set(e.options.inverseOf,s)}})}(m=p.get("loaded")).add.apply(m,h);o.add.apply(o,c);o.markAsLoaded();return o}};return n}(Batman.PluralAssociation)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PolymorphicHasManyAssociation=function(e){function n(e,t,r){r.inverseOf=this.foreignLabel=r.as;delete r.as;r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id");n.__super__.constructor.call(this,e,t,r);this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type";this.model.encode(this.foreignTypeKey)}t(n,e);n.prototype.proxyClass=Batman.PolymorphicAssociationSet;n.prototype.isPolymorphic=true;n.prototype.apply=function(e,t){var r,i=this;if(!e){if(r=this.getFromAttributes(t)){n.__super__.apply.apply(this,arguments);r.forEach(function(e){return e.set(i.foreignTypeKey,i.modelType())})}}};n.prototype.proxyClassInstanceForKey=function(e){return new this.proxyClass(e,this.modelType(),this)};n.prototype.getRelatedModelForType=function(e){var t,n;n=this.options.namespace||Batman.currentApp;if(e){t=n!=null?n[e]:void 0;t||(t=n!=null?n[Batman.helpers.camelize(e)]:void 0)}else{t=this.getRelatedModel()}Batman.developer["do"](function(){if(Batman.currentApp!=null&&!t){return Batman.developer.warn("Related model "+e+" for polymorphic association not found.")}});return t};n.prototype.modelType=function(){return this.model.get("resourceName")};n.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn]))};n.prototype.encoder=function(){var e;e=this;return function(t,n,r,i){var s;if(t!=null){s=[];t.forEach(function(t){var n;n=t.toJSON();n[e.foreignKey]=i.get(e.primaryKey);n[e.foreignTypeKey]=e.modelType();return s.push(n)})}return s}};n.prototype.decoder=function(){var e;e=this;return function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v;o=e.getFromAttributes(s)||e.setForRecord(s);f=o.filter(function(e){return e.isNew()}).toArray();c=[];for(d=0,v=t.length;d<v;d++){a=t[d];p=a[e.options.foreignTypeKey];if(!(h=e.getRelatedModelForType(p))){Batman.developer.error("Can't decode model "+e.options.name+" because it hasn't been loaded yet!");return}u=a[h.primaryKey];l=h._loadIdentity(u);if(l!=null){l._withoutDirtyTracking(function(){return this.fromJSON(a)});c.push(l)}else{if(f.length>0){l=f.shift();l._withoutDirtyTracking(function(){return this.fromJSON(a)});l=h._mapIdentity(l)}else{l=h._makeOrFindRecordFromData(a);c.push(l)}}if(e.options.inverseOf){l._withoutDirtyTracking(function(){return l.set(e.options.inverseOf,s)})}}o.add.apply(o,c);o.markAsLoaded();return o}};return n}(Batman.HasManyAssociation)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.SingularAssociation=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.isSingular=true;r.prototype.getAccessor=function(e,t,n){var r,i,s,o=this;if(s=e.getFromAttributes(this)){return s}if(e.getRelatedModel()){r=this.associationProxy(e);i=false;if(r._loadSetter==null){r._loadSetter=r.once("loaded",function(t){return o._withoutDirtyTracking(function(){return this.set(e.label,t)})})}if(!Batman.Property.withoutTracking(function(){return r.get("loaded")})){if(e.options.autoload){Batman.Property.withoutTracking(function(){return r.load()})}else{i=r.loadFromLocal()}}return i||r}};r.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn]))};return r}(Batman.Association)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.HasOneAssociation=function(e){function n(){n.__super__.constructor.apply(this,arguments);this.primaryKey=this.options.primaryKey||"id";this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}t(n,e);n.prototype.associationType="hasOne";n.prototype.proxyClass=Batman.HasOneProxy;n.prototype.indexRelatedModelOn="foreignKey";n.prototype.apply=function(e,t){var n;if(!e){if(n=this.getFromAttributes(t)){return n.set(this.foreignKey,t.get(this.primaryKey))}}};n.prototype.encoder=function(){var e;e=this;return function(t,n,r,i){var s;if(!e.options.saveInline){return}if(s=t.toJSON()){s[e.foreignKey]=i.get(e.primaryKey)}return s}};n.prototype.decoder=function(){var e;e=this;return function(t,n,r,i,s){var o,u;if(!t){return}u=e.getRelatedModel();o=u.createFromJSON(t);if(e.options.inverseOf){o.set(e.options.inverseOf,s)}return o}};return n}(Batman.SingularAssociation)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.BelongsToAssociation=function(e){function n(e,t,r){if(r!=null?r.polymorphic:void 0){delete r.polymorphic;return function(e,t,n){n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return Object(i)===i?i:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})}n.__super__.constructor.apply(this,arguments);this.foreignKey=this.options.foreignKey||""+this.label+"_id";this.primaryKey=this.options.primaryKey||"id";if(this.options.encodeForeignKey){this.model.encode(this.foreignKey)}}t(n,e);n.prototype.associationType="belongsTo";n.prototype.proxyClass=Batman.BelongsToProxy;n.prototype.indexRelatedModelOn="primaryKey";n.prototype.defaultOptions={saveInline:false,autoload:true,encodeForeignKey:true};n.prototype.encoder=function(){return function(e){return e.toJSON()}};n.prototype.decoder=function(){var e;e=this;return function(t,n,r,i,s){var o,u,a;a=e.getRelatedModel();u=a.createFromJSON(t);if(e.options.inverseOf){if(o=e.inverse()){if(o instanceof Batman.HasManyAssociation){s.set(e.foreignKey,u.get(e.primaryKey))}else{u.set(o.label,s)}}}s.set(e.label,u);return u}};n.prototype.apply=function(e){var t,n;if(n=e.get(this.label)){t=n.get(this.primaryKey);if(t!==void 0){return e.set(this.foreignKey,t)}}};return n}(Batman.SingularAssociation)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.PolymorphicBelongsToAssociation=function(e){function n(){n.__super__.constructor.apply(this,arguments);this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type";if(this.options.encodeForeignTypeKey){this.model.encode(this.foreignTypeKey)}this.typeIndicies={}}t(n,e);n.prototype.isPolymorphic=true;n.prototype.proxyClass=Batman.PolymorphicBelongsToProxy;n.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:true});n.prototype.getRelatedModel=false;n.prototype.setIndex=false;n.prototype.inverse=false;n.prototype.apply=function(e){var t,r;n.__super__.apply.apply(this,arguments);if(r=e.get(this.label)){t=r instanceof Batman.PolymorphicBelongsToProxy?r.get("foreignTypeValue"):r.constructor.get("resourceName");return e.set(this.foreignTypeKey,t)}};n.prototype.getAccessor=function(e,t,n){var r,i;if(i=e.getFromAttributes(this)){return i}if(e.getRelatedModelForType(this.get(e.foreignTypeKey))){r=this.associationProxy(e);Batman.Property.withoutTracking(function(){if(!r.get("loaded")&&e.options.autoload){return r.load()}});return r}};n.prototype.url=function(e){var t,n,r,i,s,o,u,a;o=(u=e.data)!=null?u[this.foreignTypeKey]:void 0;if(o&&(i=this.inverseForType(o))){s=Batman.helpers.pluralize(o).toLowerCase();r=(a=e.data)!=null?a[this.foreignKey]:void 0;n=i.isSingular?"singularize":"pluralize";t=Batman.helpers[n](i.label);return"/"+s+"/"+r+"/"+t}};n.prototype.getRelatedModelForType=function(e){var t,n;n=this.options.namespace||Batman.currentApp;if(e){t=n!=null?n[e]:void 0;t||(t=n!=null?n[Batman.helpers.camelize(e)]:void 0)}Batman.developer["do"](function(){if(Batman.currentApp!=null&&!t){return Batman.developer.warn("Related model "+e+" for polymorphic association not found.")}});return t};n.prototype.setIndexForType=function(e){var t;(t=this.typeIndicies)[e]||(t[e]=new Batman.PolymorphicUniqueAssociationSetIndex(this,e,this.primaryKey));return this.typeIndicies[e]};n.prototype.inverseForType=function(e){var t,n,r,i=this;if(n=(r=this.getRelatedModelForType(e))!=null?r._batman.get("associations"):void 0){if(this.options.inverseOf){return n.getByLabel(this.options.inverseOf)}t=null;n.forEach(function(e,n){if(n.getRelatedModel()===i.model){return t=n}});return t}};n.prototype.decoder=function(){var e;e=this;return function(t,n,r,i,s){var o,u,a,f;o=r[e.foreignTypeKey]||s.get(e.foreignTypeKey);f=e.getRelatedModelForType(o);a=f.createFromJSON(t);if(e.options.inverseOf){if(u=e.inverseForType(o)){if(u instanceof Batman.PolymorphicHasManyAssociation){s.set(e.foreignKey,a.get(e.primaryKey));s.set(e.foreignTypeKey,o)}else{a.set(u.label,s)}}}s.set(e.label,a);return a}};return n}(Batman.BelongsToAssociation)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t},n=[].slice;Batman.Validator=function(e){function r(){var e,t;t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[];this.options=t;r.__super__.constructor.apply(this,e)}t(r,e);r.triggers=function(){var e;e=1<=arguments.length?n.call(arguments,0):[];if(this._triggers!=null){return this._triggers.concat(e)}else{return this._triggers=e}};r.options=function(){var e;e=1<=arguments.length?n.call(arguments,0):[];if(this._options!=null){return this._options.concat(e)}else{return this._options=e}};r.matches=function(e){var t,n,r,i,s,o;n={};r=false;for(t in e){i=e[t];if(~((s=this._options)!=null?s.indexOf(t):void 0)){n[t]=i}if(~((o=this._triggers)!=null?o.indexOf(t):void 0)){n[t]=i;r=true}}if(r){return n}};r.prototype.validate=function(e){return Batman.developer.error("You must override validate in Batman.Validator subclasses.")};r.prototype.format=function(e,t,n){return Batman.t("errors.messages."+t,n)};r.prototype.handleBlank=function(e){if(this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(e)){return true}};return r}(Batman.Object)}).call(this);(function(){Batman.Validators=[];Batman.extend(Batman.translate.messages,{errors:{base:{format:"%{message}"},format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list"}}})}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.RegExpValidator=function(e){function n(e){var t;this.regexp=(t=e.regexp)!=null?t:e.pattern;n.__super__.constructor.apply(this,arguments)}t(n,e);n.triggers("regexp","pattern");n.options("allowBlank");n.prototype.validateEach=function(e,t,n,r){var i;i=t.get(n);if(this.handleBlank(i)){return r()}if(i==null||i===""||!this.regexp.test(i)){e.add(n,this.format(n,"not_matching"))}return r()};return n}(Batman.Validator);Batman.Validators.push(Batman.RegExpValidator)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.PresenceValidator=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.triggers("presence");r.prototype.validateEach=function(e,t,n,r){var i;i=t.get(n);if(!this.isPresent(i)){e.add(n,this.format(n,"blank"))}return r()};r.prototype.isPresent=function(e){return e!=null&&e!==""};return r}(Batman.Validator);Batman.Validators.push(Batman.PresenceValidator)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.NumericValidator=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo");r.options("allowBlank");r.prototype.validateEach=function(e,t,n,r){var i,s;i=this.options;s=t.get(n);if(this.handleBlank(s)){return r()}if(s==null||!(this.isNumeric(s)||this.canCoerceToNumeric(s))){e.add(n,this.format(n,"not_numeric"))}else{if(i.greaterThan!=null&&s<=i.greaterThan){e.add(n,this.format(n,"greater_than",{count:i.greaterThan}))}if(i.greaterThanOrEqualTo!=null&&s<i.greaterThanOrEqualTo){e.add(n,this.format(n,"greater_than_or_equal_to",{count:i.greaterThanOrEqualTo}))}if(i.equalTo!=null&&s!==i.equalTo){e.add(n,this.format(n,"equal_to",{count:i.equalTo}))}if(i.lessThan!=null&&s>=i.lessThan){e.add(n,this.format(n,"less_than",{count:i.lessThan}))}if(i.lessThanOrEqualTo!=null&&s>i.lessThanOrEqualTo){e.add(n,this.format(n,"less_than_or_equal_to",{count:i.lessThanOrEqualTo}))}}return r()};r.prototype.isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};r.prototype.canCoerceToNumeric=function(e){return e-0==e&&e.length>0};return r}(Batman.Validator);Batman.Validators.push(Batman.NumericValidator)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.LengthValidator=function(e){function n(e){var t;if(t=e.lengthIn||e.lengthWithin){e.minLength=t[0];e.maxLength=t[1]||-1;delete e.lengthWithin;delete e.lengthIn}n.__super__.constructor.apply(this,arguments)}t(n,e);n.triggers("minLength","maxLength","length","lengthWithin","lengthIn");n.options("allowBlank");n.prototype.validateEach=function(e,t,n,r){var i,s;i=this.options;s=t.get(n);if(s!==""&&this.handleBlank(s)){return r()}if(s==null){s=[]}if(i.minLength&&s.length<i.minLength){e.add(n,this.format(n,"too_short",{count:i.minLength}))}if(i.maxLength&&s.length>i.maxLength){e.add(n,this.format(n,"too_long",{count:i.maxLength}))}if(i.length&&s.length!==i.length){e.add(n,this.format(n,"wrong_length",{count:i.length}))}return r()};return n}(Batman.Validator);Batman.Validators.push(Batman.LengthValidator)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.InclusionValidator=function(e){function n(e){this.acceptableValues=e.inclusion["in"];n.__super__.constructor.apply(this,arguments)}t(n,e);n.triggers("inclusion");n.prototype.validateEach=function(e,t,n,r){if(this.acceptableValues.indexOf(t.get(n))===-1){e.add(n,this.format(n,"not_included_in_list"))}return r()};return n}(Batman.Validator);Batman.Validators.push(Batman.InclusionValidator)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.ExclusionValidator=function(e){function n(e){this.unacceptableValues=e.exclusion["in"];n.__super__.constructor.apply(this,arguments)}t(n,e);n.triggers("exclusion");n.prototype.validateEach=function(e,t,n,r){if(this.unacceptableValues.indexOf(t.get(n))>=0){e.add(n,this.format(n,"included_in_list"))}return r()};return n}(Batman.Validator);Batman.Validators.push(Batman.ExclusionValidator)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.AssociatedValidator=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.triggers("associated");r.prototype.validateEach=function(e,t,n,r){var i,s,o,u=this;o=t.get(n);if(o!=null){if(o instanceof Batman.AssociationProxy){o=typeof o.get==="function"?o.get("target"):void 0}s=1;i=function(t,i){if(i.length>0){e.add(n,u.format(n,"invalid_association"))}if(--s===0){return r()}};if((o!=null?o.forEach:void 0)!=null){o.forEach(function(e){s+=1;return e.validate(i)})}else if((o!=null?o.validate:void 0)!=null){s+=1;o.validate(i)}return i(null,[])}else{return r()}};return r}(Batman.Validator);Batman.Validators.push(Batman.AssociatedValidator)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.ControllerActionFrame=function(e){function n(e,t){n.__super__.constructor.call(this,e);this.once("complete",t)}t(n,e);n.prototype.operationOccurred=false;n.prototype.remainingOperations=0;n.prototype.event("complete").oneShot=true;n.prototype.startOperation=function(e){if(e==null){e={}}if(!e.internal){this.operationOccurred=true}this._changeOperationsCounter(1);return true};n.prototype.finishOperation=function(){this._changeOperationsCounter(-1);return true};n.prototype.startAndFinishOperation=function(e){this.startOperation(e);this.finishOperation(e);return true};n.prototype._changeOperationsCounter=function(e){var t;this.remainingOperations+=e;if(this.remainingOperations===0){this.fire("complete")}if((t=this.parentFrame)!=null){t._changeOperationsCounter(e)}};return n}(Batman.Object)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.HTMLStore=function(e){function n(){n.__super__.constructor.apply(this,arguments);this._htmlContents={};this._requestedPaths=new Batman.SimpleSet}t(n,e);n.prototype.propertyClass=Batman.Property;n.prototype.fetchHTML=function(e){var t=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+e+".html"),type:"html",success:function(n){return t.set(e,n)},error:function(t){throw new Error("Could not load html from "+e)}})};n.accessor({"final":true,get:function(e){var t;if(e.charAt(0)!=="/"){return this.get("/"+e)}if(this._htmlContents[e]){return this._htmlContents[e]}if(this._requestedPaths.has(e)){return}if(t=this._sourceFromDOM(e)){return t}if(Batman.config.fetchRemoteHTML){this.fetchHTML(e)}else{throw new Error("Couldn't find html source for '"+e+"'!")}},set:function(e,t){if(e.charAt(0)!=="/"){return this.set("/"+e,t)}this._requestedPaths.add(e);return this._htmlContents[e]=t}});n.prototype.prefetch=function(e){this.get(e);return true};n.prototype._sourceFromDOM=function(e){var t,n;n=e.slice(1);if(t=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']")){Batman.setImmediate(function(){var e;return(e=t.parentNode)!=null?e.removeChild(t):void 0});return Batman.View.store.set(Batman.Navigator.normalizePath(e),t.innerHTML)}};return n}(Batman.Object)}).call(this);(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e},i=[].slice;Batman.View=function(e){function t(){var e,n=this;this.bindings=[];this.subviews=new Batman.Set;this.subviews.on("itemsWereAdded",function(e){var t,r,i;for(r=0,i=e.length;r<i;r++){t=e[r];n._addSubview(t)}});this.subviews.on("itemsWereRemoved",function(e){var t,n,r;for(n=0,r=e.length;n<r;n++){t=e[n];t._removeFromSuperview()}});t.__super__.constructor.apply(this,arguments);if(e=this.superview){this.superview=null;e.subviews.add(this)}}r(t,e);t.store=new Batman.HTMLStore;t.option=function(){var e,t;e=1<=arguments.length?i.call(arguments,0):[];Batman.initializeObject(this);if(t=this._batman.options){e=t.concat(e)}return this._batman.set("options",e)};t.viewForNode=function(e,t){var n;if(t==null){t=true}while(e){if(n=Batman._data(e,"view")){return n}if(!t){return}e=e.parentNode}};t.prototype.bindings=[];t.prototype.subviews=[];t.prototype.superview=null;t.prototype.controller=null;t.prototype.source=null;t.prototype.html=null;t.prototype.node=null;t.prototype.bindImmediately=true;t.prototype.isBound=false;t.prototype.isInDOM=false;t.prototype.isView=true;t.prototype.isDead=false;t.prototype.isBackingView=false;t.prototype._addChildBinding=function(e){return this.bindings.push(e)};t.prototype._addSubview=function(e){var t,n,r;t=e.controller;e.removeFromSuperview();e.set("controller",t||this.controller);e.set("superview",this);e.fire("viewDidMoveToSuperview");if((n=e.contentFor)&&!e.parentNode){r=Batman.DOM.Yield.withName(n);r.set("contentView",e)}this.get("node");e.get("node");this.observe("node",e._nodesChanged);e.observe("node",e._nodesChanged);e.observe("parentNode",e._nodesChanged);return e._nodesChanged()};t.prototype._removeFromSuperview=function(){var e;if(!this.superview){return}this.fire("viewWillRemoveFromSuperview");this.forget("node",this._nodesChanged);this.forget("parentNode",this._nodesChanged);this.superview.forget("node",this._nodesChanged);e=this.get("superview");this.removeFromParentNode();this.set("superview",null);return this.set("controller",null)};t.prototype.removeFromSuperview=function(){var e;return(e=this.superview)!=null?e.subviews.remove(this):void 0};t.prototype._nodesChanged=function(){var e,t;if(!this.node){return}if(this.bindImmediately){this.initializeBindings()}t=this.superview.get("node");e=this.parentNode;if(typeof e==="string"){e=Batman.DOM.querySelector(t,e)}if(!e){e=t}if(e){return this.addToParentNode(e)}};t.prototype.addToParentNode=function(e){var t;if(!this.get("node")){return}t=Batman.DOM.containsNode(e);if(t){this.propagateToSubviews("viewWillAppear")}this.insertIntoDOM(e);this.propagateToSubviews("isInDOM",t);if(t){return this.propagateToSubviews("viewDidAppear")}};t.prototype.insertIntoDOM=function(e){if(e!==this.node){return e.appendChild(this.node)}};t.prototype.removeFromParentNode=function(){var e,t,n,r,i;t=this.get("node");e=(n=this.wasInDOM)!=null?n:Batman.DOM.containsNode(t);if(e){this.propagateToSubviews("viewWillDisappear")}if((r=this.node)!=null){if((i=r.parentNode)!=null){i.removeChild(this.node)}}this.propagateToSubviews("isInDOM",false);if(e){return this.propagateToSubviews("viewDidDisappear")}};t.prototype.propagateToSubviews=function(e,t){var n,r,i,s,o;if(t!=null){this.set(e,t)}else{this.fire(e);if(typeof this[e]==="function"){this[e]()}}s=this.subviews._storage;o=[];for(r=0,i=s.length;r<i;r++){n=s[r];o.push(n.propagateToSubviews(e,t))}return o};t.prototype.loadView=function(e){var t,n;if((t=this.get("html"))!=null){n=e||document.createElement("div");Batman.DOM.setInnerHTML(n,t);return n}};t.accessor("html",{get:function(){var e,t,n,r=this;if(this.html!=null){return this.html}if(!(n=this.get("source"))){return}n=Batman.Navigator.normalizePath(n);this.html=this.constructor.store.get(n);if(this.html==null){t=this.property("html");e=function(n){if(n!=null){r.set("html",n)}return t.removeHandler(e)};t.addHandler(e)}return this.html},set:function(e,t){this.destroyBindings();this.destroySubviews();this.html=t;if(this.node&&t!=null){this.loadView(this.node)}if(this.bindImmediately){return this.initializeBindings()}}});t.accessor("node",{get:function(){var e;if(this.node==null&&!this.isDead){e=this.loadView();if(e){this.set("node",e)}this.fire("viewDidLoad")}return this.node},set:function(e,t,n){var r=this;if(n){Batman.removeData(n,"view",true)}if(t===this.node){return}this.destroyBindings();this.destroySubviews();this.node=t;if(!t){return}Batman._data(t,"view",this);Batman.developer["do"](function(){var e,n;e=r.get("displayName")||r.get("source");return typeof (n=t===document?document.body:t).setAttribute==="function"?n.setAttribute("batman-view",r.constructor.name+(e?": "+e:"")):void 0});return t}});t.prototype.event("ready").oneShot=true;t.prototype.initializeBindings=function(){if(this.isBound||!this.node){return}new Batman.BindingParser(this);this.set("isBound",true);this.fire("ready");return typeof this.ready==="function"?this.ready():void 0};t.prototype.destroyBindings=function(){var e,t,n,r;r=this.bindings;for(t=0,n=r.length;t<n;t++){e=r[t];e.die()}this.bindings=[];return this.isBound=false};t.prototype.destroySubviews=function(){var e,t,n,r;if(this.isDead){Batman.developer.warn("Tried to destroy the subviews of a dead view.");return}r=this.subviews.toArray();for(t=0,n=r.length;t<n;t++){e=r[t];e.die()}return this.subviews.clear()};t.prototype.die=function(){var e,t,n,r;if(this.isDead){Batman.developer.warn("Tried to die() a view more than once.");return}this.fire("destroy");if(this.node){this.wasInDOM=Batman.DOM.containsNode(this.node);Batman.DOM.destroyNode(this.node)}this.forget();if((n=this._batman.properties)!=null){n.forEach(function(e,t){return t.die()})}if(this._batman.events){r=this._batman.events;for(t in r){e=r[t];e.clearHandlers()}}this.destroyBindings();this.destroySubviews();this.removeFromSuperview();this.node=null;this.parentNode=null;this.subviews=null;return this.isDead=true};t.prototype.baseForKeypath=function(e){return e.split(".")[0].split("|")[0].trim()};t.prototype.prefixForKeypath=function(e){var t;t=e.lastIndexOf(".");if(t!==-1){return e.substr(0,t)}else{return e}};t.prototype.targetForKeypath=function(e,t){var n,r,i,s;s=this.get("proxiedObject");r=s||this;while(r){if(typeof Batman.get(r,e)!=="undefined"){return r}if(t&&!i&&!r.isBackingView){i=r}if(!n&&r.isView&&r.controller){n=r.controller}if(s&&r===s){r=this}else if(r.isView&&r.superview){r=r.superview}else if(n){r=n;n=null}else if(!r.window){if(Batman.currentApp&&r!==Batman.currentApp){r=Batman.currentApp}else{r={window:Batman.container}}}else{break}}return i};t.prototype.lookupKeypath=function(e){var t,n;t=this.baseForKeypath(e);n=this.targetForKeypath(t);if(n){return Batman.get(n,e)}};t.prototype.setKeypath=function(e,t){var n,r,i;n=this.prefixForKeypath(e);r=this.targetForKeypath(n,true);if(!r||r===Batman.container){return}return(i=Batman.Property.forBaseAndKey(r,e))!=null?i.setValue(t):void 0};return t}(Batman.Object);if((e=Batman.container).$context==null){e.$context=function(e){var t;while(e){if(t=Batman._data(e,"backingView")||Batman._data(e,"view")){return t}e=e.parentNode}}}if((t=Batman.container).$subviews==null){t.$subviews=function(e){var t;if(e==null){e=Batman.currentApp.layout}t=[];e.subviews.forEach(function(e){var n,r;n=Batman.mixin({},e);n.constructor=e.constructor;n.subviews=((r=e.subviews)!=null?r.length:void 0)?$subviews(e):null;Batman.unmixin(n,{_batman:true});return t.push(n)});return t}}}).call(this);(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.DOM.AbstractBinding=function(e){function f(e){this._fireDataChange=t(this._fireDataChange,this);var n;this.node=e.node,this.keyPath=e.keyPath,this.view=e.view;if(e.onlyObserve){this.onlyObserve=e.onlyObserve}if(e.skipParseFilter!=null){this.skipParseFilter=e.skipParseFilter}if(!this.skipParseFilter){this.parseFilter()}if(typeof this.backWithView==="function"){n=this.backWithView}if(this.backWithView){this.setupBackingView(n,e.viewOptions)}if(this.bindImmediately){this.bind()}}var n,i,s,o,u,a;r(f,e);s=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9\_\-]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.\?\!\+]*))\s*(?=$|,)/g;n=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/;i=/(?!^\s*)\[(.*?)\]/g;f.accessor("filteredValue",{get:function(){var e,t,n;n=this.get("unfilteredValue");t=this;if(this.filterFunctions.length>0){e=this.filterFunctions.reduce(function(e,n,r){var i;i=t.filterArguments[r].map(function(e){if(e._keypath){return t.view.lookupKeypath(e._keypath)}else{return e}});i.unshift(e);while(i.length<n.length-1){i.push(void 0)}i.push(t);return n.apply(t.view,i)},n);return e}else{return n}},set:function(e,t){return this.set("unfilteredValue",t)}});f.accessor("unfilteredValue",{get:function(){return this._unfilteredValue(this.get("key"))},set:function(e,t){var n;if(n=this.get("key")){return this.view.setKeypath(n,t)}else{return this.set("value",t)}}});f.prototype._unfilteredValue=function(e){if(e){return this.view.lookupKeypath(e)}else{return this.get("value")}};o=Batman.BindingDefinitionOnlyObserve.All;u=Batman.BindingDefinitionOnlyObserve.Data;a=Batman.BindingDefinitionOnlyObserve.Node;f.prototype.bindImmediately=true;f.prototype.shouldSet=true;f.prototype.isInputBinding=false;f.prototype.escapeValue=true;f.prototype.onlyObserve=o;f.prototype.skipParseFilter=false;f.prototype.isTwoWay=function(){return this.key!=null&&this.filterFunctions.length===0};f.prototype.bind=function(){var e,t;if(this.node&&((e=this.onlyObserve)===o||e===a)&&Batman.DOM.nodeIsEditable(this.node)){Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this));if(this.onlyObserve===a){this._fireNodeChange()}}if((t=this.onlyObserve)===o||t===u){this.observeAndFire("filteredValue",this._fireDataChange)}return this.view._addChildBinding(this)};f.prototype._fireNodeChange=function(e){var t;this.shouldSet=false;t=this.value||this.get("keyContext");if(typeof this.nodeChange==="function"){this.nodeChange(this.node,t,e)}this.fire("nodeChange",this.node,t);return this.shouldSet=true};f.prototype._fireDataChange=function(e){if(this.shouldSet){if(typeof this.dataChange==="function"){this.dataChange(e,this.node)}return this.fire("dataChange",e,this.node)}};f.prototype.die=function(){var e;this.forget();if((e=this._batman.properties)!=null){e.forEach(function(e,t){return t.die()})}this.node=null;this.keyPath=null;this.view=null;this.backingView=null;return this.superview=null};f.prototype.parseFilter=function(){var e,t,r,s,o,u,a,f,l,c;this.filterFunctions=[];this.filterArguments=[];f=this.keyPath;while(n.test(f)){f=f.replace(n,"]['$1']")}u=f.replace(i," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{a=this.parseSegment(l=u.shift())[0]}catch(h){t=h;Batman.developer.warn(t);Batman.developer.error("Error! Couldn't parse keypath in \""+l+'". Parsing error above.')}if(a&&a._keypath){this.key=a._keypath}else{this.value=a}if(u.length){while(o=u.shift()){c=o.indexOf(" ");if(c===-1){c=o.length}s=o.substr(0,c);e=o.substr(c);if(!(r=Batman.Filters[s])){return Batman.developer.error("Unrecognized filter '"+s+"' in key \""+this.keyPath+'"!')}this.filterFunctions.push(r);try{this.filterArguments.push(this.parseSegment(e))}catch(h){t=h;Batman.developer.error('Bad filter arguments "'+e+'"!')}}return true}};f.prototype.parseSegment=function(e){e=e.replace(s,function(e,t,n,r,i,s,o){var u;if(t==null){t=""}u=s?'{"_keypath": "'+s+'"}':n||r||i;return t+u});return JSON.parse("["+e+"]")};f.prototype.setupBackingView=function(e,t){if(this.backingView){return this.backingView}if(this.node&&(this.backingView=Batman._data(this.node,"view"))){return this.backingView}this.superview=this.view;t||(t={});if(t.node==null){t.node=this.node}if(t.parentNode==null){t.parentNode=this.node}t.isBackingView=true;this.backingView=new(e||Batman.BackingView)(t);this.superview.subviews.add(this.backingView);if(this.node){Batman._data(this.node,"view",this.backingView)}return this.backingView};return f}(Batman.Object);Batman.BackingView=function(t){function n(){e=n.__super__.constructor.apply(this,arguments);return e}r(n,t);n.prototype.isBackingView=true;n.prototype.bindImmediately=false;return n}(Batman.View)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.ViewBinding=function(e){function n(e){this.superview=e.view;n.__super__.constructor.apply(this,arguments)}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.skipChildren=true;n.prototype.bindImmediately=false;n.prototype.initialized=function(){return this.bind()};n.prototype.dataChange=function(e){var t,n,r,i,s,o,u,a;if((a=this.viewInstance)!=null){a.removeFromSuperview()}if(!e){return}if(e.isView){this.fromViewClass=false;this.viewInstance=e;this.viewInstance.removeFromSuperview()}else{this.fromViewClass=true;this.viewInstance=new e}this.node.removeAttribute("data-view");if(s=this.viewInstance.constructor._batman.get("options")){for(o=0,u=s.length;o<u;o++){i=s[o];t="data-view-"+i.toLowerCase();if(r=this.node.getAttribute(t)){this.node.removeAttribute(t);n=new Batman.DOM.ReaderBindingDefinition(this.node,r,this.superview);new Batman.DOM.ViewArgumentBinding(n,i,this.viewInstance)}}}this.viewInstance.set("parentNode",this.node);this.viewInstance.set("node",this.node);this.viewInstance.loadView(this.node);return this.superview.subviews.add(this.viewInstance)};n.prototype.die=function(){if(this.fromViewClass){this.viewInstance.die()}else{this.viewInstance.removeFromSuperview()}this.superview=null;this.viewInstance=null;return n.__super__.die.apply(this,arguments)};return n}(Batman.DOM.AbstractBinding);Batman.DOM.ViewArgumentBinding=function(e){function n(e,t,r){var i=this;this.option=t;this.targetView=r;n.__super__.constructor.call(this,e);this.targetView.observe(this.option,this._updateValue=function(e){if(i.isDataChanging){return}return i.view.set(i.keyPath,e)})}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.dataChange=function(e){this.isDataChanging=true;this.targetView.set(this.option,e);return this.isDataChanging=false};n.prototype.die=function(){this.targetView.forget(this.option,this._updateValue);this.targetView=null;return n.__super__.die.apply(this,arguments)};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.ValueBinding=function(e){function n(e){var t;this.isInputBinding=(t=e.node.nodeName.toLowerCase())==="input"||t==="textarea";n.__super__.constructor.apply(this,arguments)}t(n,e);n.prototype.nodeChange=function(e,t){if(this.isTwoWay()){return this.set("filteredValue",this.node.value)}};n.prototype.dataChange=function(e,t){return Batman.DOM.valueForNode(this.node,e,this.escapeValue)};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.ShowHideBinding=function(e){function n(e){var t;t=e.node.style.display;if(!t||t==="none"){t=""}this.originalDisplay=t;this.invert=e.invert;n.__super__.constructor.apply(this,arguments)}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.dataChange=function(e){var t;t=Batman.View.viewForNode(this.node,false);if(!!e===!this.invert){if(t!=null){t.fire("viewWillShow")}this.node.style.display=this.originalDisplay;return t!=null?t.fire("viewDidShow"):void 0}else{if(t!=null){t.fire("viewWillHide")}Batman.DOM.setStyleProperty(this.node,"display","none","important");return t!=null?t.fire("viewDidHide"):void 0}};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=function(e,t){return function(){return e.apply(t,arguments)}};Batman.SelectView=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype._addChildBinding=function(e){r.__super__._addChildBinding.apply(this,arguments);return this.fire("childBindingAdded",e)};return r}(Batman.BackingView);Batman.DOM.SelectBinding=function(e){function t(e){this.updateOptionBindings=r(this.updateOptionBindings,this);this.nodeChange=r(this.nodeChange,this);this.dataChange=r(this.dataChange,this);this.childBindingAdded=r(this.childBindingAdded,this);t.__super__.constructor.apply(this,arguments);this.node.removeAttribute("data-bind");this.node.removeAttribute("data-source");this.node.removeAttribute("data-target");this.backingView.on("childBindingAdded",this.childBindingAdded);this.backingView.initializeBindings()}n(t,e);t.prototype.backWithView=Batman.SelectView;t.prototype.isInputBinding=true;t.prototype.canSetImplicitly=true;t.prototype.skipChildren=true;t.prototype.die=function(){this.backingView.off("childBindingAdded",this.childBindingAdded);return t.__super__.die.apply(this,arguments)};t.prototype.childBindingAdded=function(e){var t=this;if(e instanceof Batman.DOM.CheckedBinding){e.on("dataChange",this.nodeChange)}else if(e instanceof Batman.DOM.IteratorBinding){e.backingView.on("itemsWereRendered",function(){return t._fireDataChange(t.get("filteredValue"))})}else{return}return this._fireDataChange(this.get("filteredValue"))};t.prototype.lastKeyContext=null;t.prototype.dataChange=function(e){var t,n,r,i,s,o,u,a=this;this.lastKeyContext||(this.lastKeyContext=this.get("keyContext"));if(this.lastKeyContext!==this.get("keyContext")){this.canSetImplicitly=true;this.lastKeyContext=this.get("keyContext")}if(e!=null?e.forEach:void 0){r={};u=this.node.children;for(i=0,s=u.length;i<s;i++){t=u[i];t.selected=false;n=r[o=t.value]||(r[o]=[]);n.push(t)}e.forEach(function(e){var t,n,i,s;if(t=r[e]){for(i=0,s=t.length;i<s;i++){n=t[i];n.selected=true}}})}else{if(e==null&&this.canSetImplicitly){if(this.node.value){this.canSetImplicitly=false;this.set("unfilteredValue",this.node.value)}}else{this.canSetImplicitly=false;Batman.DOM.valueForNode(this.node,e,this.escapeValue)}}this.updateOptionBindings();this.fixSelectElementWidth()};t.prototype.nodeChange=function(){var e;if(this.isTwoWay()){e=Batman.DOM.valueForNode(this.node);if(typeof e===Array&&e.length===1){e=e[0]}this.set("unfilteredValue",e);this.updateOptionBindings()}};t.prototype.updateOptionBindings=function(){var e,t,n,r;r=this.backingView.bindings;for(t=0,n=r.length;t<n;t++){e=r[t];if(e instanceof Batman.DOM.CheckedBinding){e._fireNodeChange()}}};t.prototype.fixSelectElementWidth=function(){var e=this;if(window.navigator.userAgent.toLowerCase().indexOf("msie")===-1){return}if(this._fixWidthTimeout){clearTimeout(this._fixWidthTimeout)}return this._fixWidthTimeout=setTimeout(function(){e._fixWidthTimeout=null;return e._fixSelectElementWidth()},100)};t.prototype._fixSelectElementWidth=function(){var e,t,n;t=(n=this.get("node"))!=null?n.style:void 0;if(!t){return}e=this.get("node").currentStyle.width;t.width="100%";return t.width=e!=null?e:""};return t}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.DOM.RouteBinding=function(n){function i(){this.routeClick=t(this.routeClick,this);e=i.__super__.constructor.apply(this,arguments);return e}r(i,n);i.prototype.onAnchorTag=false;i.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;i.accessor("dispatcher",function(){return this.view.lookupKeypath("dispatcher")||Batman.App.get("current.dispatcher")});i.prototype.bind=function(){var e;if((e=this.node.nodeName)==="a"||e==="A"){this.onAnchorTag=true}i.__super__.bind.apply(this,arguments);if(this.onAnchorTag&&this.node.getAttribute("target")){return}return Batman.DOM.events.click(this.node,this.routeClick)};i.prototype.routeClick=function(e,t){var n;if(t.__batmanActionTaken){return}t.__batmanActionTaken=true;n=this.pathFromValue(this.get("filteredValue"));if(n!=null){return Batman.redirect(n)}};i.prototype.dataChange=function(e){var t;if(e){t=this.pathFromValue(e)}if(this.onAnchorTag){if(t&&Batman.navigator){t=Batman.navigator.linkTo(t)}else{t="#"}return this.node.href=t}};i.prototype.pathFromValue=function(e){var t;if(e){if(e.isNamedRouteQuery){return e.get("path")}else{return(t=this.get("dispatcher"))!=null?t.pathFromParams(e):void 0}}};return i}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.RadioBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)});r.prototype.firstBind=true;r.prototype.dataChange=function(e){var t;t=this.get("filteredValue");if(t!=null){this.node.checked=t===Batman.DOM.attrReaders._parseAttribute(this.node.value)}else{if(this.firstBind&&this.node.checked){this.set("filteredValue",this.get("parsedNodeValue"))}}return this.firstBind=false};r.prototype.nodeChange=function(e){if(this.isTwoWay()){return this.set("filteredValue",this.get("parsedNodeValue"))}};return r}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.FileBinding=function(e){function n(){n.__super__.constructor.apply(this,arguments);this.view.set("fileAttributes",null)}t(n,e);n.prototype.isInputBinding=true;n.prototype.nodeChange=function(e,t){if(!this.isTwoWay()){return}if(e.hasAttribute("multiple")){return this.set("filteredValue",Array.prototype.slice.call(e.files))}else{return this.set("filteredValue",e.files[0]||null)}};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.DeferredRenderView=function(t){function n(){e=n.__super__.constructor.apply(this,arguments);return e}r(n,t);n.prototype.bindImmediately=false;return n}(Batman.View);Batman.DOM.DeferredRenderBinding=function(e){function n(){t=n.__super__.constructor.apply(this,arguments);return t}r(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.backWithView=Batman.DeferredRenderView;n.prototype.skipChildren=true;n.prototype.dataChange=function(e){if(e&&!this.backingView.isBound){this.node.removeAttribute("data-renderif");return this.backingView.initializeBindings()}};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.developer["do"](function(){var e;e=function(e){function n(){n.__super__.constructor.apply(this,arguments);debugger}t(n,e);return n}(Batman.DOM.AbstractBinding);return Batman.DOM.readers.debug=function(t){return new e(t)}})}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.AbstractAttributeBinding=function(e){function n(e){this.attributeName=e.attr;n.__super__.constructor.apply(this,arguments)}t(n,e);return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.EventBinding=function(e){function n(){var e,t,r=this;n.__super__.constructor.apply(this,arguments);t=function(){var e,t;e=r.get("filteredValue");t=r.view.targetForKeypath(r.functionPath||r.unfilteredKey);if(t&&r.functionPath){t=Batman.get(t,r.functionPath)}return e!=null?e.apply(t,arguments):void 0};if(e=Batman.DOM.events[this.attributeName]){e(this.node,t,this.view)}else{Batman.DOM.events.other(this.node,this.attributeName,t,this.view)}this.view.bindings.push(this)}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.bindImmediately=false;n.prototype._unfilteredValue=function(e){var t,r;this.unfilteredKey=e;if(!this.functionName&&(t=e.lastIndexOf("."))!==-1){this.functionPath=e.substr(0,t);this.functionName=e.substr(t+1)}r=n.__super__._unfilteredValue.call(this,this.functionPath||e);if(this.functionName){return r!=null?r[this.functionName]:void 0}else{return r}};return n}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.ContextBinding=function(e){function n(){var e;n.__super__.constructor.apply(this,arguments);e=this.attributeName?"data-"+this.bindingName+"-"+this.attributeName:"data-"+this.bindingName;this.node.removeAttribute(e);this.node.insertBefore(document.createComment("batman-"+e+'="'+this.keyPath+'"'),this.node.firstChild)}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.backWithView=true;n.prototype.bindingName="context";n.prototype.dataChange=function(e){return this.backingView.set(this.attributeName||"proxiedObject",e)};n.prototype.die=function(){this.backingView.unset(this.attributeName||"proxiedObject");return n.__super__.die.apply(this,arguments)};return n}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.FormBinding=function(e){function n(e){n.__super__.constructor.apply(this,arguments);this.initializeErrorsList();this.initializeChildBindings();Batman.DOM.events.submit(this.node,function(e,t){return Batman.DOM.preventDefault(t)})}t(n,e);n.prototype.bindingName="formfor";n.prototype.errorClass="error";n.prototype.defaultErrorsListSelector="div.errors";n.prototype.initializeChildBindings=function(){var e,t,n,r,i,s,o,u,a,f,l,c;o=this.keyPath;e=this.attributeName;f=["input","textarea","select"].map(function(t){return""+t+'[data-bind^="'+e+'"]'});a=Batman.DOM.querySelectorAll(this.node,f.join(", "));t="data-addclass-"+this.errorClass;for(l=0,c=a.length;l<c;l++){u=a[l];if(!!u.getAttribute(t)){continue}n=u.getAttribute("data-bind");i=n.substr(n.indexOf(e)+e.length+1);s=i.indexOf("|");if(s!==-1){i=i.substr(0,s)}i=i.trim();u.setAttribute(t,""+e+".errors."+i+".length")}r=Batman.DOM.querySelector(this.node,".errors");if(r&&!r.getAttribute("data-showif")){r.setAttribute("data-showif",""+e+".errors.length")}};n.prototype.initializeErrorsList=function(){var e,t;t=this.node.getAttribute("data-errors-list")||this.defaultErrorsListSelector;if(e=Batman.DOM.querySelector(this.node,t)){return Batman.DOM.setInnerHTML(e,this.errorsListHTML())}};n.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.attributeName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'};return n}(Batman.DOM.ContextBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.NodeAttributeBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.dataChange=function(e){if(e==null){e=""}return this.node[this.attributeName]=e};r.prototype.nodeChange=function(e){if(this.isTwoWay()){return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(e[this.attributeName]))}};return r}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.CheckedBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.isInputBinding=true;r.prototype.dataChange=function(e){return this.node[this.attributeName]=!!e};return r}(Batman.DOM.NodeAttributeBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.AttributeBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;r.prototype.dataChange=function(e){return this.node.setAttribute(this.attributeName,e)};r.prototype.nodeChange=function(e){if(this.isTwoWay()){return this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(e.getAttribute(this.attributeName)))}};return r}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};e=/[ \t]{2,}/g;Batman.DOM.AddClassBinding=function(t){function r(e){var t;this.invert=e.invert;this.classes=function(){var n,r,i,s;i=e.attr.split("|");s=[];for(n=0,r=i.length;n<r;n++){t=i[n];s.push({name:t,pattern:new RegExp("(?:^|\\s)"+t+"(?:$|\\s)","i")})}return s}();r.__super__.constructor.apply(this,arguments)}n(r,t);r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;r.prototype.dataChange=function(t){var n,r,i,s,o,u,a,f;n=this.node.className;a=this.classes;for(o=0,u=a.length;o<u;o++){f=a[o],i=f.name,s=f.pattern;r=s.test(n);if(!!t===!this.invert){if(!r){n=""+n+" "+i}}else{if(r){n=n.replace(s," ")}}}this.node.className=n.trim().replace(e," ");return true};return r}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.AbstractCollectionBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.bindCollection=function(e){var t;if(e instanceof Batman.Hash){e=e.meta}if(e===this.collection){return true}else{this.unbindCollection();this.collection=e;if(!((t=this.collection)!=null?t.isObservable:void 0)){return false}if(this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved){this.collection.on("itemsWereAdded",this.handleItemsAdded);this.collection.on("itemsWereRemoved",this.handleItemsRemoved);this.collection.on("itemWasMoved",this.handleItemMoved);this.handleArrayChanged(this.collection.toArray())}else{this.collection.observeAndFire("toArray",this.handleArrayChanged)}return true}};r.prototype.unbindCollection=function(){var e;if(!((e=this.collection)!=null?e.isObservable:void 0)){return}if(this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved){this.collection.off("itemsWereAdded",this.handleItemsAdded);this.collection.off("itemsWereRemoved",this.handleItemsRemoved);return this.collection.off("itemWasMoved",this.handleItemMoved)}else{return this.collection.forget("toArray",this.handleArrayChanged)}};r.prototype.handleArrayChanged=function(){};r.prototype.die=function(){this.unbindCollection();this.collection=null;return r.__super__.die.apply(this,arguments)};return r}(Batman.DOM.AbstractAttributeBinding)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e},r=[].slice;Batman.DOM.StyleBinding=function(i){function s(){this.setStyle=e(this.setStyle,this);this.handleArrayChanged=e(this.handleArrayChanged,this);this.oldStyles={};this.styleBindings={};s.__super__.constructor.apply(this,arguments)}n(s,i);s.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;s.prototype.dataChange=function(e){var n,i,s,o,u,a,f,l;if(!e){this.resetStyles();return}this.unbindCollection();if(typeof e==="string"){this.resetStyles();f=e.split(";");for(u=0,a=f.length;u<a;u++){o=f[u];l=o.split(":"),i=l[0],n=2<=l.length?r.call(l,1):[];this.setStyle(i,n.join(":"))}return}if(e instanceof Batman.Hash){this.bindCollection(e)}else{if(e instanceof Batman.Object){e=e.toJSON()}this.resetStyles();for(s in e){if(!t.call(e,s))continue;this.bindSingleAttribute(s,""+this.keyPath+"."+s)}}};s.prototype.handleArrayChanged=function(e){var t=this;return this.collection.forEach(function(e,n){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)})};s.prototype.bindSingleAttribute=function(e,t){var n;n=new Batman.DOM.AttrReaderBindingDefinition(this.node,e,t,this.view);return this.styleBindings[e]=new Batman.DOM.StyleBinding.SingleStyleBinding(n,this)};s.prototype.setStyle=function(e,t){e=Batman.helpers.camelize(e.trim(),true);if(this.oldStyles[e]==null){this.oldStyles[e]=this.node.style[e]||""}if(t!=null?t.trim:void 0){t=t.trim()}if(t==null){t=""}return this.node.style[e]=t};s.prototype.resetStyles=function(){var e,n,r;r=this.oldStyles;for(e in r){if(!t.call(r,e))continue;n=r[e];this.setStyle(e,n)}};s.prototype.resetBindings=function(){var e,t,n;n=this.styleBindings;for(e in n){t=n[e];t._fireDataChange("");t.die()}return this.styleBindings={}};s.prototype.unbindCollection=function(){this.resetBindings();return s.__super__.unbindCollection.apply(this,arguments)};s.SingleStyleBinding=function(e){function t(e,n){this.parent=n;t.__super__.constructor.call(this,e)}n(t,e);t.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;t.prototype.isTwoWay=function(){return false};t.prototype.dataChange=function(e){return this.parent.setStyle(this.attributeName,e)};return t}(Batman.DOM.AbstractAttributeBinding);return s}(Batman.DOM.AbstractCollectionBinding)}).call(this);(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.DOM.ClassBinding=function(i){function s(){this.handleArrayChanged=t(this.handleArrayChanged,this);e=s.__super__.constructor.apply(this,arguments);return e}r(s,i);s.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;s.prototype.dataChange=function(e){if(e!=null){this.unbindCollection();if(typeof e==="string"){return this.node.className=e}else{this.bindCollection(e);return this.updateFromCollection()}}};s.prototype.updateFromCollection=function(){var e,t,r;if(this.collection){e=this.collection.map?this.collection.map(function(e){return e}):function(){var e,i;e=this.collection;i=[];for(t in e){if(!n.call(e,t))continue;r=e[t];i.push(t)}return i}.call(this);if(e.toArray!=null){e=e.toArray()}return this.node.className=e.join(" ")}};s.prototype.handleArrayChanged=function(){return this.updateFromCollection()};return s}(Batman.DOM.AbstractCollectionBinding)}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.InsertionBinding=function(e){function n(e){this.invert=e.invert;n.__super__.constructor.apply(this,arguments);this.placeholderNode=document.createComment('batman-insertif="'+this.keyPath+'"')}t(n,e);n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;n.prototype.bindImmediately=false;n.prototype.initialized=function(){return this.bind()};n.prototype.dataChange=function(e){var t,n;n=Batman.View.viewForNode(this.node,false);t=this.placeholderNode.parentNode||this.node.parentNode;if(!!e===!this.invert){if(n!=null){n.fire("viewWillShow")}if(this.node.parentNode==null){t.insertBefore(this.node,this.placeholderNode);t.removeChild(this.placeholderNode)}return n!=null?n.fire("viewDidShow"):void 0}else{if(n!=null){n.fire("viewWillHide")}if(this.node.parentNode!=null){t.insertBefore(this.placeholderNode,this.node);t.removeChild(this.node)}return n!=null?n.fire("viewDidHide"):void 0}};n.prototype.die=function(){this.placeholderNode=null;return n.__super__.die.apply(this,arguments)};return n}(Batman.DOM.AbstractBinding)}).call(this);(function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t){if(n.call(t,r))e[r]=t[r]}i.prototype=t.prototype;e.prototype=new i;e.__super__=t.prototype;return e};Batman.IteratorView=function(t){function n(){e=n.__super__.constructor.apply(this,arguments);return e}r(n,t);n.prototype.loadView=function(){return document.createComment("batman-iterator-"+this.iteratorName+'="'+this.iteratorPath+'"')};n.prototype.addItems=function(e,t){var n,r,i,s,o,u;this._beginAppendItems();if(t){for(n=i=0,o=e.length;i<o;n=++i){r=e[n];this._insertItem(r,t[n])}}else{for(s=0,u=e.length;s<u;s++){r=e[s];this._insertItem(r)}}return this._finishAppendItems()};n.prototype.removeItems=function(e,t){var n,r,i,s,o,u,a,f,l;if(t){f=[];for(n=s=0,u=e.length;s<u;n=++s){r=e[n];f.push(this.subviews.at(t[n]).die())}return f}else{l=[];for(o=0,a=e.length;o<a;o++){r=e[o];l.push(function(){var e,t,n,s;n=this.subviews._storage;s=[];for(e=0,t=n.length;e<t;e++){i=n[e];if(!(i.get(this.attributeName)===r)){continue}i.unset(this.attributeName);i.die();break}return s}.call(this))}return l}};n.prototype.moveItem=function(e,t){var n,r;n=this.subviews.at(e);this.subviews._storage.splice(e,1);r=this.subviews.at(t);this.subviews._storage.splice(t,0,n);return this.node.parentNode.insertBefore(n.node,(r!=null?r.node:void 0)||this.node)};n.prototype._beginAppendItems=function(){var e;if(!this.iterationViewClass&&(e=this.prototypeNode.getAttribute("data-view"))){this.iterationViewClass=this.lookupKeypath(e);this.prototypeNode.removeAttribute("data-view")}this.iterationViewClass||(this.iterationViewClass=Batman.IterationView);this.fragment=document.createDocumentFragment();this.appendedViews=[];return this.get("node")};n.prototype._insertItem=function(e,t){var n;n=new this.iterationViewClass({node:this.prototypeNode.cloneNode(true),parentNode:this.fragment});n.set(this.iteratorName,e);if(t!=null){n._targeted=true;this.subviews.insert([n],[t])}else{this.subviews.add(n)}n.parentNode=null;return this.appendedViews.push(n)};n.prototype._finishAppendItems=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;t=Batman.DOM.containsNode(this.node);if(t){f=this.appendedViews;for(i=0,u=f.length;i<u;i++){r=f[i];r.propagateToSubviews("viewWillAppear")}}l=this.subviews.toArray();for(e=s=l.length-1;s>=0;e=s+=-1){r=l[e];if(!r._targeted){continue}if(n=(c=this.subviews.at(e+1))!=null?c.get("node"):void 0){n.parentNode.insertBefore(r.get("node"),n)}else{this.fragment.appendChild(r.get("node"))}delete r._targeted}this.node.parentNode.insertBefore(this.fragment,this.node);this.fire("itemsWereRendered");if(t){h=this.appendedViews;for(o=0,a=h.length;o<a;o++){r=h[o];r.propagateToSubviews("isInDOM",t);r.propagateToSubviews("viewDidAppear")}}this.appendedViews=null;return this.fragment=null};return n}(Batman.View);Batman.IterationView=function(e){function n(){t=n.__super__.constructor.apply(this,arguments);return t}r(n,e);return n}(Batman.View)}).call(this);(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.IteratorBinding=function(t){function r(t){this.handleItemMoved=e(this.handleItemMoved,this);this.handleItemsRemoved=e(this.handleItemsRemoved,this);this.handleItemsAdded=e(this.handleItemsAdded,this);this.handleArrayChanged=e(this.handleArrayChanged,this);var n=this;this.iteratorName=t.attr;this.prototypeNode=t.node;this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName);t.viewOptions={prototypeNode:this.prototypeNode,iteratorName:this.iteratorName,iteratorPath:t.keyPath};t.node=null;r.__super__.constructor.apply(this,arguments);this.backingView.set("attributeName",this.attributeName);this.view.prevent("ready");Batman.setImmediate(function(){var e;e=n.prototypeNode.parentNode;e.insertBefore(n.backingView.get("node"),n.prototypeNode);e.removeChild(n.prototypeNode);n.bind();return n.view.allowAndFire("ready")})}n(r,t);r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data;r.prototype.backWithView=Batman.IteratorView;r.prototype.skipChildren=true;r.prototype.bindImmediately=false;r.prototype.dataChange=function(e){var t,n;if(e!=null){if(!this.bindCollection(e)){t=(e!=null?e.forEach:void 0)?(n=[],e.forEach(function(e){return n.push(e)}),n):Object.keys(e);this.handleArrayChanged(t)}}else{this.unbindCollection();this.collection=[];this.handleArrayChanged([])}};r.prototype.handleArrayChanged=function(e){if(!this.backingView.isDead){this.backingView.destroySubviews();if(e!=null?e.length:void 0){return this.handleItemsAdded(e)}}};r.prototype.handleItemsAdded=function(e,t){if(!this.backingView.isDead){return this.backingView.addItems(e,t)}};r.prototype.handleItemsRemoved=function(e,t){if(this.backingView.isDead){return}if(this.collection.length){return this.backingView.removeItems(e,t)}else{return this.backingView.destroySubviews()}};r.prototype.handleItemMoved=function(e,t,n){if(!this.backingView.isDead){return this.backingView.moveItem(n,t)}};r.prototype.die=function(){this.prototypeNode=null;return r.__super__.die.apply(this,arguments)};return r}(Batman.DOM.AbstractCollectionBinding)}).call(this);(function(){var e,t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n){if(t.call(n,r))e[r]=n[r]}i.prototype=n.prototype;e.prototype=new i;e.__super__=n.prototype;return e};Batman.DOM.StyleAttributeBinding=function(t){function r(){e=r.__super__.constructor.apply(this,arguments);return e}n(r,t);r.prototype.dataChange=function(e){return this.node.style[Batman.Filters.camelize(this.attributeName,true)]=e};return r}(Batman.DOM.NodeAttributeBinding)}).call(this);(function(){var e;e=function(e){var t;for(t in e){return false}return true};Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var e,t;try{e=document.createElement("div");return delete e.test}catch(n){t=n;return Batman.canDeleteExpando=false}}(),noData:{embed:true,EMBED:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",OBJECT:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:true,APPLET:true},hasData:function(t){t=t.nodeType?Batman.cache[t[Batman.expando]]:t[Batman.expando];return!!t&&!e(t)},data:function(e,t,n,r){var i,s,o,u,a,f;if(!Batman.acceptData(e)){return}u=Batman.expando;s=typeof t==="string";i=Batman.cache;o=e[Batman.expando];if((!o||r&&o&&i[o]&&!i[o][u])&&s&&n===void 0){return}if(!o){if(e.nodeType!==3){e[Batman.expando]=o=++Batman.uuid}else{o=Batman.expando}}if(!i[o]){i[o]={}}if(typeof t==="object"||typeof t==="function"){if(r){i[o][u]=Batman.extend(i[o][u],t)}else{i[o]=Batman.extend(i[o],t)}}f=i[o];if(r){f[u]||(f[u]={});f=f[u]}if(n!==void 0){f[t]=n}if(s){a=f[t]}else{a=f}return a},removeData:function(t,n,r,i){var s,o,u,a,f,l;if(!Batman.acceptData(t)){return}a=Batman.expando;f=t.nodeType;s=Batman.cache;o=t[Batman.expando];if(!s[o]){return}if(n){l=r?s[o][a]:s[o];if(l){delete l[n];if(!e(l)){return}}}if(r){delete s[o][a];if(!e(s[o])){return}}u=s[o][a];if(Batman.canDeleteExpando||!s.setInterval){delete s[o]}else{s[o]=null}if(u&&!i){s[o]={};return s[o][a]=u}else{if(Batman.canDeleteExpando){return delete t[Batman.expando]}else if(t.removeAttribute){return t.removeAttribute(Batman.expando)}else{return t[Batman.expando]=null}}},_data:function(e,t,n){return Batman.data(e,t,n,true)},acceptData:function(e){var t;if(!e){return}return e.___acceptData||(e.___acceptData=e.nodeName?(t=Batman.noData[e.nodeName],t?!(t===true||e.getAttribute("classid")!==t):true):true)}})}).call(this);(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n){if(e.call(n,r))t[r]=n[r]}i.prototype=n.prototype;t.prototype=new i;t.__super__=n.prototype;return t};Batman.DOM.Yield=function(e){function n(e){this.name=e}t(n,e);n.yields={};n.reset=function(){return this.yields={}};n.withName=function(e){var t;return(t=this.yields)[e]||(t[e]=new this(e))};n.accessor("contentView",{get:function(){return this.contentView},set:function(e,t){if(this.contentView===t){return}if(this.contentView){this.contentView.removeFromSuperview()}this.contentView=t;if(this.containerNode&&t){return t.set("parentNode",this.containerNode)}}});n.accessor("containerNode",{get:function(){return this.containerNode},set:function(e,t){if(this.containerNode===t){return}this.containerNode=t;if(this.contentView){return this.contentView.set("parentNode",t)}}});return n}(Batman.Object)}).call(this);(function(){var e,t,n=[].slice;e=function(e){return function(t){if(t==null){return void 0}else{return e.apply(this,arguments)}}};t=function(e,t){return e||t};Batman.Filters={raw:e(function(e,t){t.escapeValue=false;return e}),get:e(function(e,t){if(e.get!=null){return e.get(t)}else{return e[t]}}),equals:e(function(e,t,n){return e===t}),and:function(e,t){return e&&t},or:function(e,t,n){return e||t},not:function(e,t){return!e},trim:e(function(e,t){return e.trim()}),matches:e(function(e,t){return e.indexOf(t)!==-1}),truncate:e(function(e,t,n,r){if(n==null){n="..."}if(!r){r=n;n="..."}if(e.length>t){e=e.substr(0,t-n.length)+n}return e}),"default":function(e,t,n){if(e!=null&&e!==""){return e}else{return t}},prepend:function(e,t,n){return(t!=null?t:"")+(e!=null?e:"")},append:function(e,t,n){return(e!=null?e:"")+(t!=null?t:"")},replace:e(function(e,t,n,r,i){if(!i){i=r;r=void 0}if(r===void 0){return e.replace(t,n)}else{return e.replace(t,n,r)}}),downcase:e(function(e){return e.toLowerCase()}),upcase:e(function(e){return e.toUpperCase()}),pluralize:e(function(e,t,n,r){if(!r){r=n;n=true;if(!r){r=t;t=void 0}}if(t!=null){return Batman.helpers.pluralize(t,e,void 0,n)}else{return Batman.helpers.pluralize(e)}}),humanize:e(function(e,t){return Batman.helpers.humanize(e)}),join:e(function(e,t,n){if(t==null){t=""}if(!n){n=t;t=""}return e.join(t)}),sort:e(function(e){return e.sort()}),map:e(function(e,t){return e.map(function(e){return Batman.get(e,t)})}),has:function(e,t){if(e==null){return false}return Batman.contains(e,t)},first:e(function(e){return e[0]}),meta:e(function(e,t){Batman.developer.assert(e.meta,"Error, value doesn't have a meta to filter on!");return e.meta.get(t)}),interpolate:function(e,t,n){var r,i,s;if(!n){n=t;t=void 0}if(!e){return}s={};for(r in t){i=t[r];s[r]=this.get(i);if(s[r]==null){Batman.developer.warn("Warning! Undefined interpolation key "+r+" for interpolation",e);s[r]=""}}return Batman.helpers.interpolate(e,s)},withArguments:function(){var e,t,r,i;t=arguments[0],r=3<=arguments.length?n.call(arguments,1,i=arguments.length-1):(i=1,[]),e=arguments[i++];if(!t){return}return function(){var e;e=1<=arguments.length?n.call(arguments,0):[];return t.call.apply(t,[this].concat(n.call(r),n.call(e)))}},routeToAction:e(function(e,t){var n;n=Batman.Dispatcher.paramsFromArgument(e);n.action=t;return n}),escape:e(Batman.escapeHTML)};(function(){var t,n,r,i,s;i=["capitalize","singularize","underscore","camelize"];s=[];for(n=0,r=i.length;n<r;n++){t=i[n];s.push(Batman.Filters[t]=e(Batman.helpers[t]))}return s})();Batman.developer.addFilters()}).call(this);(function(){}).call(this)