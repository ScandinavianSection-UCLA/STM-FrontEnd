// Generated by CoffeeScript 1.7.1
var appContext,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
  __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

require.config({
  paths: {
    jquery: "/components/jquery/jquery.min",
    bootstrap: "/components/bootstrap/dist/js/bootstrap.min",
    batman: "/batmanjs/batman",
    wordcloud: "/wordcloudjs/wordcloud.min"
  },
  shim: {
    bootstrap: {
      deps: ["jquery"]
    },
    batman: {
      deps: ["jquery"],
      exports: "Batman"
    },
    wordcloud: {
      exports: "WordCloud"
    }
  },
  waitSeconds: 30
});

appContext = void 0;

define("Batman", ["batman"], function(Batman) {
  return Batman.DOM.readers.batmantarget = Batman.DOM.readers.target && delete Batman.DOM.readers.target && Batman;
});

require(["jquery", "Batman", "bootstrap"], function($, Batman) {
  var AppContext, STM, isScrolledIntoView;
  isScrolledIntoView = function(elem) {
    var elemTop;
    return (elemTop = $(elem).position().top) >= 0 && (elemTop + $(elem).height()) <= $(elem).parent().height();
  };
  AppContext = (function(_super) {
    __extends(AppContext, _super);

    function AppContext() {
      AppContext.__super__.constructor.apply(this, arguments);
      if (window.location.pathname === "/") {
        this.set("indexContext", new this.IndexContext);
      }
      if (window.location.pathname === "/topics") {
        this.set("topicsContext", new this.TopicsContext);
      }
    }

    AppContext.prototype.IndexContext = (function(_super1) {
      __extends(IndexContext, _super1);

      function IndexContext() {
        IndexContext.__super__.constructor.apply(this, arguments);
      }

      return IndexContext;

    })(Batman.Model);

    AppContext.prototype.TopicsContext = (function(_super1) {
      __extends(TopicsContext, _super1);

      TopicsContext.accessor("filteredTopics", function() {
        var findInStr;
        findInStr = function(chars, str, j) {
          var idx, ret;
          if (j == null) {
            j = 0;
          }
          if (chars === "") {
            return [];
          }
          if ((idx = str.indexOf(chars[0])) === -1) {
            return;
          }
          if ((ret = findInStr(chars.slice(1), str.slice(idx + 1), idx + j + 1)) != null) {
            return [idx + j].concat(ret);
          }
        };
        return this.get("topics").map((function(_this) {
          return function(topic) {
            return {
              topic: topic,
              indices: findInStr(_this.get("topicSearch_text").toLowerCase(), topic.get("name").toLowerCase())
            };
          };
        })(this)).filter(function(x) {
          return x.indices != null;
        }).map((function(_this) {
          return function(topic, idx) {
            var c, i;
            return {
              topic: topic.topic,
              indices: topic.indices,
              active: idx === _this.get("topicsList_activeIndex"),
              html: ((function() {
                var _i, _len, _ref, _results;
                _ref = topic.topic.get("name");
                _results = [];
                for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
                  c = _ref[i];
                  if (__indexOf.call(topic.indices, i) >= 0) {
                    _results.push("<strong>" + c + "</strong>");
                  } else {
                    _results.push(c);
                  }
                }
                return _results;
              })()).join("")
            };
          };
        })(this));
      });

      function TopicsContext() {
        var i;
        TopicsContext.__super__.constructor.apply(this, arguments);
        this.set("topicSearch_text", "");
        this.set("topicsList_activeIndex", 0);
        this.set("topics", (function() {
          var _i, _results;
          _results = [];
          for (i = _i = 0; _i < 10; i = ++_i) {
            _results.push(new this.Topic(i, "Topic " + i));
          }
          return _results;
        }).call(this));
        $("#topicSearch").popover({
          html: true,
          animation: false,
          placement: "bottom",
          trigger: "focus",
          content: function() {
            return $("#topicsList");
          }
        }).on("hide.bs.popover", function() {
          return $("#hidden-content").append($("#topicsList"));
        });
      }

      TopicsContext.prototype.topicSearch_keydown = function(node, e) {
        var fl, _ref;
        if ((_ref = e.which) === 38 || _ref === 40) {
          e.preventDefault();
        }
        if (e.which === 38) {
          this.set("topicsList_activeIndex", ((fl = this.get("filteredTopics").length) + this.get("topicsList_activeIndex") - 1) % fl);
          if (!isScrolledIntoView("#topicsList a.list-group-item.active")) {
            $("#topicsList a.list-group-item.active")[0].scrollIntoView(true);
          }
        }
        if (e.which === 40) {
          this.set("topicsList_activeIndex", (this.get("topicsList_activeIndex") + 1) % this.get("filteredTopics").length);
          if (!isScrolledIntoView("#topicsList a.list-group-item.active")) {
            return $("#topicsList a.list-group-item.active")[0].scrollIntoView(false);
          }
        }
      };

      TopicsContext.prototype.topicSearch_input = function() {
        return this.set("topicsList_activeIndex", 0);
      };

      TopicsContext.prototype.Topic = (function(_super2) {
        __extends(Topic, _super2);

        function Topic(id, name) {
          Topic.__super__.constructor.apply(this, arguments);
          this.set("id", id);
          this.set("name", name);
        }

        return Topic;

      })(Batman.Model);

      return TopicsContext;

    })(Batman.Model);

    return AppContext;

  })(Batman.Model);
  STM = (function(_super) {
    __extends(STM, _super);

    function STM() {
      return STM.__super__.constructor.apply(this, arguments);
    }

    STM.appContext = appContext = new AppContext;

    return STM;

  })(Batman.App);
  STM.run();
  return $(function() {
    return appContext.set("pageLoaded", true);
  });
});
