"use strict";if(!window.setImmediate){window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener){return null}var t=[undefined];var n="zero-timeout-message";var r=function(r){var i=t.length;t.push(r);window.postMessage(n+i.toString(36),"*");return i};window.addEventListener("message",function(r){if(typeof r.data!=="string"||r.data.substr(0,n.length)!==n)return;r.stopImmediatePropagation();var i=parseInt(r.data.substr(n.length),36);if(!t[i])return;t[i]();t[i]=undefined},true);window.clearImmediate=function(n){if(!t[n])return;t[n]=undefined};return r}()||function(t){window.setTimeout(t,0)}}()}if(!window.clearImmediate){window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()}(function(e){var t=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return false;var n=t.getContext("2d");if(!n.getImageData)return false;if(!n.fillText)return false;if(!Array.prototype.some)return false;if(!Array.prototype.push)return false;return true}();var n=function(){if(!t)return;var n=document.createElement("canvas").getContext("2d");var r=20;var i,s;while(r){n.font=r.toString(10)+"px sans-serif";if(n.measureText("Ｗ").width===i&&n.measureText("m").width===s)return r+1;i=n.measureText("Ｗ").width;s=n.measureText("m").width;r--}return 0}();var r=function(t){for(var n,r,i=t.length;i;n=Math.floor(Math.random()*i),r=t[--i],t[i]=t[n],t[n]=r);return t};var i=function(i,s){if(!t)return;if(!Array.isArray(i)){i=[i]}i.forEach(function(e,t){if(typeof e==="string"){i[t]=document.getElementById(e);if(!i[t]){throw"The element id specified is not found."}}else if(!e.tagName&&!e.appendChild){throw"You must pass valid HTML elements, or ID of the element."}});var o={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", '+'"Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:true,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:false,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,shuffle:true,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(s){for(var u in s){if(u in o)o[u]=s[u]}}if(typeof o.weightFactor!=="function"){var a=o.weightFactor;o.weightFactor=function(t){return t*a}}if(typeof o.shape!=="function"){switch(o.shape){case"circle":default:o.shape="circle";break;case"cardioid":o.shape=function(t){return 1-Math.sin(t)};break;case"diamond":case"square":o.shape=function(t){var n=t%(2*Math.PI/4);return 1/(Math.cos(n)+Math.sin(n))};break;case"triangle-forward":o.shape=function(t){var n=t%(2*Math.PI/3);return 1/(Math.cos(n)+Math.sqrt(3)*Math.sin(n))};break;case"triangle":case"triangle-upright":o.shape=function(t){var n=(t+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(n)+Math.sqrt(3)*Math.sin(n))};break;case"pentagon":o.shape=function(t){var n=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(n)+.726543*Math.sin(n))};break;case"star":o.shape=function(t){var n=(t+.955)%(2*Math.PI/10);if((t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0){return 1/(Math.cos(2*Math.PI/10-n)+3.07768*Math.sin(2*Math.PI/10-n))}else{return 1/(Math.cos(n)+3.07768*Math.sin(n))}};break}}o.gridSize=Math.max(o.gridSize,4);var f=o.gridSize;var l=f-o.maskGapWidth;var c=Math.abs(o.maxRotation-o.minRotation);var h=Math.min(o.maxRotation,o.minRotation);var p,d,v,m,g;var y;var b;switch(o.color){case"random-dark":b=function(){return"rgb("+Math.floor(Math.random()*128).toString(10)+","+Math.floor(Math.random()*128).toString(10)+","+Math.floor(Math.random()*128).toString(10)+")"};break;case"random-light":b=function(){return"rgb("+Math.floor(Math.random()*128+128).toString(10)+","+Math.floor(Math.random()*128+128).toString(10)+","+Math.floor(Math.random()*128+128).toString(10)+")"};break;default:if(typeof o.color==="function"){b=o.color}break}var w=false;var E=[];var S;var x=function(t){var n=canvas.getBoundingClientRect();var r=t.clientX-n.left;var i=t.clientY-n.top;var s=Math.floor(r*(canvas.width/n.width)/f);var o=Math.floor(i*(canvas.height/n.height)/f);return E[s][o]};var T=function(t){var n=x(t);if(S===n)return;S=n;if(!n){o.hover(undefined,undefined,t);return}o.hover(n.item,n.dimension,t)};var N=function(t){var n=x(t);if(!n)return;o.click(n.item,n.dimension,t)};var C=[];var k=function(t){if(C[t])return C[t];var n=t*8;var r=n;var i=[];if(t===0){i.push([m[0],m[1],0])}while(r--){var s=1;if(o.shape!=="circle")s=o.shape(r/n*2*Math.PI);i.push([m[0]+t*s*Math.cos(-r/n*2*Math.PI),m[1]+t*s*Math.sin(-r/n*2*Math.PI)*o.ellipticity,r/n*2*Math.PI])}C[t]=i;return i};var L=function(){return o.abortThreshold>0&&(new Date).getTime()-y>o.abortThreshold};var A=function(){if(o.rotateRatio===0)return 0;if(Math.random()>o.rotateRatio)return 0;if(c===0)return h;return h+Math.random()*c};var O=function(t,r,i){var s=false;var u=o.weightFactor(r);if(u<=o.minSize)return false;var a=1;if(u<n){a=function(){var t=2;while(t*u<n){t+=2}return t}()}var l=document.createElement("canvas");var c=l.getContext("2d",{willReadFrequently:true});c.font=o.fontWeight+" "+(u*a).toString(10)+"px "+o.fontFamily;var h=c.measureText(t).width/a;var p=Math.max(u*a,c.measureText("m").width,c.measureText("Ｗ").width)/a;var d=h+p*2;var v=p*3;var m=Math.ceil(d/f);var g=Math.ceil(v/f);d=m*f;v=g*f;var y=-h/2;var b=-p*.4;var w=Math.ceil((d*Math.abs(Math.sin(i))+v*Math.abs(Math.cos(i)))/f);var E=Math.ceil((d*Math.abs(Math.cos(i))+v*Math.abs(Math.sin(i)))/f);var S=E*f;var x=w*f;l.setAttribute("width",S);l.setAttribute("height",x);if(s)document.body.appendChild(l);c.save();c.scale(1/a,1/a);c.translate(S*a/2,x*a/2);c.rotate(-i);c.font=o.fontWeight+" "+(u*a).toString(10)+"px "+o.fontFamily;c.fillStyle="#000";c.textBaseline="middle";c.fillText(t,y*a,(b+u*.5)*a);c.restore();var T=c.getImageData(0,0,S,x).data;if(L())return false;var N=[];var C=E,k,A,O;var M=[w/2,E/2,w/2,E/2];while(C--){k=w;while(k--){O=f;e:{while(O--){A=f;while(A--){if(T[((k*f+O)*S+(C*f+A))*4+3]){N.push([C,k]);if(C<M[3])M[3]=C;if(C>M[1])M[1]=C;if(k<M[0])M[0]=k;if(k>M[2])M[2]=k;if(s){c.fillStyle="rgba(255, 0, 0, 0.5)";c.fillRect(C*f,k*f,f-.5,f-.5)}break e}}}if(s){c.fillStyle="rgba(0, 0, 255, 0.5)";c.fillRect(C*f,k*f,f-.5,f-.5)}}}}if(s){c.fillStyle="rgba(0, 255, 0, 0.5)";c.fillRect(M[3]*f,M[0]*f,(M[1]-M[3]+1)*f,(M[2]-M[0]+1)*f)}return{mu:a,occupied:N,bounds:M,gw:E,gh:w,fillTextOffsetX:y,fillTextOffsetY:b,fillTextWidth:h,fillTextHeight:p,fontSize:u}};var M=function(t,n,r,i,s){var o=s.length;while(o--){var u=t+s[o][0];var a=n+s[o][1];if(u>=d||a>=v||u<0||a<0||!p[u][a]){return false}}return true};var _=function(t,n,r,s,u,a,l,c){var h=r.fontSize;var p;if(b){p=b(s,u,h,a,l)}else{p=o.color}var d;var v=r.bounds;d={x:(t+v[3])*f,y:(n+v[0])*f,w:(v[1]-v[3]+1)*f,h:(v[2]-v[0]+1)*f};i.forEach(function(e){if(e.getContext){var i=e.getContext("2d");var u=r.mu;i.save();i.scale(1/u,1/u);i.font=o.fontWeight+" "+(h*u).toString(10)+"px "+o.fontFamily;i.fillStyle=p;i.translate((t+r.gw/2)*f*u,(n+r.gh/2)*f*u);if(c!==0){i.rotate(-c)}i.textBaseline="middle";i.fillText(s,r.fillTextOffsetX*u,(r.fillTextOffsetY+h*.5)*u);i.restore()}else{var a=document.createElement("span");var l="";l="rotate("+ -c/Math.PI*180+"deg) ";if(r.mu!==1){l+="translateX(-"+r.fillTextWidth/4+"px) "+"scale("+1/r.mu+")"}var d={position:"absolute",display:"block",font:o.fontWeight+" "+h*r.mu+"px "+o.fontFamily,left:(t+r.gw/2)*f+r.fillTextOffsetX+"px",top:(n+r.gh/2)*f+r.fillTextOffsetY+"px",width:r.fillTextWidth+"px",height:r.fillTextHeight+"px",color:p,lineHeight:h+"px",whiteSpace:"nowrap",transform:l,webkitTransform:l,msTransform:l,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};a.textContent=s;for(var v in d){a.style[v]=d[v]}e.appendChild(a)}})};var D=function(t,n,r,i,s){if(t>=d||n>=v||t<0||n<0)return;p[t][n]=false;if(r)ctx.fillRect(t*f,n*f,l,l);if(w){E[t][n]={item:s,dimension:i}}};var P=function(t,n,r,i,s,u){var a=s.occupied;var l=f-o.maskGapWidth;var c=o.drawMask;if(c){ctx.save();ctx.fillStyle=o.maskColor}var h;if(w){var p=s.bounds;h={x:(t+p[3])*f,y:(n+p[0])*f,w:(p[1]-p[3]+1)*f,h:(p[2]-p[0]+1)*f}}var d=a.length;while(d--){D(t+a[d][0],n+a[d][1],c,h,u)}if(c)ctx.restore()};var H=function(t){var n=t[0];var i=t[1];var s=A();var u=O(n,i,s);if(!u)return false;if(L())return false;var a=u.bounds;if(a[1]-a[3]+1>d||a[2]-a[0]+1>v){return false}var f=g+1;while(f--){var l=k(g-f);if(o.shuffle){l=[].concat(l);r(l)}var c=l.some(function(r){var o=Math.floor(r[0]-u.gw/2);var a=Math.floor(r[1]-u.gh/2);var l=u.gw;var c=u.gh;if(!M(o,a,l,c,u.occupied))return false;_(o,a,u,n,i,g-f,r[2],s);P(o,a,l,c,u,t);return true});if(c){return true}}return false};var B=function(t,n,r){if(n){return!i.some(function(e){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,true,n,r||{});return!e.dispatchEvent(i)},this)}else{i.forEach(function(e){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,true,n,r||{});e.dispatchEvent(i)},this)}};var j=function(){var t=i[0];if(t.getContext){d=Math.floor(t.width/f);v=Math.floor(t.height/f)}else{var n=t.getBoundingClientRect();d=Math.floor(n.width/f);v=Math.floor(n.height/f)}if(!B("wordcloudstart",true)){return}m=o.origin?[o.origin[0]/f,o.origin[1]/f]:[d/2,v/2];g=Math.floor(Math.sqrt(d*d+v*v));p=[];if(!t.getContext||o.clearCanvas){i.forEach(function(e){if(e.getContext){var t=e.getContext("2d");t.fillStyle=o.backgroundColor;t.clearRect(0,0,d*(f+1),v*(f+1));t.fillRect(0,0,d*(f+1),v*(f+1))}else{e.textContent="";e.style.backgroundColor=o.backgroundColor}});var r=d,s;while(r--){p[r]=[];s=v;while(s--){p[r][s]=true}}}else{var u=document.createElement("canvas").getContext("2d");u.fillStyle=o.backgroundColor;u.fillRect(0,0,1,1);var a=u.getImageData(0,0,1,1).data;var l=t.getContext("2d").getImageData(0,0,d*f,v*f).data;var r=d,s,c,h,b;while(r--){p[r]=[];s=v;while(s--){h=f;e:while(h--){c=f;while(c--){b=4;while(b--){if(l[((s*f+h)*d*f+(r*f+c))*4+b]!==a[b]){p[r][s]=false;break e}}}}if(p[r][s]!==false){p[r][s]=true}}}l=u=a=undefined}if(o.hover||o.click){w=true;var r=d+1;while(r--){E[r]=[]}if(o.hover){t.addEventListener("mousemove",T)}if(o.click){t.addEventListener("click",N)}t.addEventListener("wordcloudstart",function _(){t.removeEventListener("wordcloudstart",_);t.removeEventListener("mousemove",T);t.removeEventListener("click",N);S=undefined})}var b=0;var x,C;if(o.wait!==0){x=window.setTimeout;C=window.clearTimeout}else{x=window.setImmediate;C=window.clearImmediate}var k=function(t,n){i.forEach(function(e){e.addEventListener(t,n)},this)};var A=function(t,n){i.forEach(function(e){e.removeEventListener(t,n)},this)};var O=function D(){A("wordcloudstart",D);C(M)};k("wordcloudstart",O);$("#canvas-container span").remove();var M=x(function P(){if(b>=o.list.length){C(M);B("wordcloudstop",false);A("wordcloudstart",O);return}y=(new Date).getTime();var e=H(o.list[b]);var t=!B("wordclouddrawn",true,{item:o.list[b],drawn:e});if(L()||t){C(M);o.abort();B("wordcloudabort",false);B("wordcloudstop",false);A("wordcloudstart",O);return}b++;M=x(P,o.wait)},o.wait)};j()};i.isSupported=t;i.miniumFontSize=n;if(typeof define==="function"&&define.amd){define("wordcloud",[],function(){return i})}else{e.WordCloud=i}})(this)